{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\ud83c\udfe0 Home","text":"Documentaci\u00f3n de Equipo de Desarrollo El Alto \ud83d\ude80 Aqu\u00ed podr\u00e1s encontrar la documentaci\u00f3n de todas las apps disponibles: frontend, backend y gu\u00edas de c\u00f3mo se fueron levantando los distintos servicios. \ud83d\udcca Arquitectura del Sistema <pre><code>flowchart LR\nClient[Cliente Web]\nAPI[FastAPI Backend]\nDB[(MySQL DB)]\nSAP[SAP ERP]\nAzure[Azure Cloud]\nClient --&gt;|HTTP/HTTPS| API\nAPI --&gt;|Queries| DB\nAPI &lt;--&gt;|RFC| SAP\nAPI --&gt;|Deployed on| Azure</code></pre> \ud83d\udd04 Flujo de Trabajo Git <pre><code>gitGraph\ncommit id: \"inicial\"\nbranch qa\ncheckout qa\ncommit id: \"qa-inicial\"\nbranch develop\ncheckout develop\ncommit id: \"dev-inicial\"\nbranch feature/nueva\ncheckout feature/nueva\ncommit id: \"desarrollo-feature\"\ncommit id: \"feature-completa\"\ncheckout develop\nmerge feature/nueva\ncommit id: \"dev-estable\"\ncheckout qa\nmerge develop\ncommit id: \"qa-validado\"\ncheckout main\nmerge qa tag: \"v1.0.0\"</code></pre> \ud83d\udee0\ufe0f Tecnolog\u00edas Implementadas Cloud y Backend: Frontend:"},{"location":"backend/ambientes/","title":"\ud83c\udf0d Ambientes de Desarrollo","text":""},{"location":"backend/ambientes/#vision-general","title":"\ud83c\udfaf Visi\u00f3n General","text":"<pre><code>graph LR\n    DEV[\ud83d\udee0\ufe0f Desarrollo] --&gt; QA[\ud83e\uddea Pruebas] --&gt; PROD[\ud83d\ude80 Producci\u00f3n]\n\n    style DEV fill:#f9f,stroke:#333,stroke-width:2px\n    style QA fill:#bbf,stroke:#333,stroke-width:2px\n    style PROD fill:#bfb,stroke:#333,stroke-width:2px</code></pre>"},{"location":"backend/ambientes/#ambientes-disponibles","title":"\ud83d\udd04 Ambientes Disponibles","text":""},{"location":"backend/ambientes/#1-desarrollo-dev","title":"1\ufe0f\u20e3 Desarrollo (DEV)","text":"\ud83d\udee0\ufe0f Ambiente de Desarrollo Aspecto Detalle \ud83c\udf10 URL dev.azurewebsites.net \ud83d\udd11 KeyVault elalto \ud83d\udcca Base de Datos Sandbox <pre><code>graph LR\n    subgraph \"Desarrollo\"\n        D[\ud83d\udee0\ufe0f DEV] --&gt; DS[\ud83d\udcbe SAP Sandbox]\n        D --&gt; DF[\ud83d\udccb Febos Test]\n        D --&gt; DG[\ud83d\udd04 Graph Test]\n    end</code></pre>"},{"location":"backend/ambientes/#2-pruebas-qa","title":"2\ufe0f\u20e3 Pruebas (QA)","text":"\ud83e\uddea Ambiente de Pruebas Aspecto Detalle \ud83c\udf10 URL qa.azurewebsites.net \ud83d\udd11 KeyVault elalto \ud83d\udcca Base de Datos Sandbox <pre><code>graph LR\n    subgraph \"Pruebas\"\n        Q[\ud83e\uddea QA] --&gt; QS[\ud83d\udcbe SAP Sandbox]\n        Q --&gt; QF[\ud83d\udccb Febos Test]\n        Q --&gt; QG[\ud83d\udd04 Graph Test]\n    end</code></pre>"},{"location":"backend/ambientes/#3-produccion-prod","title":"3\ufe0f\u20e3 Producci\u00f3n (PROD)","text":"\ud83d\ude80 Ambiente de Producci\u00f3n Aspecto Detalle \ud83c\udf10 URL prod.azurewebsites.net \ud83d\udd11 KeyVault elalto \ud83d\udcca Base de Datos HANA <pre><code>graph LR\n    subgraph \"Producci\u00f3n\"\n        P[\ud83d\ude80 PROD] --&gt; PS[\ud83d\udcbe SAP HANA]\n        P --&gt; PF[\ud83d\udccb Febos Prod]\n        P --&gt; PG[\ud83d\udd04 Graph Prod]\n    end</code></pre>"},{"location":"backend/ambientes/#servicios-azure","title":"\ud83d\udd27 Servicios Azure","text":"Servicios por Ambiente <pre><code>graph TB\n    subgraph \"Azure Services\"\n        DEV[\"\ud83d\udee0\ufe0f DEV\"] --&gt; |Test|AZ1[\"\n            \ud83d\udce6 Blob Storage\n            \ud83d\udcdd Form Recognizer\n            \ud83d\udd04 Web PubSub\n            \ud83d\udd11 Key Vault\n        \"]\n\n        QA[\"\ud83e\uddea QA\"] --&gt; |Test|AZ2[\"\n            \ud83d\udce6 Blob Storage\n            \ud83d\udcdd Form Recognizer\n            \ud83d\udd04 Web PubSub\n            \ud83d\udd11 Key Vault\n        \"]\n\n        PROD[\"\ud83d\ude80 PROD\"] --&gt; |Production|AZ3[\"\n            \ud83d\udce6 Blob Storage\n            \ud83d\udcdd Form Recognizer\n            \ud83d\udd04 Web PubSub\n            \ud83d\udd11 Key Vault\n        \"]\n    end</code></pre>"},{"location":"backend/ambientes/#arquitectura-sap","title":"\ud83d\udd17 Arquitectura SAP","text":"Conexi\u00f3n SAP <pre><code>graph LR\n    PROD[\ud83d\ude80 Producci\u00f3n] --&gt; GW[\ud83d\udd04 SAP Gateway]\n    GW --&gt; HANA[\ud83d\udcbe SAP HANA]\n\n    style GW fill:#ff9,stroke:#333,stroke-width:2px</code></pre>"},{"location":"backend/ambientes/#configuraciones","title":"\u2699\ufe0f Configuraciones","text":"Consideraciones por Ambiente Ambiente Uso Consideraciones DEV Desarrollo Testing local, debugging QA Pruebas Validaci\u00f3n, UAT PROD Producci\u00f3n Monitoreo, respaldos"},{"location":"backend/ambientes/#seguridad","title":"\ud83d\udd12 Seguridad","text":"Accesos y Permisos Ambiente Nivel Acceso Autenticaci\u00f3n DEV Desarrollo Azure AD QA Restringido Azure AD PROD Estricto Azure AD + MFA"},{"location":"backend/ambientes/#monitoreo","title":"\ud83d\udcca Monitoreo","text":"Herramientas de Monitoreo Herramienta DEV QA PROD Application Insights \u2705 \u2705 \u2705 Log Analytics \u2705 \u2705 \u2705 Azure Monitor \u274c \u2705 \u2705"},{"location":"backend/ambientes/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Azure Portal</li> <li>SAP Portal</li> <li>Documentaci\u00f3n Azure</li> </ul>"},{"location":"backend/websocket/","title":"\ud83d\udd04 WebSocket con Azure Web PubSub","text":""},{"location":"backend/websocket/#descripcion-general","title":"\ud83d\udce1 Descripci\u00f3n General","text":"<p>Azure Web PubSub Service proporciona comunicaci\u00f3n en tiempo real para la aplicaci\u00f3n Tracmin Extracci\u00f3n y Log\u00edstica.</p> <pre><code>graph LR\n    Client[Cliente Web/M\u00f3vil]\n    AWPS[Azure Web PubSub]\n    Server[Backend]\n\n    Client &lt;--&gt;|WebSocket| AWPS\n    AWPS &lt;--&gt;|Events| Server\n\n    style AWPS fill:#0078D4,stroke:#fff,stroke-width:2px,color:#fff</code></pre>"},{"location":"backend/websocket/#configuracion","title":"\u2699\ufe0f Configuraci\u00f3n","text":""},{"location":"backend/websocket/#1-azure-setup","title":"1\ufe0f\u20e3 Azure Setup","text":"Configuraci\u00f3n Azure <pre><code>const connection_string = \"Endpoint=https://{hub}.webpubsub.azure.com;AccessKey={key};Version=1.0;\"\nconst hub_name = \"tracmin\"\n</code></pre>"},{"location":"backend/websocket/#2-cliente-websocket","title":"2\ufe0f\u20e3 Cliente WebSocket","text":"Configuraci\u00f3n Cliente <pre><code>// websocket.service.ts\nexport class WebSocketService {\n  private client: WebSocket;\n  private url: string;\n\n  constructor() {\n    this.url = await this.getNegotiateUrl();\n  }\n\n  private async getNegotiateUrl(): Promise&lt;string&gt; {\n    const response = await fetch('/api/negotiate', {\n      method: 'GET',\n      headers: {\n        'user-id': getCurrentUserId()\n      }\n    });\n    const data = await response.json();\n    return data.url;\n  }\n\n  connect() {\n    this.client = new WebSocket(this.url);\n    this.setupEventHandlers();\n  }\n}\n</code></pre>"},{"location":"backend/websocket/#eventos","title":"\ud83d\udd0c Eventos","text":""},{"location":"backend/websocket/#tipos-de-eventos","title":"Tipos de Eventos","text":"Eventos Principales <pre><code>enum WSEvents {\n  // Viajes\n  TRIP_STARTED = 'trip:started',\n  TRIP_UPDATED = 'trip:updated',\n  TRIP_COMPLETED = 'trip:completed',\n\n  // Ubicaci\u00f3n\n  LOCATION_UPDATE = 'location:update',\n\n  // Sistema\n  CONNECTION_STATE = 'connection:state',\n  ERROR = 'error'\n}\n</code></pre>"},{"location":"backend/websocket/#manejo-de-eventos","title":"Manejo de Eventos","text":"Event Handlers <pre><code>setupEventHandlers() {\n  this.client.onopen = () =&gt; {\n    console.log('WebSocket Connected');\n    this.connectionState$.next('connected');\n  };\n\n  this.client.onmessage = (event) =&gt; {\n    const data = JSON.parse(event.data);\n    this.handleMessage(data);\n  };\n\n  this.client.onclose = () =&gt; {\n    console.log('WebSocket Disconnected');\n    this.connectionState$.next('disconnected');\n    this.reconnect();\n  };\n}\n</code></pre>"},{"location":"backend/websocket/#reconexion-automatica","title":"\ud83d\udd04 Reconexi\u00f3n Autom\u00e1tica","text":"L\u00f3gica de Reconexi\u00f3n <pre><code>class WebSocketManager {\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private baseDelay = 1000; // 1 segundo\n\n  async reconnect() {\n    if (this.reconnectAttempts &gt;= this.maxReconnectAttempts) {\n      this.handleReconnectFailure();\n      return;\n    }\n\n    const delay = this.calculateBackoff();\n    await this.wait(delay);\n\n    this.reconnectAttempts++;\n    this.connect();\n  }\n\n  private calculateBackoff(): number {\n    return this.baseDelay * Math.pow(2, this.reconnectAttempts);\n  }\n}\n</code></pre>"},{"location":"backend/websocket/#envio-de-mensajes","title":"\ud83d\udce8 Env\u00edo de Mensajes","text":"M\u00e9todos de Env\u00edo <pre><code>// Env\u00edo de ubicaci\u00f3n\nsendLocation(coords: Coordinates) {\n  this.send({\n    type: WSEvents.LOCATION_UPDATE,\n    payload: coords\n  });\n}\n\n// Actualizaci\u00f3n de estado de viaje\nupdateTripStatus(tripId: string, status: TripStatus) {\n  this.send({\n    type: WSEvents.TRIP_UPDATED,\n    payload: { tripId, status }\n  });\n}\n</code></pre>"},{"location":"backend/websocket/#seguridad","title":"\ud83d\udd12 Seguridad","text":"Consideraciones de Seguridad <ul> <li>Tokens de conexi\u00f3n temporales</li> <li>Validaci\u00f3n de usuario por conexi\u00f3n</li> <li>Encriptaci\u00f3n de datos sensibles</li> <li>Rate limiting</li> <li>Monitoreo de conexiones</li> </ul>"},{"location":"backend/websocket/#monitoreo","title":"\ud83d\udcca Monitoreo","text":"M\u00e9tricas Importantes M\u00e9trica Descripci\u00f3n Alerta Conexiones Activas N\u00famero de clientes conectados &gt;1000 Latencia Tiempo de respuesta &gt;500ms Errores Tasa de errores &gt;1% Reconexiones Intentos de reconexi\u00f3n &gt;5/min"},{"location":"backend/websocket/#manejo-de-errores","title":"\u26a0\ufe0f Manejo de Errores","text":"Errores Comunes Error Causa Soluci\u00f3n Token Expirado Sesi\u00f3n caducada Renovar token Conexi\u00f3n Perdida Red inestable Reconexi\u00f3n autom\u00e1tica Rate Limit Demasiadas peticiones Implementar backoff"},{"location":"backend/websocket/#ejemplos-de-uso","title":"\ud83d\udcdd Ejemplos de Uso","text":"Implementaci\u00f3n B\u00e1sica <pre><code>// Inicializar WebSocket\nconst ws = new WebSocketService();\n\n// Suscribirse a eventos\nws.on(WSEvents.TRIP_UPDATED, (data) =&gt; {\n  updateTripUI(data);\n});\n\n// Enviar actualizaci\u00f3n\nws.sendLocation({\n  lat: -33.4569,\n  lng: -70.6483\n});\n</code></pre>"},{"location":"backend/websocket/#debugging","title":"\ud83d\udd0d Debugging","text":"Herramientas de Debug <ul> <li>Azure Portal Metrics</li> <li>Browser DevTools (Network tab)</li> <li>Custom logging</li> <li>WebSocket Inspector</li> </ul>"},{"location":"backend/websocket/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Azure Web PubSub Docs</li> <li>WebSocket API</li> </ul>"},{"location":"backend/bases_de_datos/copias_seguridad/","title":"\ud83d\udcda Copias de seguridad DB Azure","text":""},{"location":"backend/bases_de_datos/copias_seguridad/#creacion-y-restauracion-de-copias-de-seguridad-en-azure","title":"\ud83d\udcc4 Creaci\u00f3n y Restauraci\u00f3n de Copias de Seguridad en Azure","text":"Introducci\u00f3n <ul> <li>Esta documentaci\u00f3n describe el proceso de creaci\u00f3n y  restauraci\u00f3n de copias de seguridad en Azure para bases de datos SQL, incluyendo PITR (Point-in-Time Restore) y copias de seguridad a largo plazo (LTR).</li> </ul>"},{"location":"backend/bases_de_datos/copias_seguridad/#restaurar-db","title":"\ud83d\ude80 Restaurar DB","text":""},{"location":"backend/bases_de_datos/copias_seguridad/#1-creacion-de-copias-de-seguridad","title":"1\ufe0f\u20e3 Creaci\u00f3n de Copias de Seguridad","text":"Configuraci\u00f3n <p>1.1. Copias de seguridad autom\u00e1ticas:</p> <pre><code>- \u2705 Azure SQL Database realiza copias de seguridad de manera autom\u00e1tica sin intervenci\u00f3n manual.\n</code></pre> <p>1.2. Configurar la retenci\u00f3n de copias de seguridad:</p> <pre><code>- \u2705 Iniciar sesi\u00f3n en el portal de Azure: https://portal.azure.com\n- \u2705 Ir a Azure SQL Database y seleccionar la base de datos.\n- \u2705 En informacion general, ir a Propiedades.\n- \u2705 En Propiedades presionar \"Copias de seguridad\".\n- \u2705 Dentro de copias presionar \"Directivas de retenci\u00f3n\".\n- \u2705 Presionar \"Configurar directivas\" y ajustar la configuraci\u00f3n seg\u00fan lo que se necesite.\n</code></pre>"},{"location":"backend/bases_de_datos/copias_seguridad/#2-restauracion-de-copias-de-seguridad","title":"2\ufe0f\u20e3 Restauraci\u00f3n de Copias de Seguridad","text":"<ul> <li>Restauraci\u00f3n desde un punto en el tiempo (PITR)</li> </ul> M\u00e9todo ManualM\u00e9todo PowerShell <pre><code>- \u2705 Ir a Azure SQL Database y seleccionar la base de datos.\n- \u2705 En el men\u00fa superior, hacer clic en Restaurar.\n- \u2705 Elegir la fecha y la hora exacta del punto de restauraci\u00f3n.\n- \u2705 Definir un nuevo nombre para la base de datos restaurada.\n- \u2705 Confirmar y esperar la restauraci\u00f3n.\n</code></pre> <pre><code>Restore-AzSqlDatabase -FromPointInTimeBackup\n-ResourceGroupName \"MiGrupo\"\n-ServerName \"MiServidor\" \n-TargetDatabaseName \"MiBD_Restaurada\"\n-PointInTime \"2024-03-10T12:00:00Z\"\n</code></pre>"},{"location":"backend/bases_de_datos/copias_seguridad/#consideraciones-importantes","title":"\u2699\ufe0f Consideraciones Importantes","text":"<ul> <li>\u2705 Tiempo de restauraci\u00f3n: La restauraci\u00f3n puede tardar minutos u horas dependiendo del tama\u00f1o de la base de datos.</li> <li>\u2705 Restauraci\u00f3n en un nuevo nombre: La base restaurada siempre tendr\u00e1 un nombre diferente al original (renombrar nueva DB).</li> <li>\u2705 Renombrar la DB nueva y eliminar la antigua.</li> <li>\u2705Copias LTR y PITR: Si necesitas restaurar datos anteriores al rango de PITR, usa LTR.</li> </ul>"},{"location":"backend/bases_de_datos/copias_seguridad/#solucion-de-problemas","title":"\u26a0\ufe0f Soluci\u00f3n de Problemas","text":"Problemas Comunes Problema Soluci\u00f3n La restauraci\u00f3n lleva mucho tiempo o parece detenida. Las restauraciones de bases de datos grandes pueden tardar varias horas. Puedes ver el progreso en Portal de Azure \u2192 Monitorizaci\u00f3n. No puedo restaurar la base de datos por falta de permisos. Aseg\u00farate de tener el rol Owner o SQL DB Contributor en el recurso de Azure. La base restaurada no contiene los datos esperados. Revisa el punto de restauraci\u00f3n y selecciona otro m\u00e1s reciente. La opci\u00f3n de restauraci\u00f3n a un punto en el tiempo no aparece o no permite seleccionar una fecha. Verifica en Portal de Azure \u2192 Copia de seguridad si el punto de restauraci\u00f3n est\u00e1 disponible."},{"location":"backend/bases_de_datos/copias_seguridad/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Portal Azure</li> <li>Documentacion copias de seguridad</li> </ul>"},{"location":"backend/levantamiento/windows_linux/","title":"\ud83d\ude80 Gu\u00eda de Configuraci\u00f3n: Entorno de Desarrollo","text":""},{"location":"backend/levantamiento/windows_linux/#requisitos-del-sistema","title":"\ud83d\udcbb Requisitos del Sistema","text":"WindowsLinux Componente Link Azure CLI Descargar \u2b07\ufe0f Functions Core Tools Descargar \u2b07\ufe0f VC++ Redistributable Descargar \u2b07\ufe0f ODBC Driver 17 Descargar \u2b07\ufe0f <pre><code># 1. Azure CLI\ncurl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash\n\n# 2. Functions Core Tools\ncurl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; microsoft.gpg\nsudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg\nsudo sh -c 'echo \"deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-$(lsb_release -cs)-prod $(lsb_release -cs) main\" &gt; /etc/apt/sources.list.d/dotnetdev.list'\nsudo apt-get update\nsudo apt-get install azure-functions-core-tools-4\n\n# 3. ODBC Driver\ncurl https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -\nsudo curl https://packages.microsoft.com/config/ubuntu/$(lsb_release -rs)/prod.list &gt; /etc/apt/sources.list.d/mssql-release.list\nsudo apt-get update\nsudo ACCEPT_EULA=Y apt-get install -y msodbcsql17\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#configuracion-del-entorno","title":"\ud83d\udee0\ufe0f Configuraci\u00f3n del Entorno","text":""},{"location":"backend/levantamiento/windows_linux/#1-autenticacion-azure","title":"1\ufe0f\u20e3 Autenticaci\u00f3n Azure","text":"Windows &amp; Linux <pre><code># Iniciar sesi\u00f3n en Azure\naz login\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#2-configuracion-del-repositorio","title":"2\ufe0f\u20e3 Configuraci\u00f3n del Repositorio","text":"WindowsLinux <pre><code># Clonar repositorio\ngit clone link_del_repositorio\n\n# Copiar archivo local\ncp localonly .\n\n# Configurar entorno Python\npython -m venv venv\n.\\venv\\Scripts\\activate\npip install -r requirements.txt\n</code></pre> <pre><code># Clonar repositorio\ngit clone link_del_repositorio\n\n# Copiar archivo local\ncp Tracmin/localonly .\n\n# Configurar entorno Python\npython -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#3-configuracion-azure-functions","title":"3\ufe0f\u20e3 Configuraci\u00f3n Azure Functions","text":"Windows &amp; Linux <pre><code># Obtener configuraci\u00f3n\nfunc azure functionapp fetch-app-settings elalto\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#4-certificados-https","title":"4\ufe0f\u20e3 Certificados HTTPS","text":"WindowsLinux <pre><code># Generar certificado\n$cert = New-SelfSignedCertificate `\n    -Subject localhost `\n    -DnsName localhost `\n    -FriendlyName \"Functions Development\" `\n    -KeyUsage DigitalSignature `\n    -TextExtension @(\"2.5.29.37={text}1.3.6.1.5.5.7.3.1\")\n\n# Exportar certificado\nExport-PfxCertificate `\n    -Cert $cert `\n    -FilePath certificate.pfx `\n    -Password (ConvertTo-SecureString -String 'password' -Force -AsPlainText)\n</code></pre> <pre><code># HTTPS habilitado por defecto\n# No requiere configuraci\u00f3n adicional\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#iniciar-el-backend","title":"\ud83d\udea6 Iniciar el Backend","text":"WindowsLinux <pre><code>func start --functions AppLogiPath `\n           --useHttps `\n           --cert certificate.pfx `\n           --password 'password'\n</code></pre> <pre><code>func start --functions AppLogiPath --useHttps\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#pruebas","title":"\ud83d\udd0d Pruebas","text":"Ejemplo Postman <pre><code>URL: http://localhost:7071/admin/functions/CargasLoadriteRaw\nM\u00e9todo: POST, GET, etc.\nHeaders: Seg\u00fan el caso\n</code></pre>"},{"location":"backend/levantamiento/windows_linux/#verificacion","title":"\u2705 Verificaci\u00f3n","text":"Lista de Verificaci\u00f3n <ul> <li>[ ] Herramientas instaladas</li> <li>[ ] Azure CLI configurado</li> <li>[ ] Repositorio clonado</li> <li>[ ] Entorno virtual activo</li> <li>[ ] Dependencias instaladas</li> <li>[ ] Backend funcionando</li> </ul>"},{"location":"backend/levantamiento/windows_linux/#solucion-de-problemas","title":"\u26a0\ufe0f Soluci\u00f3n de Problemas","text":"Problemas Comunes Problema Windows Linux Permisos Ejecutar como admin Usar sudo Puertos Verificar 7071 Verificar 7071 SSL Regenerar certificados Verificar configuraci\u00f3n Dependencias Actualizar pip Actualizar apt"},{"location":"backend/levantamiento/windows_linux/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Azure Functions</li> <li>Python en Azure</li> <li>Troubleshooting</li> </ul>"},{"location":"backend/levantamiento/wsl/","title":"\ud83d\udc27 WSL: Linux en Windows","text":""},{"location":"backend/levantamiento/wsl/#por-que-wsl","title":"\ud83c\udfaf \u00bfPor qu\u00e9 WSL?","text":"Ventajas de WSL <ul> <li>Entorno Linux nativo en Windows</li> <li>Mejor rendimiento para desarrollo</li> <li>Compatibilidad con herramientas Linux</li> <li>Integraci\u00f3n perfecta con VS Code</li> <li>Acceso a archivos de Windows</li> </ul>"},{"location":"backend/levantamiento/wsl/#instalacion-y-configuracion","title":"\ud83d\ude80 Instalaci\u00f3n y Configuraci\u00f3n","text":""},{"location":"backend/levantamiento/wsl/#1-preparacion-de-windows","title":"1\ufe0f\u20e3 Preparaci\u00f3n de Windows","text":"Activar Caracter\u00edsticas <ol> <li>Abrir \"Windows Features\"</li> <li>Activar:<ul> <li>\u2705 Virtual Machine Platform</li> <li>\u2705 Windows Hypervisor Platform</li> <li>\u2705 Windows Subsystem for Linux</li> </ul> </li> </ol>"},{"location":"backend/levantamiento/wsl/#2-instalacion-wsl","title":"2\ufe0f\u20e3 Instalaci\u00f3n WSL","text":"M\u00e9todo R\u00e1pidoInstalaci\u00f3n Manual <pre><code>wsl --install\n</code></pre> <pre><code># 1. Habilitar WSL\ndism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart\n\n# 2. Habilitar Plataforma Virtual\ndism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart\n\n# 3. Reiniciar Windows\n\n# 4. Establecer WSL 2 como predeterminado\nwsl --set-default-version 2\n</code></pre>"},{"location":"backend/levantamiento/wsl/#herramientas-esenciales","title":"\ud83d\udee0\ufe0f Herramientas Esenciales","text":""},{"location":"backend/levantamiento/wsl/#3-desarrollo","title":"3\ufe0f\u20e3 Desarrollo","text":"Node.js (NVM)Python (Miniconda)Azure Tools <pre><code># Instalar NVM\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash\n\n# Instalar Node.js\nnvm install node\n</code></pre> <pre><code># Descargar Miniconda\nwget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh\n\n# Instalar\nsh ./Miniconda3-latest-Linux-x86_64.sh\n</code></pre> <pre><code># Azure Functions Core Tools\ncurl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; microsoft.gpg\nsudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg\nsudo sh -c 'echo \"deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-$(lsb_release -cs)-prod $(lsb_release -cs) main\" &gt; /etc/apt/sources.list.d/dotnetdev.list'\nsudo apt-get update\nsudo apt-get install azure-functions-core-tools-4\n</code></pre>"},{"location":"backend/levantamiento/wsl/#vs-code-integration","title":"\ud83d\udcdd VS Code Integration","text":"Configuraci\u00f3n VS Code <ol> <li>Instalar extensi\u00f3n \"WSL\"</li> <li>Comandos \u00fatiles:     <pre><code># Abrir VS Code\ncode .\n\n# Abrir carpeta actual\ncode ./mi-proyecto\n</code></pre></li> </ol>"},{"location":"backend/levantamiento/wsl/#comandos-utiles","title":"\ud83d\udd0d Comandos \u00datiles","text":"Comandos B\u00e1sicos Comando Descripci\u00f3n <code>pwd</code> Directorio actual <code>ls</code> Listar archivos <code>cd</code> Cambiar directorio <code>mkdir</code> Crear carpeta <code>touch</code> Crear archivo Comandos WSL Comando Descripci\u00f3n <code>wsl --list</code> Ver distros instaladas <code>wsl --status</code> Estado de WSL <code>wsl --shutdown</code> Apagar WSL <code>wsl --update</code> Actualizar WSL"},{"location":"backend/levantamiento/wsl/#acceso-a-archivos","title":"\u2699\ufe0f Acceso a Archivos","text":"Sistema de Archivos <ul> <li>Windows desde WSL: <code>/mnt/c/</code></li> <li>WSL desde Windows: <code>\\\\wsl$\\Ubuntu\\home\\usuario</code></li> </ul>"},{"location":"backend/levantamiento/wsl/#verificacion","title":"\u2705 Verificaci\u00f3n","text":"Lista de Verificaci\u00f3n <ul> <li>[ ] WSL instalado y funcionando</li> <li>[ ] VS Code integrado</li> <li>[ ] Node.js/Python configurado</li> <li>[ ] Azure Tools instaladas</li> <li>[ ] Acceso a archivos Windows</li> </ul>"},{"location":"backend/levantamiento/wsl/#solucion-de-problemas","title":"\u26a0\ufe0f Soluci\u00f3n de Problemas","text":"Problemas Comunes Problema Soluci\u00f3n WSL no inicia <code>wsl --shutdown</code> y reiniciar VS Code no conecta Reinstalar extensi\u00f3n WSL Permisos denegados Usar <code>sudo</code> Actualizaci\u00f3n fallida <code>wsl --update</code>"},{"location":"backend/levantamiento/wsl/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Documentaci\u00f3n oficial WSL</li> <li>VS Code con WSL</li> <li>Gu\u00eda de inicio WSL</li> </ul>"},{"location":"backend/sap/draft/","title":"Modo Borrador (Draft Mode) en SAP","text":""},{"location":"backend/sap/draft/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>El Modo Borrador es una caracter\u00edstica que permite validar operaciones sin realizar cambios en la base de datos, ideal para pruebas y validaciones.</p> Caracter\u00edsticas Principales <ul> <li>No modifica la base de datos</li> <li>Valida operaciones</li> <li>Simula respuestas</li> <li>Permite pruebas seguras</li> <li>Disponible en m\u00faltiples servicios</li> </ul>"},{"location":"backend/sap/draft/#implementacion","title":"Implementaci\u00f3n","text":"Sintaxis B\u00e1sicaEjemplo Completo <pre><code>GET /endpoint?draft=true\n</code></pre> <pre><code>GET /b1s/v1/BusinessPartners('C001')?draft=true\n</code></pre>"},{"location":"backend/sap/draft/#casos-de-uso","title":"Casos de Uso","text":"Creaci\u00f3n de Objetos Temporales <pre><code>POST /b1s/v1/BusinessPartners?draft=true\n{\n    \"CardCode\": \"C001\",\n    \"CardName\": \"Cliente Prueba\",\n    \"CardType\": \"cCustomer\"\n}\n</code></pre> Validaci\u00f3n de Relaciones <pre><code>GET /b1s/v1/BusinessPartners('C001')/ContactEmployees?draft=true\n</code></pre> Actualizaci\u00f3n Simulada <pre><code>PATCH /b1s/v1/BusinessPartners('C001')?draft=true\n{\n    \"Phone1\": \"123456789\"\n}\n</code></pre>"},{"location":"backend/sap/draft/#servicios-compatibles","title":"Servicios Compatibles","text":"M\u00f3dulos Principales M\u00f3dulo Disponibilidad Operaciones Business Partners \u2705 Total CRUD Documentos \u2705 Total CRUD Inventario \u2705 Total CRUD Compras \u2705 Total CRUD Ventas \u2705 Total CRUD"},{"location":"backend/sap/draft/#validaciones","title":"Validaciones","text":"Qu\u00e9 se Valida <ol> <li> <p>Estructura de Datos:</p> <ul> <li>Campos requeridos</li> <li>Tipos de datos</li> <li>Longitudes m\u00e1ximas</li> </ul> </li> <li> <p>Reglas de Negocio:</p> <ul> <li>Relaciones entre entidades</li> <li>Restricciones de valores</li> <li>Dependencias</li> </ul> </li> <li> <p>Permisos:</p> <ul> <li>Autorizaciones</li> <li>Roles de usuario</li> <li>Accesos a m\u00f3dulos</li> </ul> </li> </ol>"},{"location":"backend/sap/draft/#ejemplos-practicos","title":"Ejemplos Pr\u00e1cticos","text":"Crear Pedido BorradorValidar Relaciones <pre><code>POST /b1s/v1/Orders?draft=true\n{\n    \"CardCode\": \"C001\",\n    \"DocDueDate\": \"2024-03-20\",\n    \"DocumentLines\": [\n        {\n            \"ItemCode\": \"A001\",\n            \"Quantity\": 10\n        }\n    ]\n}\n</code></pre> <pre><code>GET /b1s/v1/$crossjoin(Orders,Orders/DocumentLines)\n?draft=true\n&amp;$expand=Orders($select=DocEntry),\n         Orders/DocumentLines($select=ItemCode)\n</code></pre> Consideraciones Importantes <ol> <li> <p>Limitaciones:</p> <ul> <li>No genera n\u00fameros de documento</li> <li>No actualiza contadores</li> <li>No crea logs de auditor\u00eda</li> </ul> </li> <li> <p>Rendimiento:</p> <ul> <li>Similar al modo normal</li> <li>No impacta en tiempos de respuesta</li> <li>No consume recursos adicionales</li> </ul> </li> <li> <p>Seguridad:</p> <ul> <li>Requiere mismos permisos</li> <li>Mantiene trazabilidad</li> <li>No compromete datos</li> </ul> </li> </ol> Mejores Pr\u00e1cticas <ol> <li> <p>Uso Recomendado:</p> <ul> <li>Desarrollo de integraciones</li> <li>Pruebas de validaci\u00f3n</li> <li>Verificaci\u00f3n de reglas</li> <li>Simulaci\u00f3n de escenarios</li> </ul> </li> <li> <p>Documentaci\u00f3n:</p> <ul> <li>Documentar pruebas realizadas</li> <li>Mantener casos de prueba</li> <li>Registrar resultados</li> </ul> </li> <li> <p>Mantenimiento:</p> <ul> <li>Actualizar casos de prueba</li> <li>Revisar cambios en reglas</li> <li>Mantener scripts actualizados</li> </ul> </li> </ol>"},{"location":"backend/sap/postman/","title":"Gu\u00eda de Postman para SAP Business Layer","text":""},{"location":"backend/sap/postman/#gestion-de-cookies","title":"Gesti\u00f3n de Cookies","text":"Cookies Importantes <pre><code>B1SESSION: 40e92be0-9142-11ef-8000-fa163ec60aa5\nROUTEID: .node2\n</code></pre> Cookie Descripci\u00f3n Uso B1SESSION Token de sesi\u00f3n Identificaci\u00f3n de sesi\u00f3n activa ROUTEID Nodo del servidor Balance de carga"},{"location":"backend/sap/postman/#configuracion-en-postman","title":"Configuraci\u00f3n en Postman","text":"Autenticaci\u00f3nVariables de EntornoTests Autom\u00e1ticos <pre><code>POST https://servidor:50000/b1s/v1/Login\n{\n    \"CompanyDB\": \"EMPRESA_DB\",\n    \"UserName\": \"USUARIO\",\n    \"Password\": \"CONTRASE\u00d1A\"\n}\n</code></pre> <pre><code>// Pre-request Script\npm.environment.set(\"servidor\", \"mi-sap-server\");\npm.environment.set(\"puerto\", \"50000\");\n</code></pre> <pre><code>// Tests\npm.test(\"Guardar B1SESSION\", function() {\n    pm.environment.set(\"B1SESSION\", \n        pm.cookies.get(\"B1SESSION\"));\n});\n</code></pre>"},{"location":"backend/sap/postman/#consultas-odata","title":"Consultas OData","text":"Filtros B\u00e1sicos <pre><code>GET {{base_url}}/Orders?$filter=DocEntry eq 123\n</code></pre> Ordenamiento <pre><code>GET {{base_url}}/Orders?$orderby=DocEntry desc\n</code></pre> Paginaci\u00f3n <pre><code>GET {{base_url}}/Orders?$skip=20&amp;$top=10\n</code></pre>"},{"location":"backend/sap/postman/#joins-y-consultas-complejas","title":"Joins y Consultas Complejas","text":"$crossjoin B\u00e1sicoFiltros en Joins <pre><code>GET {{base_url}}/$crossjoin(Drafts,Drafts/DocumentLines)\n?$expand=Drafts($select=DocEntry),\n         Drafts/DocumentLines($select=ItemCode)\n</code></pre> <pre><code>GET {{base_url}}/$crossjoin(...)\n?$filter=Drafts/DocEntry eq Drafts/DocumentLines/DocEntry\n</code></pre>"},{"location":"backend/sap/postman/#coleccion-de-ejemplos","title":"Colecci\u00f3n de Ejemplos","text":"Pedidos Recientes <pre><code>GET {{base_url}}/Orders\n?$filter=DocDate ge '2024-01-01'\n&amp;$orderby=DocDate desc\n&amp;$top=10\n</code></pre> Detalles de Cliente <pre><code>GET {{base_url}}/BusinessPartners('C001')\n?$expand=ContactEmployees\n</code></pre>"},{"location":"backend/sap/postman/#manejo-de-errores","title":"Manejo de Errores","text":"C\u00f3digos ComunesScript de Retry C\u00f3digo Descripci\u00f3n Soluci\u00f3n 401 No autorizado Renovar sesi\u00f3n 404 No encontrado Verificar ruta 500 Error interno Contactar soporte <pre><code>// Pre-request Script\nif (pm.response.code === 401) {\n    pm.sendRequest({\n        url: pm.environment.get(\"login_url\"),\n        method: 'POST',\n        header: {'Content-Type': 'application/json'},\n        body: {\n            mode: 'raw',\n            raw: JSON.stringify(loginData)\n        }\n    });\n}\n</code></pre>"},{"location":"backend/sap/postman/#mejores-practicas","title":"Mejores Pr\u00e1cticas","text":"Consideraciones <ol> <li> <p>Sesi\u00f3n:</p> <ul> <li>Guardar cookies autom\u00e1ticamente</li> <li>Manejar expiraci\u00f3n</li> <li>Renovar sesi\u00f3n cuando sea necesario</li> </ul> </li> <li> <p>Rendimiento:</p> <ul> <li>Limitar resultados con $top</li> <li>Usar selecci\u00f3n de campos</li> <li>Optimizar joins</li> </ul> </li> <li> <p>Seguridad:</p> <ul> <li>No compartir cookies</li> <li>Usar variables de entorno</li> <li>Verificar certificados SSL</li> </ul> </li> </ol> Consejos <ul> <li>Organizar colecciones por m\u00f3dulo</li> <li>Documentar ejemplos</li> <li>Usar variables de entorno</li> <li>Implementar tests autom\u00e1ticos</li> <li>Mantener historial de cambios</li> </ul>"},{"location":"backend/sap/que-es-sap/","title":"SAP Business Layer - Documentaci\u00f3n","text":""},{"location":"backend/sap/que-es-sap/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>SAP Business Layer (SAP B1 Service Layer) es una API basada en OData que permite la interacci\u00f3n con SAP Business One a trav\u00e9s de servicios web RESTful.</p> Caracter\u00edsticas Principales <ul> <li>API basada en OData</li> <li>Servicios web RESTful</li> <li>Autenticaci\u00f3n requerida</li> <li>Operaciones CRUD</li> <li>Consultas flexibles</li> </ul>"},{"location":"backend/sap/que-es-sap/#estructura-base","title":"Estructura Base","text":"<pre><code>https://servidor.com:50000/b1s/v1/\n</code></pre> <p>Donde: - <code>servidor.com:50000</code>: Host y puerto del servidor - <code>/b1s/v1/</code>: Versi\u00f3n y punto de entrada</p>"},{"location":"backend/sap/que-es-sap/#operaciones-principales","title":"Operaciones Principales","text":"Autenticaci\u00f3nConsultas B\u00e1sicasOperaciones CRUD <pre><code>POST /b1s/v1/Login\n{\n    \"CompanyDB\": \"NOMBRE_DB\",\n    \"UserName\": \"USUARIO\",\n    \"Password\": \"CONTRASE\u00d1A\"\n}\n</code></pre> Obtener Clientes <pre><code>GET /b1s/v1/BusinessPartners\n</code></pre> Filtrar por Ciudad <pre><code>GET /b1s/v1/BusinessPartners?$filter=City eq 'Santiago'\n</code></pre> Seleccionar Campos <pre><code>GET /b1s/v1/BusinessPartners?$select=CardCode,CardName,City\n</code></pre> Crear (POST) <pre><code>POST /b1s/v1/BusinessPartners\n{\n    \"CardCode\": \"C001\",\n    \"CardName\": \"Cliente Ejemplo\",\n    \"City\": \"Santiago\"\n}\n</code></pre> Leer (GET) <pre><code>GET /b1s/v1/BusinessPartners('C001')\n</code></pre> Actualizar (PATCH) <pre><code>PATCH /b1s/v1/BusinessPartners('C001')\n{\n    \"City\": \"Valpara\u00edso\"\n}\n</code></pre> Eliminar (DELETE) <pre><code>DELETE /b1s/v1/BusinessPartners('C001')\n</code></pre>"},{"location":"backend/sap/que-es-sap/#parametros-odata","title":"Par\u00e1metros OData","text":"Par\u00e1metros Principales Par\u00e1metro Descripci\u00f3n Ejemplo $filter Filtrar resultados <code>?$filter=City eq 'Santiago'</code> $select Seleccionar campos <code>?$select=CardCode,CardName</code> $expand Expandir relaciones <code>?$expand=ContactEmployees</code> $orderby Ordenar resultados <code>?$orderby=CardName desc</code> $top Limitar resultados <code>?$top=10</code> $skip Saltar resultados <code>?$skip=20</code>"},{"location":"backend/sap/que-es-sap/#ejemplos-practicos","title":"Ejemplos Pr\u00e1cticos","text":"Consulta de FacturasCrear Orden de Compra <pre><code>GET /b1s/v1/Invoices?$filter=DocDate ge '2024-01-01'\n</code></pre> <pre><code>POST /b1s/v1/PurchaseOrders\n{\n    \"CardCode\": \"P001\",\n    \"DocDate\": \"2024-03-20\",\n    \"DocumentLines\": [\n        {\n            \"ItemCode\": \"A001\",\n            \"Quantity\": 10\n        }\n    ]\n}\n</code></pre> Consideraciones Importantes <ol> <li> <p>Seguridad:</p> <ul> <li>Mantener seguras las credenciales</li> <li>Usar HTTPS</li> <li>Renovar tokens peri\u00f3dicamente</li> </ul> </li> <li> <p>Rendimiento:</p> <ul> <li>Optimizar consultas</li> <li>Usar paginaci\u00f3n</li> <li>Limitar campos seleccionados</li> </ul> </li> <li> <p>Buenas Pr\u00e1cticas:</p> <ul> <li>Manejar errores apropiadamente</li> <li>Documentar cambios</li> <li>Mantener consistencia en datos</li> </ul> </li> </ol> Recursos Adicionales <ul> <li>Documentaci\u00f3n Oficial SAP</li> <li>Gu\u00eda de OData</li> <li>Ejemplos de Integraci\u00f3n</li> </ul>"},{"location":"backend/tracmin/combustible/","title":"API Combustible - Documentaci\u00f3n (Admin)","text":""},{"location":"backend/tracmin/combustible/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de combustible que permite registrar y consultar el consumo de combustible de la flota. Acceso exclusivo para administradores.</p> Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de combustible</li> <li>Acceso restringido a administradores</li> <li>Modelos principales:     modelos<pre><code>class reqSession(BaseModel):\n    Folio: str\n\nclass reqSessionPostStock(BaseModel):\n    Folio: str\n    Planta: str\n    Patente: str\n    FotoDocumento: str  # Base64\n    WarehouseCodeQuantity: List[WarehouseCodeQuantityItem]\n    UnitPrice: float\n\nclass WarehouseCodeQuantityItem(BaseModel):\n    WarehouseCode: str\n    Quantity: float\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validaci\u00f3n de key de autorizaci\u00f3n</li> <li>Acceso restringido a administradores</li> <li>Validaci\u00f3n de documentos</li> <li>Protecci\u00f3n de datos sensibles</li> <li>Control de acceso a bodegas</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar documentos antes de procesar</li> <li>Mantener registro de transacciones</li> <li>Monitorear niveles de stock</li> <li>Documentar cambios de inventario</li> <li>Notificar eventos importantes</li> </ul> Integraciones <ul> <li>FEBOS:<ul> <li>Consulta de documentos tributarios</li> <li>Validaci\u00f3n de gu\u00edas</li> </ul> </li> <li>SAP:<ul> <li>Control de inventario</li> <li>Registro de movimientos</li> </ul> </li> <li>Azure:<ul> <li>Almacenamiento de documentos</li> <li>Gesti\u00f3n de archivos</li> </ul> </li> <li>Email:<ul> <li>Notificaciones autom\u00e1ticas</li> <li>Alertas de stock</li> </ul> </li> </ul>"},{"location":"backend/tracmin/combustible/#endpoints-combustible","title":"Endpoints Combustible","text":"EndpointsSequence DiagramEjemplos de RespuestaC\u00f3digos de EstadoValidaciones Consultar Gu\u00eda de Combustible POST /api/logipath/get_fuel_guide<pre><code>@router.post(f\"{APP_PATH}/get_fuel_guide\")\nasync def fuel(res: Request, req: reqSession):\n    \"\"\"\n    Obtiene informaci\u00f3n detallada de una gu\u00eda de combustible.\n\n    Args:\n        res (Request): Request con key de autorizaci\u00f3n\n        req (reqSession): Folio de la gu\u00eda\n\n    Returns:\n        dict: {\n            \"documento\": dict,\n            \"tipo_dte\": str,\n            \"folio\": int,\n            \"fecha_emision\": str,\n            \"razon_social_emisor\": str,\n            \"monto_total\": float,\n            \"cantidad\": float,\n            \"PrcItem\": float,\n            \"DirDest\": str,\n            \"CmnaDest\": str,\n            \"CiudadDest\": str\n        }\n\n    Raises:\n        HTTPException: \n            - 401: Si la key es inv\u00e1lida\n            - 500: Error en la consulta\n    \"\"\"\n</code></pre> Consultar Stock de Combustible POST /api/logipath/get_stock_fuel<pre><code>@router.post(f\"{APP_PATH}/get_stock_fuel\")\nasync def fuel(res: Request, req: reqSession):\n    \"\"\"\n    Obtiene el stock actual de combustible por bodega.\n\n    Args:\n        res (Request): Request con key de autorizaci\u00f3n\n        req (reqSession): Datos de consulta\n\n    Returns:\n        dict: {\n            \"bodegas\": [\n                {\n                    \"WarehouseCode\": str,\n                    \"cantidad\": float,\n                    \"WarehouseName\": str,\n                    \"MaximalStock\": float,\n                    \"MinimalStock\": float\n                }\n            ]\n        }\n    \"\"\"\n</code></pre> Registrar Consumo de Combustible POST /api/logipath/post_fuel_stock<pre><code>@router.post(f\"{APP_PATH}/post_fuel_stock\")\nasync def fuel(res: Request, req: reqSessionPostStock):\n    \"\"\"\n    Registra el consumo de combustible y actualiza stock.\n\n    Args:\n        res (Request): Request con key de autorizaci\u00f3n\n        req (reqSessionPostStock): Datos del consumo\n\n    Returns:\n        dict: {\n            \"message\": str,\n            \"IdAzure\": str,\n            \"LinkAzure\": str\n        }\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Admin\n    participant API\n    participant FEBOS\n    participant SAP\n    participant Azure\n    participant Email\n\n    alt Consulta Gu\u00eda\n        Admin-&gt;&gt;API: POST /get_fuel_guide\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;FEBOS: Consultar Gu\u00eda\n        FEBOS--&gt;&gt;API: XML Gu\u00eda\n        API-&gt;&gt;API: Procesar XML\n        API--&gt;&gt;Admin: Datos Gu\u00eda\n\n    else Consulta Stock\n        Admin-&gt;&gt;API: POST /get_stock_fuel\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;SAP: Login\n        SAP--&gt;&gt;API: Token\n        API-&gt;&gt;SAP: Consultar Stock\n        SAP--&gt;&gt;API: Datos Stock\n        API--&gt;&gt;Admin: Stock por Bodega\n\n    else Registrar Consumo\n        Admin-&gt;&gt;API: POST /post_fuel_stock\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;SAP: Actualizar Stock\n\n        par Almacenar Documento\n            API-&gt;&gt;Azure: Subir Foto\n            Azure--&gt;&gt;API: URL Documento\n        and Notificar\n            API-&gt;&gt;Email: Enviar Notificaci\u00f3n\n        end\n\n        API--&gt;&gt;Admin: Confirmaci\u00f3n\n    end</code></pre> Consulta Gu\u00eda <pre><code>{\n    \"documento\": {\n        \"xmlLink\": \"https://api.febos.cl/...\"\n    },\n    \"tipo_dte\": \"33\",\n    \"folio\": \"123456\",\n    \"fecha_emision\": \"2024-03-20\",\n    \"razon_social_emisor\": \"Empresa Combustibles\",\n    \"monto_total\": 150000.00,\n    \"cantidad\": 100.00,\n    \"PrcItem\": 1500.00\n}\n</code></pre> Consulta Stock <pre><code>{\n    \"bodegas\": [\n        {\n            \"WarehouseCode\": \"BOD1017\",\n            \"cantidad\": 5000.00,\n            \"WarehouseName\": \"Estanque Equipos M\u00f3viles\",\n            \"MaximalStock\": 10000.00,\n            \"MinimalStock\": 1000.00\n        }\n    ]\n}\n</code></pre> C\u00f3digo Descripci\u00f3n 200 Operaci\u00f3n exitosa 401 No autorizado 404 Documento no encontrado 500 Error interno Campo Regla Folio Formato v\u00e1lido Cantidad &gt; 0 FotoDocumento Base64 v\u00e1lido WarehouseCode Existente en SAP"},{"location":"backend/tracmin/estructura/","title":"Arquitectura Tracmin Backend - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/estructura/#arquitectura-del-sistema","title":"Arquitectura del Sistema","text":"Tecnolog\u00edas Core <ul> <li>Framework Principal: FastAPI (Python)</li> <li>Base de Datos: SQL Server</li> <li>Base de Datos: SQL Server</li> </ul> Seguridad <ul> <li>Autenticaci\u00f3n JWT</li> <li>Control de roles y permisos</li> <li>Encriptaci\u00f3n de datos sensibles</li> <li>Logs de auditor\u00eda</li> </ul> Escalabilidad <ul> <li>Arquitectura modular</li> <li>Servicios independientes</li> <li>Cache distribuido</li> <li>Balanceo de carga</li> <li>Monitorizaci\u00f3n</li> <li>Logging centralizado</li> <li>M\u00e9tricas de rendimiento</li> </ul> <pre><code>graph TD\n    A[LogiPath API] --&gt; B[SAP ERP]\n    A --&gt; C[Febos]\n    A --&gt; D[Microsoft Graph]\n    A --&gt; E[Azure Services]\n\n    E --&gt; F[WebPubSub]\n    E --&gt; G[Blob Storage]\n    E --&gt; H[Functions]</code></pre>"},{"location":"backend/tracmin/estructura/#modulos-principales","title":"M\u00f3dulos Principales","text":""},{"location":"backend/tracmin/estructura/#1-gestion-de-viajes","title":"1. Gesti\u00f3n de Viajes","text":"<ul> <li><code>Programaci\u00f3n y seguimiento de viajes</code></li> <li><code>Control de estados y ubicaciones</code></li> <li><code>Gesti\u00f3n de conductores y veh\u00edculos</code></li> </ul>"},{"location":"backend/tracmin/estructura/#2-documentacion-electronica","title":"2. Documentaci\u00f3n Electr\u00f3nica","text":"<ul> <li><code>Integraci\u00f3n con SAP para gu\u00edas de despacho</code></li> <li><code>Validaci\u00f3n y control de documentos</code></li> <li><code>Seguimiento de estados documentales</code></li> </ul>"},{"location":"backend/tracmin/estructura/#3-comunicaciones","title":"3. Comunicaciones","text":"<ul> <li><code>Notificaciones en tiempo real (WebPubSub)</code></li> <li><code>Correos autom\u00e1ticos (Microsoft Graph)</code></li> <li><code>Comunicaci\u00f3n bidireccional con conductores</code></li> </ul>"},{"location":"backend/tracmin/estructura/#4-almacenamiento-y-multimedia","title":"4. Almacenamiento y Multimedia","text":"<ul> <li><code>Gesti\u00f3n de im\u00e1genes y documentos</code></li> <li><code>Almacenamiento en Azure Blob</code></li> <li><code>Respaldos y versionamiento</code></li> </ul> <pre><code>sequenceDiagram\n    participant Cliente\n    participant API\n    participant SAP\n    participant Febos\n    participant Azure WebPubSub\n    participant Azure Form Recognizer\n    participant MS Graph\n    participant Azure Blob\n\n    Cliente-&gt;&gt;API: Solicitud de Viaje\n\n    par Proceso de Gu\u00eda\n        API-&gt;&gt;SAP: Creaci\u00f3n de Gu\u00eda\n        SAP--&gt;&gt;API: Confirmaci\u00f3n\n        API-&gt;&gt;Febos: Generaci\u00f3n Folio\n        Febos--&gt;&gt;API: Folio Generado\n    and Notificaciones\n        API-&gt;&gt;Azure WebPubSub: Broadcast Update\n        Azure WebPubSub--&gt;&gt;Cliente: Actualizaci\u00f3n Tiempo Real\n    end\n\n    Cliente-&gt;&gt;API: Upload Ticket/Imagen\n    API-&gt;&gt;Azure Blob: Almacenar Imagen\n    Azure Blob--&gt;&gt;API: URL Imagen\n\n    par Procesamiento Paralelo\n        API-&gt;&gt;Azure Form Recognizer: An\u00e1lisis de Ticket\n        Azure Form Recognizer--&gt;&gt;API: Datos Extra\u00eddos\n    and Notificaciones Email\n        API-&gt;&gt;MS Graph: Env\u00edo Email Confirmaci\u00f3n\n        MS Graph--&gt;&gt;API: Email Enviado\n    end\n\n    API-&gt;&gt;SAP: Actualizaci\u00f3n con Datos de Ticket\n    SAP--&gt;&gt;API: Confirmaci\u00f3n Final\n\n    par Actualizaciones Finales\n        API-&gt;&gt;Azure WebPubSub: Notificar Completado\n        Azure WebPubSub--&gt;&gt;Cliente: Update Final\n    and Email Final\n        API-&gt;&gt;MS Graph: Email Resumen\n        MS Graph--&gt;&gt;Cliente: Confirmaci\u00f3n Email\n    end</code></pre> Dependencias<pre><code>fastapi = \"^0.68.0\"\nsqlalchemy = \"^1.4.23\"\npyjwt = \"^2.1.0\"\nazure-storage-blob = \"^12.8.1\"\nazure-messaging-webpubsub = \"^1.0.0\"\n</code></pre>"},{"location":"backend/tracmin/gps/","title":"API Coordenadas - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/gps/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de tracking que integra m\u00faltiples fuentes de geolocalizaci\u00f3n: proveedores GPS externos, GPS de dispositivos m\u00f3viles y visualizaci\u00f3n de coordenadas para seguimiento en tiempo real.</p> Modelos de Datos modelos<pre><code>class transportistaCoordenadas(BaseModel):\n    Transportista: Optional[str] = None\n    Gps: Optional[str] = None\n    Patente: Optional[str] = None\n    Latitud: Optional[float] = None\n    Longitud: Optional[float] = None\n    Velocidad: Optional[float] = None\n    HoraCoordenada: Optional[str] = None\n\nclass CoordinateRequest(BaseModel):\n    IdProgramado: int\n    RutConductor: str\n    HoraInicioJornada: datetime\n    HoraCoordenada: datetime\n    Longitud: float\n    Latitud: float\n\nclass GetCoordinatesRequest(BaseModel):\n    IdViaje: int\n</code></pre>"},{"location":"backend/tracmin/gps/#endpoints-de-coordenadas","title":"Endpoints de Coordenadas","text":"Webhook GPS ExternosGPS M\u00f3vilConsulta CoordenadasSequence DiagramEjemplos de Respuesta Recibir Coordenadas GPS POST /api/logipath/gps_coords<pre><code>@router.post(f\"{APP_PATH}/gps_coords\")\nasync def get_coords(\n    req: Union[transportistaCoordenadas, List[transportistaCoordenadas]],\n    request: Request\n):\n    \"\"\"\n    Webhook para recibir coordenadas de proveedores GPS externos.\n\n    Args:\n        req: Coordenadas del proveedor GPS\n        request: Request con key de autorizaci\u00f3n\n\n    Returns:\n        dict: {\n            \"status\": 200,\n            \"message\": \"Trip added correctly\"\n        }\n\n    Validaciones:\n        - Key de autorizaci\u00f3n v\u00e1lida\n        - Formato de patente\n        - Existencia del viaje\n    \"\"\"\n</code></pre> Enviar Coordenadas App POST /api/logipath/la_ruta<pre><code>@router.post(f\"{APP_PATH}/la_ruta\")\nasync def post_coordinate(\n    sec: Annotated[str, Depends(security_scheme)],\n    req: CoordinateRequest\n):\n    \"\"\"\n    Registra coordenadas desde el GPS del dispositivo m\u00f3vil.\n\n    Args:\n        sec: Token JWT\n        req: Datos de coordenadas\n\n    Returns:\n        dict: {\"message\": \"coordinate added successfully\"}\n\n    Validaciones:\n        - Token JWT v\u00e1lido\n        - Existencia del viaje\n        - Formato de coordenadas\n    \"\"\"\n</code></pre> Obtener Coordenadas POST /api/logipath/get_coords<pre><code>@router.post(f\"{APP_PATH}/get_coords\")\nasync def get_coords(\n    sec: Annotated[str, Depends(security_scheme)],\n    req: Union[GetCoordinatesRequest, List[GetCoordinatesRequest]]\n):\n    \"\"\"\n    Obtiene coordenadas para visualizaci\u00f3n en mapa.\n\n    Args:\n        sec: Token JWT\n        req: ID(s) de viaje(s)\n\n    Returns:\n        dict: {\n            \"results\": [Lista de coordenadas],\n            \"not_found\": [IDs no encontrados]\n        }\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant GPS Provider\n    participant Mobile App\n    participant API\n    participant DB\n    participant Map View\n\n    par GPS Provider\n        GPS Provider-&gt;&gt;API: POST /gps_coords\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;DB: Guardar Coordenadas\n        API--&gt;&gt;GPS Provider: Confirmaci\u00f3n\n\n    and Mobile App\n        Mobile App-&gt;&gt;API: POST /la_ruta\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Guardar Coordenadas\n        API--&gt;&gt;Mobile App: Confirmaci\u00f3n\n\n    and Map View\n        Map View-&gt;&gt;API: POST /get_coords\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Consultar Coordenadas\n        API--&gt;&gt;Map View: Lista Coordenadas\n    end</code></pre> Webhook GPS <pre><code>{\n    \"status\": 200,\n    \"message\": \"Trip added correctly\"\n}\n</code></pre> Coordenadas App <pre><code>{\n    \"message\": \"coordinate added successfully\"\n}\n</code></pre> Consulta Coordenadas <pre><code>{\n    \"results\": [\n        {\n            \"IdViaje\": 123,\n            \"HoraCoordenada\": \"2024-03-20T10:30:00\",\n            \"Latitud\": -33.4569,\n            \"Longitud\": -70.6483,\n            \"Velocidad\": 60.5,\n            \"Patente\": \"ABCD12\"\n        }\n    ],\n    \"not_found\": []\n}\n</code></pre> Consideraciones de Seguridad <ul> <li>Validaci\u00f3n de fuentes GPS</li> <li>Autenticaci\u00f3n de dispositivos</li> <li>Protecci\u00f3n de datos de ubicaci\u00f3n</li> <li>Control de acceso a coordenadas</li> <li>Encriptaci\u00f3n de comunicaciones</li> </ul> Mejores Pr\u00e1cticas <ol> <li> <p>Validaci\u00f3n de Datos:</p> <ul> <li>Rango de coordenadas v\u00e1lido</li> <li>Timestamps coherentes</li> <li>Velocidades realistas</li> <li>Patentes existentes</li> </ul> </li> <li> <p>Optimizaci\u00f3n:</p> <ul> <li>Filtrado de coordenadas redundantes</li> <li>Compresi\u00f3n de datos</li> <li>Indexaci\u00f3n geoespacial</li> <li>Cach\u00e9 de consultas frecuentes</li> </ul> </li> <li> <p>Monitoreo:</p> <ul> <li>Latencia de webhooks</li> <li>Precisi\u00f3n de coordenadas</li> <li>Frecuencia de actualizaci\u00f3n</li> <li>Cobertura de se\u00f1al</li> </ul> </li> </ol> Detalles T\u00e9cnicos Aspecto Especificaci\u00f3n Formato Coordenadas Decimal Degrees Precisi\u00f3n 6 decimales Timezone UTC Rate Limit 1 req/seg por dispositivo Retenci\u00f3n 30 d\u00edas C\u00f3digos de ErrorIntegraci\u00f3n Mapas C\u00f3digo Descripci\u00f3n 401 No autorizado 404 Viaje no encontrado 422 Coordenadas inv\u00e1lidas 429 Rate limit excedido 500 Error interno <ul> <li>Soporte para m\u00faltiples proveedores</li> <li>Clustering de marcadores</li> <li>Polylines para rutas</li> <li>Geofencing</li> <li>Alertas de desv\u00edo</li> </ul>"},{"location":"backend/tracmin/seguridad/","title":"API Seguridad - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/seguridad/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de autenticaci\u00f3n y autorizaci\u00f3n basado en JWT (JSON Web Tokens) con manejo de roles y permisos espec\u00edficos.</p> Notas Importantes <ul> <li>Sistema de autenticaci\u00f3n y autorizaci\u00f3n basado en JWT (JSON Web Tokens) con manejo de roles y permisos espec\u00edficos.</li> <li>configuracion basica:      configuracion basica<pre><code>SECRET_KEY = os.environ[\"HASH_KEY\"]\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 1440  # 24 horas\n\nsecurity_scheme = OAuth2PasswordBearer(tokenUrl=f\"{APP_PATH}/login\")\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n</code></pre></li> <li>modelos token:     modelos token<pre><code>class Token(BaseModel):\n    access_token: str\n    token_type: str\n\nclass TokenData(BaseModel):\n    nombre: str | None = None\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Mantener SECRET_KEY segura (Key Vault)</li> <li>Usar HTTPS</li> <li>Implementar rate limiting</li> <li>Rotar tokens regularmente</li> <li>Validar inputs</li> <li>Mantener dependencias actualizadas</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Usar variables de entorno</li> <li>Implementar logging de seguridad</li> <li>Manejar errores consistentemente</li> <li>Validar permisos granularmente</li> <li>Mantener tokens con scope m\u00ednimo necesario</li> </ul>"},{"location":"backend/tracmin/seguridad/#endpoints-seguridad","title":"Endpoints Seguridad","text":"<ul> <li><code>POST /api/logipath/login</code></li> <li><code>POST /api/logipath/token_activo_admin</code></li> <li><code>POST /api/logipath/token_activo_user</code></li> </ul> FuncionesSequence Diagram Verificaci\u00f3n de Contrase\u00f1a Verificaci\u00f3n de Contrase\u00f1a<pre><code>    def verify_password(plain_password, hashed_password):\n    \"\"\"\n    Verifica si una contrase\u00f1a en texto plano coincide con su hash.\n\n    Args:\n        plain_password (str): Contrase\u00f1a en texto plano\n        hashed_password (str): Hash de la contrase\u00f1a\n\n    Returns:\n        bool: True si coinciden, False si no\n    \"\"\"\n</code></pre> Generaci\u00f3n de Hash de Contrase\u00f1a Generaci\u00f3n de Hash de Contrase\u00f1a<pre><code>    def get_password_hash(password):\n    \"\"\"\n    Genera un hash seguro de una contrase\u00f1a.\n\n    Args:\n        password (str): Contrase\u00f1a en texto plano\n\n    Returns:\n        str: Hash de la contrase\u00f1a\n    \"\"\"\n</code></pre> Decodificaci\u00f3n y Validaci\u00f3n de Token JWT Decodificaci\u00f3n y Validaci\u00f3n de Token JWT<pre><code>    def decode_jwt(token: str, admin: int) -&gt; Any:\n    \"\"\"\n    Decodifica y valida un token JWT.\n\n    Args:\n        token (str): Token JWT a validar\n        admin (int): Nivel de privilegios requerido (0: usuario, 1-2: admin)\n\n    Returns:\n        TokenData: Datos del token decodificado\n\n    Raises:\n        HTTPException: Si el token es inv\u00e1lido o los privilegios son insuficientes\n    \"\"\"\n</code></pre> Generaci\u00f3n de Token JWT Generaci\u00f3n de Token JWT<pre><code>    def create_access_token(data: dict, expires_delta: timedelta | None = None):\n    \"\"\"\n    Genera un nuevo token JWT.\n\n    Args:\n        data (dict): Datos a incluir en el token\n        expires_delta (timedelta, optional): Tiempo de expiraci\u00f3n\n\n    Returns:\n        str: Token JWT generado\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\nparticipant Cliente\nparticipant API\nparticipant DB\n\nCliente-&gt;&gt;API: POST /login\nAPI-&gt;&gt;DB: Verificar Credenciales\n\nalt Credenciales V\u00e1lidas\n    DB--&gt;&gt;API: Datos Usuario\n    API-&gt;&gt;API: Generar JWT\n    API--&gt;&gt;Cliente: Token\nelse Credenciales Inv\u00e1lidas\n    API--&gt;&gt;Cliente: Error 401\nend\n\nCliente-&gt;&gt;API: Request con Token\nAPI-&gt;&gt;API: Decodificar JWT\n\nalt Token V\u00e1lido\n    API-&gt;&gt;API: Verificar Permisos\n    alt Permisos Suficientes\n        API--&gt;&gt;Cliente: Respuesta\n    else Permisos Insuficientes\n        API--&gt;&gt;Cliente: Error 403\n    end\nelse Token Inv\u00e1lido\n    API--&gt;&gt;Cliente: Error 401\nend</code></pre>"},{"location":"backend/tracmin/admin/camiones/","title":"API Camiones - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/admin/camiones/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de flota que permite crear, modificar y consultar informaci\u00f3n de camiones y acoplados en el sistema.</p> Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de camiones</li> <li>Requiere autenticaci\u00f3n JWT para operaciones</li> <li>Modelo principal:     modelos<pre><code>class DeviceAdminRequest(BaseModel):\n    Patente: Optional[str] = None\n    Id: Optional[int] = None\n    CodigoTransportista: Optional[str] = None\n    Codigo: Optional[str] = None\n    Activo: Optional[bool] = None\n    Acoplado: bool = False\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validar permisos de administrador</li> <li>Validar datos \u00fanicos (Patente)</li> <li>Manejar errores de integridad</li> <li>Validar relaci\u00f3n con transportistas</li> <li>Proteger informaci\u00f3n sensible de la flota</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar formato de patentes</li> <li>Verificar existencia de transportista</li> <li>Implementar logging de cambios</li> <li>Mantener historial de modificaciones</li> <li>Validar estado de activo/inactivo</li> </ul>"},{"location":"backend/tracmin/admin/camiones/#endpoints-camiones","title":"Endpoints Camiones","text":"<ul> <li><code>POST /api/logipath/get_trucks</code></li> <li><code>POST /api/logipath/admin/devices</code></li> </ul> EndpointsSequence DiagramEjemplos de RespuestaC\u00f3digos de Estado Consultar Camiones POST /api/logipath/get_trucks<pre><code>@router.post(f\"{APP_PATH}/get_trucks\")\nasync def get_trucks(sec: Annotated[str, Depends(security_scheme)]):\n    \"\"\"\n    Retorna lista de camiones y acoplados.\n\n    Args:\n        sec (str): Token JWT de autenticaci\u00f3n\n\n    Returns:\n        dict: {\n            \"results\": [Lista de camiones],\n            \"acoplados\": [Lista de acoplados]\n        }\n\n    Raises:\n        HTTPException: Si el token es inv\u00e1lido\n    \"\"\"\n</code></pre> Agregar/Modificar Cami\u00f3n POST /api/logipath/admin/devices<pre><code>@router.post(f\"{APP_PATH}/admin/devices\")\nasync def add_device(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: DeviceAdminRequest\n):\n    \"\"\"\n    Crea o modifica un cami\u00f3n en el sistema.\n\n    Args:\n        sec (str): Token JWT de administrador\n        req (DeviceAdminRequest): Datos del cami\u00f3n\n\n    Returns:\n        dict: {\"message\": \"truck added/edited correctly\"}\n\n    Raises:\n        HTTPException: \n            - 400: Si la patente ya existe\n            - 401: Si el token es inv\u00e1lido\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Cliente\n    participant API\n    participant DB\n\n    alt Consultar Camiones\n        Cliente-&gt;&gt;API: POST /get_trucks\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Query Camiones\n        DB--&gt;&gt;API: Listas\n        API--&gt;&gt;Cliente: Results + Acoplados\n\n    else Crear/Modificar Cami\u00f3n\n        Cliente-&gt;&gt;API: POST /admin/devices\n        API-&gt;&gt;API: Validar JWT Admin\n        API-&gt;&gt;DB: Verificar Patente\n\n        alt Modificaci\u00f3n\n            API-&gt;&gt;DB: Actualizar Cami\u00f3n\n            DB--&gt;&gt;API: Confirmaci\u00f3n\n            API--&gt;&gt;Cliente: Success\n        else Creaci\u00f3n\n            alt Patente Existe\n                API--&gt;&gt;Cliente: Error 400\n            else\n                API-&gt;&gt;DB: Crear Cami\u00f3n\n                DB--&gt;&gt;API: Confirmaci\u00f3n\n                API--&gt;&gt;Cliente: Success\n            end\n        end\n    end</code></pre> Consulta Exitosa <pre><code>{\n    \"results\": [\n        {\n            \"Id\": 1,\n            \"Patente\": \"ABCD12\",\n            \"CodigoTransportista\": \"TRANS1\",\n            \"Codigo\": \"CAM001\",\n            \"Activo\": true,\n            \"Acoplado\": false\n        }\n    ],\n    \"acoplados\": [\n        {\n            \"Id\": 2,\n            \"Patente\": \"WXYZ34\",\n            \"CodigoTransportista\": \"TRANS1\",\n            \"Codigo\": \"ACO001\",\n            \"Activo\": true,\n            \"Acoplado\": true\n        }\n    ]\n}\n</code></pre> Error Patente Duplicada <pre><code>{\n    \"detail\": {\n        \"message\": \"Patente ya existe, por favor elige una Patente diferente\"\n    }\n}\n</code></pre> <ul> <li><code>200</code>: Operaci\u00f3n exitosa</li> <li><code>400</code>: Error de validaci\u00f3n (patente duplicada)</li> <li><code>401</code>: No autorizado</li> <li><code>403</code>: Permisos insuficientes</li> <li><code>500</code>: Error interno del servidor</li> </ul> Validaciones Importantes <ul> <li>Formato de patente seg\u00fan normativa chilena</li> <li>Existencia del c\u00f3digo de transportista</li> <li>Estado activo/inactivo coherente</li> <li>Relaci\u00f3n correcta entre cami\u00f3n y acoplado</li> <li>Unicidad de c\u00f3digos internos</li> </ul>"},{"location":"backend/tracmin/admin/clientes/","title":"API Clientes - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/admin/clientes/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de clientes que permite crear, modificar y consultar informaci\u00f3n de clientes en el sistema.</p> Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de clientes</li> <li>Requiere autenticaci\u00f3n JWT para operaciones</li> <li>Modelo principal:     modelos<pre><code>class clientAdminRequest(BaseModel):\n    Id: Optional[int] = None\n    Rut: Optional[str] = None\n    Codigo: Optional[str] = None\n    Latitud: Optional[float] = None\n    Longitud: Optional[float] = None\n    Direccion: Optional[str] = None\n    Comuna: Optional[str] = None\n    Region: Optional[str] = None\n    Romana: Optional[bool] = None\n    Activo: Optional[bool] = None\n    Mod: Optional[bool] = None\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validar permisos de administrador</li> <li>Validar datos \u00fanicos (Rut)</li> <li>Manejar errores de integridad</li> <li>Validar coordenadas geogr\u00e1ficas</li> <li>Proteger informaci\u00f3n sensible del cliente</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar formato de Rut</li> <li>Validar coordenadas dentro de rangos v\u00e1lidos</li> <li>Implementar logging de cambios</li> <li>Mantener historial de modificaciones</li> <li>Validar datos de direcci\u00f3n</li> </ul>"},{"location":"backend/tracmin/admin/clientes/#endpoints-clientes","title":"Endpoints Clientes","text":"<ul> <li><code>POST /api/logipath/get_clients</code></li> <li><code>POST /api/logipath/admin/clients</code></li> </ul> EndpointsSequence DiagramEjemplos de Respuesta Consultar Clientes POST /api/logipath/get_clients<pre><code>@router.post(f\"{APP_PATH}/get_clients\")\nasync def get_clients(sec: Annotated[str, Depends(security_scheme)]):\n    \"\"\"\n    Retorna lista de todos los clientes registrados.\n\n    Args:\n        sec (str): Token JWT de autenticaci\u00f3n\n\n    Returns:\n        dict: {\n            \"results\": [Lista de clientes]\n        }\n\n    Raises:\n        HTTPException: Si el token es inv\u00e1lido\n    \"\"\"\n</code></pre> Agregar/Modificar Cliente POST /api/logipath/admin/clients<pre><code>@router.post(f\"{APP_PATH}/admin/clients\")\nasync def add_client(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: clientAdminRequest\n):\n    \"\"\"\n    Crea o modifica un cliente en el sistema.\n\n    Args:\n        sec (str): Token JWT de administrador\n        req (clientAdminRequest): Datos del cliente\n\n    Returns:\n        dict: {\"message\": \"usuario agregado/editado correctamente\"}\n\n    Raises:\n        HTTPException: \n            - 400: Si el Rut ya existe\n            - 401: Si el token es inv\u00e1lido\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Cliente\n    participant API\n    participant DB\n\n    alt Consultar Clientes\n        Cliente-&gt;&gt;API: POST /get_clients\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Query Clientes\n        DB--&gt;&gt;API: Lista Clientes\n        API--&gt;&gt;Cliente: Results\n\n    else Crear/Modificar Cliente\n        Cliente-&gt;&gt;API: POST /admin/clients\n        API-&gt;&gt;API: Validar JWT Admin\n        API-&gt;&gt;DB: Verificar Rut\n\n        alt Modificaci\u00f3n\n            API-&gt;&gt;DB: Actualizar Cliente\n            DB--&gt;&gt;API: Confirmaci\u00f3n\n            API--&gt;&gt;Cliente: Success\n        else Creaci\u00f3n\n            alt Rut Existe\n                API--&gt;&gt;Cliente: Error 400\n            else\n                API-&gt;&gt;DB: Crear Cliente\n                DB--&gt;&gt;API: Confirmaci\u00f3n\n                API--&gt;&gt;Cliente: Success\n            end\n        end\n    end</code></pre> Consulta Exitosa <pre><code>{\n    \"results\": [\n        {\n            \"Id\": 1,\n            \"Rut\": \"12345678-9\",\n            \"Codigo\": \"CLI1\",\n            \"Latitud\": -33.4569,\n            \"Longitud\": -70.6483,\n            \"Direccion\": \"Ejemplo 123\",\n            \"Comuna\": \"Santiago\",\n            \"Region\": \"Metropolitana\",\n            \"Romana\": true,\n            \"Activo\": true\n        }\n    ]\n}\n</code></pre> Error Rut Duplicado <pre><code>{\n    \"detail\": {\n        \"message\": \"Cliente ya existe, por favor elige un Rut diferente\"\n    }\n}\n</code></pre>"},{"location":"backend/tracmin/admin/transportistas/","title":"API Transportistas - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/admin/transportistas/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de transportistas que permite crear y consultar informaci\u00f3n de empresas transportistas en el sistema.</p> Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de transportistas</li> <li>Requiere autenticaci\u00f3n JWT para todas las operaciones</li> <li>Modelo principal:     modelos<pre><code>class TransportistaRequest(BaseModel):\n    NombreTransportista: str\n    Rut: str\n    Codigo: str\n    Activo: bool\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validar permisos de administrador</li> <li>Validar datos \u00fanicos (Rut)</li> <li>Manejar errores de integridad</li> <li>Proteger rutas sensibles</li> <li>Validar formato de Rut</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar inputs antes de procesar</li> <li>Manejar errores de forma consistente</li> <li>Implementar logging de operaciones</li> <li>Mantener consistencia en respuestas</li> <li>Documentar c\u00f3digos de error</li> </ul>"},{"location":"backend/tracmin/admin/transportistas/#endpoints-transportistas","title":"Endpoints Transportistas","text":"<ul> <li><code>POST /api/logipath/transportistas</code></li> <li><code>POST /api/logipath/admin/transportistas</code></li> </ul> EndpointsSequence DiagramEjemplos de Respuesta Consultar Transportistas POST /api/logipath/transportistas<pre><code>@router.post(f\"{APP_PATH}/transportistas\")\nasync def return_users(sec: Annotated[str, Depends(security_scheme)]):\n    \"\"\"\n    Retorna lista de todos los transportistas registrados.\n\n    Args:\n        sec (str): Token JWT de autenticaci\u00f3n\n\n    Returns:\n        dict: {\n            \"message\": \"queried successfully\",\n            \"objects\": [Lista de transportistas]\n        }\n\n    Raises:\n        HTTPException: Si el token es inv\u00e1lido o hay error en la consulta\n    \"\"\"\n</code></pre> Agregar Transportista POST /api/logipath/admin/transportistas<pre><code>@router.post(f\"{APP_PATH}/admin/transportistas\")\nasync def add_transportista(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: TransportistaRequest\n):\n    \"\"\"\n    Crea un nuevo transportista en el sistema.\n\n    Args:\n        sec (str): Token JWT de administrador\n        req (TransportistaRequest): Datos del transportista\n\n    Returns:\n        dict: {\"message\": \"transportista agregado correctamente\"}\n\n    Raises:\n        HTTPException: \n            - 400: Si el Rut ya existe\n            - 401: Si el token es inv\u00e1lido\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Cliente\n    participant API\n    participant DB\n\n    alt Consultar Transportistas\n        Cliente-&gt;&gt;API: POST /transportistas\n        API-&gt;&gt;API: Validar JWT\n\n        alt JWT V\u00e1lido\n            API-&gt;&gt;DB: Query Transportistas\n            DB--&gt;&gt;API: Lista Transportistas\n            API--&gt;&gt;Cliente: Success + Lista\n        else JWT Inv\u00e1lido\n            API--&gt;&gt;Cliente: Error 401\n        end\n\n    else Crear Transportista\n        Cliente-&gt;&gt;API: POST /admin/transportistas\n        API-&gt;&gt;API: Validar JWT Admin\n        API-&gt;&gt;DB: Verificar Rut Existente\n\n        alt Rut Existe\n            DB--&gt;&gt;API: Transportista Existente\n            API--&gt;&gt;Cliente: Error 400\n        else Rut No Existe\n            API-&gt;&gt;DB: Crear Transportista\n            DB--&gt;&gt;API: Confirmaci\u00f3n\n            API--&gt;&gt;Cliente: Success\n        end\n    end</code></pre> Consulta Exitosa <pre><code>{\n    \"message\": \"queried successfully\",\n    \"objects\": [\n        {\n            \"NombreTransportista\": \"Empresa 1\",\n            \"Rut\": \"12345678-9\",\n            \"Codigo\": \"EMP1\",\n            \"Activo\": true\n        }\n    ]\n}\n</code></pre> Error Rut Duplicado <pre><code>{\n    \"detail\": {\n        \"message\": \"Rut ya existe, por favor elige un Rut diferente\"\n    }\n}\n</code></pre>"},{"location":"backend/tracmin/admin/usuarios/","title":"API Users - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/admin/usuarios/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de usuarios y transportistas que permite crear, modificar y consultar informaci\u00f3n de usuarios del sistema.</p> Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de usuarios</li> <li>Requiere autenticaci\u00f3n JWT para operaciones administrativas</li> <li>Modelos principales:     modelos<pre><code>class UserAdminRequest(BaseModel):\n    Rut: Optional[str] = None\n    Id: Optional[int] = None\n    CodigoTransportista: Optional[str] = None\n    Nombre: Optional[str] = None\n    Apellido: Optional[str] = None\n    Telefono: Optional[str] = None\n    Email: Optional[str] = None\n    Activo: Optional[bool] = None\n    Admin: Optional[int] = None\n    Contrasena: Optional[str] = None\n    Mod: Optional[bool] = None\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validar permisos de administrador</li> <li>Encriptar contrase\u00f1as</li> <li>Validar datos \u00fanicos (Rut)</li> <li>Manejar errores de integridad</li> <li>Proteger rutas sensibles</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar inputs</li> <li>Manejar errores consistentemente</li> <li>Documentar respuestas de error</li> <li>Implementar logging</li> <li>Mantener consistencia en respuestas</li> </ul>"},{"location":"backend/tracmin/admin/usuarios/#endpoints-users","title":"Endpoints Users","text":"<ul> <li><code>POST /api/logipath/admin/users</code></li> <li><code>POST /api/logipath/users</code></li> </ul> EndpointsSequence Diagram Agregar/Modificar Usuario POST /api/logipath/admin/users<pre><code>@router.post(f\"{APP_PATH}/admin/users\")\nasync def add_user(sec: Annotated[str, Depends(security_scheme)], req: UserAdminRequest):\n    \"\"\"\n    Crea o modifica un usuario en el sistema.\n\n    Args:\n        sec (str): Token JWT de administrador\n        req (UserAdminRequest): Datos del usuario\n\n    Returns:\n        dict: Mensaje de confirmaci\u00f3n\n\n    Raises:\n        HTTPException: Si el Rut ya existe o hay errores de validaci\u00f3n\n    \"\"\"\n</code></pre> Consultar Usuarios POST /api/logipath/users<pre><code>@router.post(f\"{APP_PATH}/users\")\nasync def return_users(req: Request):\n    \"\"\"\n    Retorna lista de usuarios del sistema.\n\n    Args:\n        req (Request): Request con key de autorizaci\u00f3n\n\n    Returns:\n        dict: Lista de usuarios con sus datos\n\n    Raises:\n        HTTPException: Si la key es inv\u00e1lida\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Cliente\n    participant API\n    participant DB\n\n    alt Crear/Modificar Usuario\n        Cliente-&gt;&gt;API: POST /admin/users\n        API-&gt;&gt;API: Validar JWT Admin\n        API-&gt;&gt;DB: Verificar Rut Existente\n\n        alt Rut Existe\n            DB--&gt;&gt;API: Usuario Existente\n            alt Modificaci\u00f3n\n                API-&gt;&gt;DB: Actualizar Usuario\n                DB--&gt;&gt;API: Confirmaci\u00f3n\n                API--&gt;&gt;Cliente: Success\n            else Creaci\u00f3n\n                API--&gt;&gt;Cliente: Error 400\n            end\n        else Rut No Existe\n            API-&gt;&gt;DB: Crear Usuario\n            DB--&gt;&gt;API: Confirmaci\u00f3n\n            API--&gt;&gt;Cliente: Success\n        end\n\n    else Consultar Usuarios\n        Cliente-&gt;&gt;API: POST /users\n        API-&gt;&gt;API: Validar Key\n\n        alt Key V\u00e1lida\n            API-&gt;&gt;DB: Query Usuarios\n            DB--&gt;&gt;API: Lista Usuarios\n            API--&gt;&gt;Cliente: Lista Usuarios\n        else Key Inv\u00e1lida\n            API--&gt;&gt;Cliente: Unauthorized\n        end\n    end</code></pre>"},{"location":"backend/tracmin/fotos/procesamiento_ia/","title":"API Procesamiento IA","text":""},{"location":"backend/tracmin/fotos/procesamiento_ia/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para procesar tickets mediante Azure Form Recognizer, extrayendo informaci\u00f3n relevante y almacen\u00e1ndola en la base de datos.</p> Notas Importantes <ul> <li>Utiliza Azure Form Recognizer para OCR</li> <li>Validaci\u00f3n de tickets duplicados</li> <li>Manejo de diferentes escenarios de cliente</li> <li>Procesamiento de peso y validaciones</li> <li>Almacenamiento estructurado de datos extra\u00eddos</li> </ul> Consideraciones Importantes <ul> <li>El link del blob debe ser accesible</li> <li>El modelo de IA debe estar entrenado</li> <li>Validaciones espec\u00edficas de peso</li> <li>Manejo de casos sin romana</li> <li>Tratamiento de errores de IA</li> <li>Validaciones de Peso:     <pre><code>    # Reglas de validaci\u00f3n\n    if len(peso) &lt;= 6:\n        peso = peso.replace(\".\", \"\")\n    if 20000 &gt;= int(peso) &gt;= 35000:\n        peso = \"PESO NO V\u00c1LIDO\"\n    else:\n        peso = \"PESO NO V\u00c1LIDO\"\n</code></pre></li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar formato de im\u00e1genes</li> <li>Implementar retry logic</li> <li>Monitorear confianza de IA</li> <li>Mantener logs detallados</li> <li>Validar datos extra\u00eddos</li> </ul>"},{"location":"backend/tracmin/fotos/procesamiento_ia/#endpoint-procesamiento-ia","title":"Endpoint Procesamiento IA","text":"<p><code>POST /api/logipath/procesamiento_ia</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D{Verificar Cliente}\n\n    D --&gt;|No Encontrado| E[Crear Ticket Sin Cliente]\n    D --&gt;|Encontrado| F{Tiene Romana?}\n\n    F --&gt;|No| G[Crear Ticket Sin Romana]\n    F --&gt;|Si| H[Procesar con IA]\n\n    H --&gt;|Error| I[Crear Ticket Inv\u00e1lido]\n    H --&gt;|Success| J[Extraer Campos]\n\n    J --&gt; K[Validar Peso]\n    K --&gt; L[Crear Ticket]\n\n    L --&gt; M[Commit DB]\n    M --&gt; N[Return Response]\n\n    E --&gt; N\n    G --&gt; N\n    I --&gt; N</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant Form Recognizer\n    participant DB\n\n    Client-&gt;&gt;API: POST /procesamiento_ia\n    API-&gt;&gt;DB: Verificar Cliente\n\n    alt Cliente con Romana\n        API-&gt;&gt;Form Recognizer: Analizar Documento\n\n        alt An\u00e1lisis Exitoso\n            Form Recognizer--&gt;&gt;API: Datos Extra\u00eddos\n            API-&gt;&gt;API: Validar Peso\n            API-&gt;&gt;DB: Guardar Ticket\n        else Error An\u00e1lisis\n            API-&gt;&gt;DB: Guardar Ticket Inv\u00e1lido\n        end\n\n    else Cliente sin Romana\n        API-&gt;&gt;DB: Guardar Ticket Sin Romana\n    else Cliente No Encontrado\n        API-&gt;&gt;DB: Guardar Ticket Sin Cliente\n    end\n\n    DB--&gt;&gt;API: Commit Success\n    API--&gt;&gt;Client: Response</code></pre>"},{"location":"backend/tracmin/fotos/procesamiento_ia/#1-verificacion-inicial","title":"1. Verificaci\u00f3n Inicial","text":"<ul> <li><code>Validaci\u00f3n del token JWT</code></li> <li><code>B\u00fasqueda del cliente</code></li> <li><code>Verificaci\u00f3n de ticket existente</code></li> </ul>"},{"location":"backend/tracmin/fotos/procesamiento_ia/#2-procesamiento-ia","title":"2. Procesamiento IA","text":"<ul> <li><code>Conexi\u00f3n a Form Recognizer</code></li> <li><code>An\u00e1lisis del documento</code></li> <li><code>Extracci\u00f3n de campos</code></li> <li><code>Validaci\u00f3n de peso</code></li> </ul>"},{"location":"backend/tracmin/fotos/procesamiento_ia/#3-almacenamiento","title":"3. Almacenamiento","text":"<ul> <li><code>Creaci\u00f3n de objeto TripTicket</code></li> <li><code>Persistencia en base de datos</code></li> <li><code>Manejo de casos especiales</code></li> </ul> Estructura de API IA<pre><code>{\n    \"Cliente\": \"string\",\n    \"LinkBlob\": \"string\",\n    \"BlobName\": \"string\"\n}\n</code></pre>"},{"location":"backend/tracmin/fotos/procesamiento_ia/#respuestas","title":"Respuestas","text":"<p>\u00c9xito Con Romana<pre><code>{\n    \"IdTicket\": \"TKTxxxx-1234\",\n    \"status_code\": 200,\n    \"PesoConfirmado\": \"25000\"\n}\n</code></pre> Exito Sin Romana<pre><code>{\n    \"IdTicket\": \"TKTxxxx-1234\",\n    \"status_code\": 200\n}\n</code></pre> Error<pre><code>{\n    \"IdTicket\": \"TKTxxxx-1234\",\n    \"status_code\": 409,\n    \"message\": \"Ticket ya existe\"\n}\n</code></pre></p>"},{"location":"backend/tracmin/fotos/upload_photo/","title":"API Upload Photo","text":""},{"location":"backend/tracmin/fotos/upload_photo/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para subir fotos de tickets/comprobantes asociados a viajes, con almacenamiento en Azure Blob Storage y actualizaci\u00f3n de referencias en la base de datos.</p> Notas Importantes <ul> <li>Requiere autenticaci\u00f3n JWT</li> <li>Manejo autom\u00e1tico de zonas horarias</li> <li>Generaci\u00f3n aleatoria de nombres de blob</li> <li>Almacenamiento en Azure Blob Storage</li> <li>Actualizaci\u00f3n at\u00f3mica en base de datos</li> </ul> Consideraciones Importantes <ul> <li>La imagen debe estar en formato base64</li> <li>El timestamp debe estar en formato compatible</li> <li>El tama\u00f1o m\u00e1ximo de la imagen puede estar limitado</li> <li>La conexi\u00f3n a Azure debe estar configurada</li> <li>El viaje debe existir en la base de datos</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar el formato de la imagen antes del env\u00edo</li> <li>Comprimir im\u00e1genes grandes</li> <li>Implementar retry logic para fallos de Azure</li> <li>Mantener logs detallados  </li> <li>Validar tipos MIME</li> </ul>"},{"location":"backend/tracmin/fotos/upload_photo/#endpoint-upload-photo","title":"Endpoint Upload Photo","text":"<p><code>POST /api/logipath/upload_photo</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D[Decodificar Base64]\n\n    D --&gt; E[Normalizar Timestamp]\n    E --&gt; F[Conectar Azure Blob]\n\n    F --&gt; G[Generar Nombre Blob]\n    G --&gt; H[Upload Imagen]\n\n    H --&gt; I[Buscar Viaje]\n    I --&gt;|No Encontrado| J[Return Not Found]\n    I --&gt;|Encontrado| K[Actualizar IdTicket]\n\n    K --&gt; L[Commit DB]\n    L --&gt; M[Return Success]</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant Azure Blob\n    participant DB\n\n    Client-&gt;&gt;API: POST /upload_photo\n    API-&gt;&gt;API: Validar JWT\n\n    API-&gt;&gt;API: Decodificar Base64\n\n    API-&gt;&gt;Azure Blob: Upload Imagen\n    Azure Blob--&gt;&gt;API: URL Imagen\n\n    API-&gt;&gt;DB: Buscar Viaje\n\n    alt Viaje Encontrado\n        API-&gt;&gt;DB: Actualizar IdTicket\n        DB--&gt;&gt;API: Commit Success\n        API--&gt;&gt;Client: Success + URL\n    else Viaje No Encontrado\n        API--&gt;&gt;Client: Not Found Error\n    end</code></pre>"},{"location":"backend/tracmin/fotos/upload_photo/#1-validacion-y-preparacion","title":"1. Validaci\u00f3n y Preparaci\u00f3n","text":"<ul> <li><code>Verificaci\u00f3n del token JWT</code></li> <li><code>Decodificaci\u00f3n de imagen base64</code></li> <li><code>Normalizaci\u00f3n de timestamp</code></li> </ul>"},{"location":"backend/tracmin/fotos/upload_photo/#2-almacenamiento-en-azure","title":"2. Almacenamiento en Azure","text":"<ul> <li><code>Conexi\u00f3n a Blob Storage</code></li> <li><code>Generaci\u00f3n de nombre \u00fanico</code></li> <li><code>Upload de imagen</code></li> <li><code>Configuraci\u00f3n de content type</code></li> </ul>"},{"location":"backend/tracmin/fotos/upload_photo/#3-actualizacion-en-base-de-datos","title":"3. Actualizaci\u00f3n en Base de Datos","text":"<ul> <li><code>B\u00fasqueda del viaje asociado</code></li> <li><code>Actualizaci\u00f3n de referencia</code></li> <li><code>Commit de cambios</code></li> </ul> Estructura de upload photo<pre><code>{\n    \"data\": \"string (base64)\",\n    \"folio\": \"number\",\n    \"cliente\": \"string\",\n    \"IdProgramado\": \"number\",\n    \"RutConductor\": \"string\",\n    \"HoraInicioJornada\": \"datetime\"\n}\n</code></pre>"},{"location":"backend/tracmin/fotos/upload_photo/#respuestas-posibles","title":"Respuestas Posibles","text":"<p>\u00c9xito<pre><code>{\n    \"blob_name\": \"TKTxxxx-1234\",\n    \"link\": \"https://storage.azure.com/...\",\n    \"status_code\": 200\n}\n</code></pre> No se encontr\u00f3 el viaje<pre><code>{\n    \"message\": \"No se encontr\u00f3 el viaje\"\n}\n</code></pre> Error<pre><code>{\n    \"detail\": \"Mensaje espec\u00edfico del error\",\n    \"status_code\": 500\n}\n</code></pre></p>"},{"location":"backend/tracmin/fotos/upload_photo_pending/","title":"API Subir Foto Pendiente - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/fotos/upload_photo_pending/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para gestionar la carga de fotos pendientes de viajes anteriores, permitiendo asociar im\u00e1genes a viajes hist\u00f3ricos y actualizar su informaci\u00f3n.</p> Notas Importantes <ul> <li>Manejo de fotos pendientes de viajes pasados</li> <li>Almacenamiento en Azure Blob Storage</li> <li>Actualizaci\u00f3n de registros hist\u00f3ricos</li> <li>Manejo de metadatos del viaje</li> <li>Proceso at\u00f3mico de actualizaci\u00f3n</li> </ul> Consideraciones Importantes <ul> <li>La imagen debe estar en formato base64 v\u00e1lido</li> <li>El viaje debe existir en la base de datos</li> <li>Los campos se actualizan de forma selectiva</li> <li>Se genera un nuevo nombre de blob \u00fanico</li> <li>Se mantiene la trazabilidad del viaje original</li> <li>Configuraci\u00f3n Requerida:     Variables de entorno<pre><code>BLOB_CONN_STRING = \"DefaultEndpointsProtocol=https;...\"\nBLOB_CONTAINER_NAME = \"container-name\"\n</code></pre></li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar el formato de la imagen</li> <li>Implementar retry logic para Azure</li> <li>Mantener logs detallados</li> <li>Verificar permisos de actualizaci\u00f3n</li> <li>Validar integridad de datos</li> </ul>"},{"location":"backend/tracmin/fotos/upload_photo_pending/#endpoint-upload-photo-pending","title":"Endpoint Upload Photo Pending","text":"<p><code>POST /api/logipath/upload_photo_pending</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D[Decodificar Base64]\n\n    D --&gt; E[Log Info]\n    E --&gt; F[Conectar Azure Blob]\n\n    F --&gt; G[Generar Nombre Blob]\n    G --&gt; H[Upload Imagen]\n\n    H --&gt; I[Buscar ActualTrip]\n    I --&gt;|No Encontrado| J[Error 404]\n    I --&gt;|Encontrado| K[Extraer Metadata]\n\n    K --&gt; L[Actualizar Campos]\n    L --&gt; M[Commit DB]\n    M --&gt; N[Return Success]</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant Azure Blob\n    participant DB\n\n    Client-&gt;&gt;API: POST /upload_photo_pending\n    API-&gt;&gt;API: Validar JWT\n\n    API-&gt;&gt;API: Decodificar Base64\n    API-&gt;&gt;API: Log Info\n\n    par Upload a Azure\n        API-&gt;&gt;Azure Blob: Upload Imagen\n        Azure Blob--&gt;&gt;API: URL Imagen\n    and B\u00fasqueda en DB\n        API-&gt;&gt;DB: Buscar ActualTrip\n        DB--&gt;&gt;API: Datos del Viaje\n    end\n\n    API-&gt;&gt;API: Extraer Metadata\n    API-&gt;&gt;DB: Actualizar Campos\n    DB--&gt;&gt;API: Commit Success\n\n    API--&gt;&gt;Client: Response con Metadata</code></pre>"},{"location":"backend/tracmin/fotos/upload_photo_pending/#1-validacion-y-preparacion","title":"1. Validaci\u00f3n y Preparaci\u00f3n","text":"<ul> <li><code>Verificaci\u00f3n del token JWT</code></li> <li><code>Decodificaci\u00f3n de imagen base64</code></li> <li><code>Logging de informaci\u00f3n cr\u00edtica</code></li> </ul>"},{"location":"backend/tracmin/fotos/upload_photo_pending/#2-proceso-de-upload","title":"2. Proceso de Upload","text":"<ul> <li><code>Conexi\u00f3n a Azure Blob Storage</code></li> <li><code>Generaci\u00f3n de nombre \u00fanico</code></li> <li><code>Subida de imagen con metadata</code></li> </ul>"},{"location":"backend/tracmin/fotos/upload_photo_pending/#3-actualizacion-de-viaje","title":"3. Actualizaci\u00f3n de Viaje","text":"<ul> <li><code>B\u00fasqueda del viaje hist\u00f3rico</code></li> <li><code>Extracci\u00f3n de metadata</code></li> <li><code>Actualizaci\u00f3n de campos</code></li> <li><code>Commit de cambios</code></li> </ul> Estructura de API viajes<pre><code>{\n    \"data\": \"string (base64)\",\n    \"folio\": \"number\",\n    \"IdProgramado\": \"number\",\n    \"RutConductor\": \"string\",\n    \"Id\": \"number\"\n}\n</code></pre>"},{"location":"backend/tracmin/fotos/upload_photo_pending/#respuestas","title":"Respuestas","text":"<p>\u00c9xito<pre><code>{\n    \"blob_name\": \"TKTxxxx-1234\",\n    \"link\": \"https://storage.azure.com/...\",\n    \"status_code\": 200,\n    \"Cliente\": \"CLIENTE1\",\n    \"HoraInicioJornada\": \"2024-01-01T12:00:00\"\n}\n</code></pre> Error<pre><code>{\n    \"detail\": \"Mensaje espec\u00edfico del error\",\n    \"status_code\": 500\n}\n</code></pre></p>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/","title":"API SAP Guides - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para la cancelaci\u00f3n de gu\u00edas de despacho integrando SAP y base de datos interna.</p> Notas Importantes <ul> <li>La cancelaci\u00f3n crea un documento de devoluci\u00f3n (Return) en SAP</li> <li>Se mantiene registro de todos los estados y errores en GuiaStatus</li> <li>La cancelaci\u00f3n es irreversible una vez completada</li> <li>Se requiere autenticaci\u00f3n (JWT) para acceder al endpoint</li> </ul> Consideraciones de Rendimiento <ul> <li>Las consultas a SAP son as\u00edncronas para optimizar tiempos de respuesta</li> <li>Se implementa un sistema de retry para manejar fallos temporales de conexi\u00f3n</li> <li>Se mantiene un pool de conexiones a la base de datos para mejor rendimiento</li> </ul> Seguridad <ul> <li>Todas las comunicaciones con SAP son encriptadas</li> <li>Se validan todos los inputs para prevenir inyecciones SQL y XSS</li> <li>Los tokens y credenciales son manejados de forma segura</li> <li>Se mantiene un log de auditor\u00eda de todas las operaciones</li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#endpoint-para-cancelar-guias","title":"Endpoint Para Cancelar Gu\u00edas","text":"<p><code>POST /api/logipath/cancel_guide</code></p> Flujo ExplicadoEstados de GuiaStatusFlujo DiagramaFlujo Sequence <pre><code>graph TD\nA[Client] --&gt; B[POST /cancel_guide]\nB --&gt; C{Verificar GuiaStatus}\nC --&gt;|No Existe| D[Error: Gu\u00eda no encontrada]\nC --&gt;|Existe| E[Login SAP]\nE --&gt;|Error| F[Registrar Error Login]\nE --&gt;|Success| G[Buscar Gu\u00eda en SAP]\nG --&gt;|No Existe| H[Registrar Error: No encontrada]\nG --&gt;|Existe| I[Obtener Datos]\nI --&gt; J[Crear Return en SAP]\nJ --&gt;|Error| K[Registrar Error Cancelaci\u00f3n]\nJ --&gt;|Success| L[Actualizar GuiaStatus]\nL --&gt; M[Retornar Respuesta]\n%% Error paths\nD --&gt; N[API Response Error]\nF --&gt; N\nH --&gt; N\nK --&gt; N\n%% Success path\nM --&gt; O[API Response Success]</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant DB\n    participant SAP\n    participant WebPubSub\n\n    Client-&gt;&gt;API: POST /cancel_guide\n\n    API-&gt;&gt;DB: Verificar GuiaStatus\n    DB--&gt;&gt;API: Estado de gu\u00eda\n\n    alt Gu\u00eda no existe\n        API--&gt;&gt;Client: Error: Gu\u00eda no encontrada\n    else Gu\u00eda existe\n        API-&gt;&gt;SAP: Login SAP\n\n        alt Login Error\n            API-&gt;&gt;DB: Registrar error_login_sap\n            API--&gt;&gt;Client: Error: Login SAP fallido\n        else Login Success\n            API-&gt;&gt;SAP: Buscar Gu\u00eda\n\n            alt Gu\u00eda no encontrada en SAP\n                API-&gt;&gt;DB: Registrar error_guia_no_encontrada\n                API--&gt;&gt;Client: Error: Gu\u00eda no existe en SAP\n            else Gu\u00eda encontrada\n                API-&gt;&gt;SAP: Crear Return Document\n\n                alt Error en Return\n                    API-&gt;&gt;DB: Registrar error_proceso_cancelacion\n                    API--&gt;&gt;Client: Error: Fallo en cancelaci\u00f3n\n                else Return Success\n                    API-&gt;&gt;DB: Actualizar estado a guia_anulada\n                    API-&gt;&gt;WebPubSub: Notificar cancelaci\u00f3n\n                    API--&gt;&gt;Client: Success: Gu\u00eda anulada correctamente\n                end\n            end\n        end\n    end</code></pre>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#request-body","title":"Request Body","text":"<pre><code>{\n\"Folio\": number,\n\"Aprobacion\": boolean\n}\n</code></pre>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#1-verificacion-inicial","title":"1. Verificaci\u00f3n Inicial","text":"<ul> <li><code>Busca la gu\u00eda en GuiaStatus por n\u00famero de folio</code></li> <li><code>Valida existencia de la gu\u00eda en el sistema</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#2-proceso-en-sap","title":"2. Proceso en SAP","text":"<ul> <li><code>Login en SAP</code></li> <li><code>B\u00fasqueda de la gu\u00eda en SAP por folio</code></li> <li><code>Obtenci\u00f3n de datos necesarios para la cancelaci\u00f3n</code></li> <li><code>Creaci\u00f3n del documento de devoluci\u00f3n (Return)</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#3-actualizacion-base-de-datos","title":"3. Actualizaci\u00f3n Base de Datos","text":"<ul> <li><code>Actualizaci\u00f3n del estado en GuiaStatus</code></li> <li><code>Registro de la anulaci\u00f3n</code><ul> <li><code>Registro de timestamp de modificaci\u00f3n</code></li> </ul> </li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#4-envio-de-notificacion","title":"4. Env\u00edo de Notificaci\u00f3n","text":"<ul> <li><code>Env\u00edo de notificaci\u00f3n WebPubSub</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#estados-de-guiastatus","title":"Estados de GuiaStatus","text":"<ul> <li><code>guia_anulada</code></li> <li><code>error_login_sap</code></li> <li><code>error_guia_no_encontrada</code></li> <li><code>error_proceso_cancelacion</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#manejo-de-errores","title":"Manejo de Errores","text":"<ul> <li><code>Error de login SAP</code></li> <li><code>Gu\u00eda no encontrada en sistema interno</code></li> <li><code>Gu\u00eda no encontrada en SAP</code></li> <li><code>Errores en proceso de cancelaci\u00f3n</code></li> <li><code>Errores de base de datos</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/cancel-guias/#respuestas","title":"Respuestas","text":"\u00c9xito<pre><code>{\n    \"message\": \"gu\u00eda anulada correctamente\",\n    \"Folio\": \"12345\",\n    \"datalink\": \"https://...\"\n}\n</code></pre> <p>Error<pre><code>{\n    \"message\": \"Error espec\u00edfico\",\n    \"error\": \"Detalle del error\"\n}\n</code></pre> Estructura del Proceso<pre><code>CANCEL_GUIDE/\n\u2502\n\u251c\u2500Verificaci\u00f3n/\n\u2502 \u251c\u2500\u2500 Consulta_GuiaStatus\n\u2502 \u2514\u2500\u2500 Validaci\u00f3n_Existencia\n\u2502\n\u251c\u2500SAP/\n\u2502 \u251c\u2500\u2500 Login\n\u2502 \u251c\u2500\u2500 B\u00fasqueda_Gu\u00eda\n\u2502 \u251c\u2500\u2500 Obtenci\u00f3n_Datos\n\u2502 \u2514\u2500\u2500 Crear_Return\n\u2502\n\u2514\u2500Base_de_Datos/\n\u2514\u2500\u2500 GuiaStatus\n\u251c\u2500\u2500 Actualizaci\u00f3n_Estado\n\u251c\u2500\u2500 Registro_Anulaci\u00f3n\n\u2514\u2500\u2500 Registro_Errores\n</code></pre></p>"},{"location":"backend/tracmin/gu%C3%ADas/correo/","title":"API Correo Gu\u00eda - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/gu%C3%ADas/correo/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de notificaci\u00f3n por correo electr\u00f3nico para enviar enlaces de gu\u00edas de despacho a destinatarios espec\u00edficos utilizando Microsoft Graph API.</p> Modelos y Dependencias <pre><code>from fastapi import APIRouter, Request\nfrom fastapi.responses import JSONResponse\nfrom utils import graph_token\n</code></pre>"},{"location":"backend/tracmin/gu%C3%ADas/correo/#endpoints","title":"Endpoints","text":"Env\u00edo de CorreoEjemplos Enviar Gu\u00eda por Correo POST /api/logipath/correo_guia<pre><code>@router.post(f\"{APP_PATH}/correo_guia\")\nasync def enviar_correo_con_enlace(req: Request):\n    \"\"\"\n    Env\u00eda un correo electr\u00f3nico con un enlace a una gu\u00eda de despacho.\n\n    Args:\n        req (Request): Request con key de autorizaci\u00f3n y datos JSON\n\n    Body JSON:\n        {\n            \"Correo\": \"destinatario@ejemplo.com\",\n            \"Guia\": \"https://url-guia-despacho\"\n        }\n\n    Returns:\n        JSONResponse: {\n            \"status\": \"success|error\",\n            \"message\": str\n        }\n\n    Raises:\n        401: Si la key es inv\u00e1lida\n    \"\"\"\n</code></pre> Request Exitoso <pre><code>{\n    \"Correo\": \"cliente@empresa.com\",\n    \"Guia\": \"https://ejemplo.com/guia/123\"\n}\n</code></pre> Respuesta Exitosa <pre><code>{\n    \"status\": \"success\",\n    \"message\": \"Email enviado correctamente\"\n}\n</code></pre> Error de Autorizaci\u00f3n <pre><code>{\n    \"message\": \"unauthorized\"\n}\n</code></pre> Consideraciones de Seguridad <ul> <li>Validaci\u00f3n de key en headers</li> <li>Autenticaci\u00f3n Microsoft Graph</li> <li>Validaci\u00f3n de correos destinatarios</li> <li>Sanitizaci\u00f3n de enlaces</li> <li>Control de acceso a gu\u00edas</li> </ul> Mejores Pr\u00e1cticas <ol> <li> <p>Validaci\u00f3n:</p> <ul> <li>Formato de correo electr\u00f3nico</li> <li>URLs v\u00e1lidas</li> <li>Permisos de acceso</li> </ul> </li> <li> <p>Monitoreo:</p> <ul> <li>Tasa de entrega</li> <li>Errores de env\u00edo</li> <li>Tiempo de respuesta</li> </ul> </li> <li> <p>Mantenimiento:</p> <ul> <li>Rotaci\u00f3n de tokens</li> <li>Logging de eventos</li> <li>Gesti\u00f3n de errores</li> </ul> </li> </ol> Detalles T\u00e9cnicos Aspecto Especificaci\u00f3n M\u00e9todo POST Auth Header Key Formato JSON Email From notificaciones@tracmin.cl Retry No Timeout 30s C\u00f3digos de Estado C\u00f3digo Descripci\u00f3n 200 Email enviado correctamente 401 No autorizado 500 Error interno"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/","title":"API SAP Guides - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para la creaci\u00f3n y gesti\u00f3n de gu\u00edas de despacho integrando SAP, Febos y base de datos interna.</p> Notas Importantes <ul> <li>El sistema verifica la existencia de gu\u00edas previas antes de crear una nueva</li> <li>Se realiza una doble validaci\u00f3n de folios para evitar duplicados tanto en SAP como en Febos</li> <li>Los campos de peso (NETO, TARA, BRUT) deben ser consistentes entre s\u00ed</li> <li>El sistema maneja zonas horarias, convirtiendo autom\u00e1ticamente entre hora local (Chile) y UTC</li> <li>Se mantiene un registro detallado de estados yerrores en GuiaStatus</li> <li>Las notificaciones WebPubSub son enviadas autom\u00e1ticamente al completar el proceso</li> <li>Los errores en cualquier etapa son registrados y pueden ser consultados posteriormente</li> <li>El proceso es transaccional: si falla en cualquier punto, se revierten los cambios</li> <li>Se requiere autenticaci\u00f3n (JWT) para acceder al endpoint</li> <li>Los documentos generados cumplen con la normativa del SII (Servicio de Impuestos Internos)</li> <li>El sistema maneja autom\u00e1ticamente la reconexi\u00f3n en caso de fallos de red</li> <li>Los tiempos de respuesta pueden variar dependiendo de la disponibilidad de SAP y Febos</li> </ul> Consideraciones de Rendimiento <ul> <li>Las consultas a SAP y Febos son as\u00edncronas para optimizar tiempos de respuesta</li> <li>Se implementa un sistema de retry para manejar fallos temporales de conexi\u00f3n</li> <li>Los documentos pesados (como XMLs) son manejados en memoria de forma eficiente</li> <li>Se mantiene un pool de conexiones a la base dedatos para mejor rendimiento</li> </ul> Seguridad <ul> <li>Todas las comunicaciones con SAP y Febos son encriptadas</li> <li>Se validan todos los inputs para prevenir inyecciones SQL y XSS</li> <li>Los tokens y credenciales son manejados de forma segura</li> <li>Se mantiene un log de auditor\u00eda de todas las operaciones</li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#endpoint-para-crear-guias","title":"Endpoint Para Crear Gu\u00edas","text":"<p><code>POST /api/logipath/sap_guides</code></p> Flujo ExplicadoEstados de GuiaStatusFlujo DiagramaFlujo Sequence <pre><code>sequenceDiagram\n    autonumber\n    participant Client\n    participant API\n    participant SAP\n    participant FEBOS\n    participant DB\n    participant WebPubSub\n\n    Client-&gt;&gt;API: POST /sap_guides\n    API-&gt;&gt;DB: Verificar estado gu\u00eda\n\n    alt Gu\u00eda existe\n        DB--&gt;&gt;API: Retornar gu\u00eda existente\n        API--&gt;&gt;Client: Respuesta con gu\u00eda\n    else No existe\n        API-&gt;&gt;SAP: Login\n        SAP--&gt;&gt;API: Session OK\n        API-&gt;&gt;SAP: Crear gu\u00eda\n        SAP--&gt;&gt;API: Gu\u00eda creada\n\n        API-&gt;&gt;DB: Registrar GuiaStatus\n        DB--&gt;&gt;API: Status registrado\n\n        API-&gt;&gt;FEBOS: Crear gu\u00eda + XML\n\n        alt Success FEBOS\n            FEBOS--&gt;&gt;API: Folio asignado\n            API-&gt;&gt;SAP: Actualizar con folio\n            API-&gt;&gt;FEBOS: Obtener link\n            FEBOS--&gt;&gt;API: Link documento\n            API-&gt;&gt;DB: Actualizar ActualTrip\n            API-&gt;&gt;WebPubSub: Notificar cambios\n        else Error FEBOS\n            API-&gt;&gt;SAP: Cancelar gu\u00eda\n            API-&gt;&gt;DB: Registrar error\n        end\n\n        API--&gt;&gt;Client: Respuesta final\n    end</code></pre>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#1-verificacion-inicial","title":"1. Verificaci\u00f3n Inicial","text":"<ul> <li><code>Verifica si ya existe una gu\u00eda para el viaje</code></li> <li><code>Si existe y est\u00e1 completa, retorna la informaci\u00f3n</code></li> <li><code>Si existe pero est\u00e1 incompleta, intenta completar el proceso</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#2-creacion-en-sap","title":"2. Creaci\u00f3n en SAP","text":"<ul> <li><code>Login en SAP</code></li> <li><code>Creaci\u00f3n de la gu\u00eda con datos b\u00e1sicos</code></li> <li><code>Registro en GuiaStatus como \"guia_creada_sap\"</code></li> <li><code>Obtenci\u00f3n de datos adicionales del cliente y detalles</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#3-creacion-en-febos","title":"3. Creaci\u00f3n en Febos","text":"<ul> <li><code>Generaci\u00f3n del XML</code></li> <li><code>Env\u00edo a Febos para foliar</code></li> <li><code>Verificaci\u00f3n de folio duplicado en SAP</code></li> <li><code>Actualizaci\u00f3n de GuiaStatus seg\u00fan resultado</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#4-actualizacion-en-sap","title":"4. Actualizaci\u00f3n en SAP","text":"<ul> <li><code>Patch con folio y ID de Febos</code></li> <li><code>Obtenci\u00f3n del link de la imagen</code></li> <li><code>Actualizaci\u00f3n de GuiaStatus</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#5-actualizacion-base-de-datos","title":"5. Actualizaci\u00f3n Base de Datos","text":"<ul> <li><code>Actualizaci\u00f3n de ActualTrip con folio y datos de ubicaci\u00f3n</code></li> <li><code>Actualizaci\u00f3n final de GuiaStatus</code></li> <li><code>Env\u00edo de notificaci\u00f3n WebPubSub</code></li> </ul> Estructura de la Gu\u00eda<pre><code>{\n    \"DocType\": \"string\",\n    \"CardCode\": \"string\",\n    \"Address\": \"string\",\n    \"DocTotal\": \"number\",\n    \"Comments\": \"string\",\n    \"JournalMemo\": \"string\",\n    \"ShipToCode\": \"string\",\n    \"Indicator\": \"string\",\n    \"FolioPrefixString\": \"string\",\n    \"ControlAccount\": \"string\",\n    \"U_SEI_PTT\": \"string\",\n    \"U_SEI_RTCH\": \"string\",\n    \"U_SEI_RTTR\": \"string\",\n    \"U_SEI_NCHF\": \"string\",\n    \"U_SEI_IND\": \"string\",\n    \"U_SEI_DocGuiaEnt\": \"number\",\n    \"U_SEI_ROMAN\": \"string\",\n    \"U_SEI_ROMA\": \"string\",\n    \"U_SEI_PATE\": \"string\",\n    \"U_SEI_FEBOSID\": \"string\",\n    \"U_SEI_HUME\": \"number\",\n    \"U_SEI_TEMP\": \"number\",\n    \"U_SEI_NETO\": \"number\",\n    \"U_SEI_TARA\": \"number\",\n    \"U_SEI_BRUT\": \"number\",\n    \"U_SEI_CANB\": \"number\",\n    \"LineNum\": \"number\",\n    \"ItemCode\": \"string\",\n    \"Quantity\": \"number\",\n    \"Price\": \"number\",\n    \"Currency\": \"string\",\n    \"WarehouseCode\": \"string\",\n    \"AccountCode\": \"string\",\n    \"InventoryQuantity\": \"number\",\n    \"CardName\": \"string\",\n    \"ItemDescription\": \"string\",\n    \"U_SEI_ITRS\": \"number\",\n    \"DocDueDate\": \"string\",\n    \"Address2\": \"string\",\n    \"IdViaje\": \"number\",\n    \"IdProgramado\": \"number\",\n    \"RutConductor\": \"string\",\n    \"HoraInicioJornada\": \"datetime\",\n    \"Longitud\": \"number\",\n    \"Latitud\": \"number\",\n    \"HoraFolio\": \"datetime\"\n}\n</code></pre>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#estados-de-guiastatus","title":"Estados de GuiaStatus","text":"<ul> <li><code>guia_creada_sap</code></li> <li><code>error_folio_repetido</code></li> <li><code>error_verificacion_sap</code></li> <li><code>error_patch_sap</code></li> <li><code>error_obtener_link_febos</code></li> <li><code>guia_creada_sin_link</code></li> <li><code>guia_creada_correctamente</code></li> <li><code>error_viaje_no_encontrado</code></li> <li><code>error_actualizacion_viaje</code></li> <li><code>error_general</code></li> <li><code>proceso_completado</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#manejo-de-errores","title":"Manejo de Errores","text":"<ul> <li><code>Errores de conexi\u00f3n SAP</code></li> <li><code>Errores de Febos</code></li> <li><code>Folios duplicados</code></li> <li><code>Errores de base de datos</code></li> <li><code>Errores de actualizaci\u00f3n</code></li> <li><code>Errores generales del proceso</code></li> </ul>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#respuestas","title":"Respuestas","text":"\u00c9xito<pre><code>{\n    \"message\": \"gu\u00eda generada correctamente\",\n    \"FolioNumber\": \"12345\",\n    \"datalink\": \"https://...\"\n}\n</code></pre> Error<pre><code>{\n    \"message\": \"Error espec\u00edfico\",\n    \"error\": \"Detalle del error\"\n}\n</code></pre> Estructura de la API<pre><code>SAP_GUIDES/\n\u2502\n\u251c\u2500Verificaci\u00f3n_Inicial/\n\u2502 \u251c\u2500\u2500 Consulta_GuiaStatus\n\u2502 \u2514\u2500\u2500 Verifica_estado_existente\n\u2502\n\u251c\u2500SAP/\n\u2502 \u251c\u2500\u2500 Login\n\u2502 \u251c\u2500\u2500 Crear_Gu\u00eda\n\u2502 \u251c\u2500\u2500 Obtener_Datos_Cliente\n\u2502 \u2514\u2500\u2500 Patch_Folio\n\u2502\n\u251c\u2500Febos/\n\u2502 \u251c\u2500\u2500 Generar_XML\n\u2502 \u251c\u2500\u2500 Obtener_Folio\n\u2502 \u2514\u2500\u2500 Obtener_Link\n\u2502\n\u251c\u2500Base_de_Datos/\n\u2502 \u251c\u2500\u2500 GuiaStatus\n\u2502 \u2502 \u251c\u2500\u2500 Registro_inicial\n\u2502 \u2502 \u251c\u2500\u2500 Actualizaciones_de_estado\n\u2502 \u2502 \u2514\u2500\u2500 Registro_de_errores\n\u2502 \u2502\n\u2502 \u2514\u2500\u2500 ActualTrip\n\u2502 \u2514\u2500\u2500 Actualizaci\u00f3n_con_folio\n\u2502\n\u2514\u2500Notificaciones/\n\u2514\u2500\u2500 WebPubSub\n</code></pre>"},{"location":"backend/tracmin/gu%C3%ADas/crear-guias/#flujo-api-sap-guides","title":"Flujo API SAP Guides","text":"<pre><code>graph TD\n    %% Main Endpoints\n    A[Client] --&gt; B{API Endpoints}\n    B --&gt; C[POST /sap_guides]\n    B --&gt; D[POST /cancel_guide]\n\n    %% SAP Guides Flow\n    C --&gt; E{Verificar Estado Gu\u00eda}\n    E --&gt;|Gu\u00eda Existe| F[Retornar Gu\u00eda Existente]\n    E --&gt;|No Existe| G[Crear Nueva Gu\u00eda]\n\n    %% Create Guide Flow\n    G --&gt; H[Login SAP]\n    H --&gt; I[Crear Gu\u00eda en SAP]\n    I --&gt; J[Registrar en GuiaStatus]\n    J --&gt; K[Crear Gu\u00eda en FEBOS]\n\n    %% FEBOS Processing\n    K --&gt;|Success| L[Actualizar SAP con Folio]\n    K --&gt;|Error| M[Cancelar en SAP]\n\n    %% Final Steps\n    L --&gt; N[Obtener Link FEBOS]\n    N --&gt; O[Actualizar ActualTrip]\n    O --&gt; P[Enviar WebPubSub]\n\n    %% Cancel Guide Flow\n    D --&gt; Q[Verificar Gu\u00eda]\n    Q --&gt; R[Login SAP]\n    R --&gt; S[Crear Return en SAP]\n    S --&gt; T[Actualizar GuiaStatus]\n\n    %% Status Updates\n    J --&gt; U((DB Updates))\n    L --&gt; U\n    O --&gt; U\n    T --&gt; U\n\n    %% Error Handling\n    M --&gt; V[Error Handler]\n    V --&gt; W[Log Error]\n    W --&gt; X[Update Status]\n\n    %% Response Paths\n    F --&gt; Y[API Response]\n    P --&gt; Y\n    T --&gt; Y\n    X --&gt; Y</code></pre>"},{"location":"backend/tracmin/viajes/api-viajes/","title":"API VIAJES - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/viajes/api-viajes/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>APIs para la gesti\u00f3n del ciclo de vida completo de viajes programados y en ejecuci\u00f3n.</p> Notas Importantes <ul> <li>Sistema de gesti\u00f3n dual: viajes programados (ScheduledTrip) y viajes en ejecuci\u00f3n (ActualTrip)</li> <li>Manejo de zonas horarias entre UTC y hora local de Chile</li> <li>Sistema de estados para seguimiento de ejecuci\u00f3n del viaje</li> <li>Integraci\u00f3n con WebPubSub para notificaciones en tiempo real</li> <li>Validaciones geogr\u00e1ficas para confirmaci\u00f3n de ubicaciones</li> <li>Control de acceso basado en JWT</li> <li>Registro detallado de eventos y cambios de estado</li> </ul>"},{"location":"backend/tracmin/viajes/api-viajes/#endpoint-post-trip","title":"Endpoint Post Trip","text":"<p><code>POST /api/logipath/post_trip</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D{Tiene HoraConfirmacion?}\n\n    D --&gt;|Si| E[Buscar Viaje Existente]\n    D --&gt;|No| F[Crear Nuevo Viaje]\n\n    E --&gt; G{Viaje Encontrado?}\n    G --&gt;|No| H[Error 404]\n    G --&gt;|Si| I[Actualizar Campos]\n\n    I --&gt; J{Tiene HoraFinEntrega?}\n    J --&gt;|Si| K[Marcar Scheduled como Terminado]\n\n    I --&gt; L{Esta Cancelado?}\n    L --&gt;|Si| M[Actualizar Estados]\n\n    F --&gt; N[Crear ActualTrip]\n\n    K --&gt; O[WebPubSub]\n    M --&gt; O\n    N --&gt; O\n\n    O --&gt; P[Respuesta Success]</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant DB\n    participant WebPubSub\n\n    Client-&gt;&gt;API: POST /post_trip\n    API-&gt;&gt;API: Validar JWT\n\n    alt HoraConfirmacion existe\n        API-&gt;&gt;DB: Buscar \u00faltimo viaje\n        DB--&gt;&gt;API: Viaje encontrado\n        API-&gt;&gt;DB: Actualizar campos\n\n        alt HoraFinEntrega presente\n            API-&gt;&gt;DB: Actualizar ScheduledTrip\n        end\n\n        alt Viaje cancelado\n            API-&gt;&gt;DB: Actualizar estados\n        end\n\n    else HoraConfirmacion no existe\n        API-&gt;&gt;DB: Crear nuevo ActualTrip\n    end\n\n    API-&gt;&gt;WebPubSub: Notificar cambios\n    API--&gt;&gt;Client: Respuesta exitosa</code></pre>"},{"location":"backend/tracmin/viajes/api-viajes/#1-verificacion-inicial","title":"1. Verificaci\u00f3n Inicial","text":"<ul> <li><code>Validaci\u00f3n del token JWT</code></li> <li><code>Normalizaci\u00f3n de timestamps (eliminaci\u00f3n de microsegundos)</code></li> <li><code>Verificaci\u00f3n de viaje existente</code></li> </ul>"},{"location":"backend/tracmin/viajes/api-viajes/#2-actualizacion-de-viaje-existente","title":"2. Actualizaci\u00f3n de Viaje Existente","text":"<ul> <li><code>Si existe HoraConfirmacion:</code></li> <li><code>Busca el \u00faltimo viaje del conductor</code></li> <li><code>Actualiza campos no nulos del request</code></li> <li><code>Maneja estados especiales (finalizaci\u00f3n/cancelaci\u00f3n)</code></li> </ul>"},{"location":"backend/tracmin/viajes/api-viajes/#3-creacion-de-nuevo-viaje","title":"3. Creaci\u00f3n de Nuevo Viaje","text":"<ul> <li><code>Si no hay HoraConfirmacion:</code></li> <li><code>Crea nuevo ActualTrip</code></li> <li><code>Asigna valores iniciales</code></li> <li><code>Maneja estados de cancelaci\u00f3n si aplica</code></li> </ul>"},{"location":"backend/tracmin/viajes/api-viajes/#4-notificaciones","title":"4. Notificaciones","text":"<ul> <li><code>Env\u00edo de actualizaciones v\u00eda WebPubSub</code></li> <li><code>Actualizaci\u00f3n de estados en ScheduledTrip relacionado</code></li> </ul> Estructura de API viajes<pre><code>{\n    \"Id\": \"string?\",\n    \"IdProgramado\": \"number\",\n    \"RutConductor\": \"string\",\n    \"HoraInicioJornada\": \"datetime\",\n    \"PlantaOrigen\": \"string?\",\n    \"Cliente\": \"string?\",\n    \"Patente\": \"string?\",\n    \"LatitudInicioJornada\": \"number?\",\n    \"LongitudInicioJornada\": \"number?\",\n    \"HoraConfirmacion\": \"datetime?\",\n    \"TaraViaje\": \"number?\",\n    \"HoraInicioCarga\": \"datetime?\",\n    \"LatitudInicioCarga\": \"number?\",\n    \"LongitudInicioCarga\": \"number?\",\n    \"HoraFinCarga\": \"datetime?\",\n    \"LatitudFinCarga\": \"number?\",\n    \"LongitudFinCarga\": \"number?\",\n    \"HoraPesaje\": \"datetime?\",\n    \"LatitudPesaje\": \"number?\",\n    \"LongitudPesaje\": \"number?\",\n    \"Folio\": \"number?\",\n    \"HoraConfirmacionFolio\": \"datetime?\",\n    \"LongitudConFolio\": \"number?\",\n    \"LatitudConFolio\": \"number?\",\n    \"CantidadPausa\": \"boolean?\",\n    \"HoraLlegadaCliente\": \"datetime?\",\n    \"LatitudLlegadaCliente\": \"number?\",\n    \"LongitudLlegadaCliente\": \"number?\",\n    \"HoraFinEntrega\": \"datetime?\",\n    \"LatitudFinEntrega\": \"number?\",\n    \"LongitudFinEntrega\": \"number?\",\n    \"IdTicket\": \"string?\",\n    \"PesoConfirmadoManual\": \"number?\",\n    \"Cancelado\": \"boolean?\",\n    \"Comentario\": \"string?\",\n    \"Version\": \"string?\"\n}\n</code></pre>"},{"location":"backend/tracmin/viajes/api-viajes/#estados-del-viaje","title":"Estados del Viaje","text":"<ul> <li><code>Inicio Jornada</code></li> <li><code>Confirmaci\u00f3n</code></li> <li><code>Carga</code></li> <li><code>Pesaje</code></li> <li><code>Con Folio</code></li> <li><code>Llegada Cliente</code></li> <li><code>Fin Entrega</code></li> <li><code>Cancelado</code></li> </ul>"},{"location":"backend/tracmin/viajes/api-viajes/#respuestas","title":"Respuestas","text":"<p>\u00c9xito<pre><code>{\n    \"message\": \"trip updated correctly\",\n    \"id\": 12345\n}\n</code></pre> Error<pre><code>{\n    \"detail\": \"Mensaje espec\u00edfico del error\",\n    \"status_code\": 400/401/404/500\n}\n</code></pre></p>"},{"location":"backend/tracmin/viajes/buscar-cancelado/","title":"API BUSCAR CANCELADO - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/viajes/buscar-cancelado/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para verificar el estado de cancelaci\u00f3n de una gu\u00eda/viaje y obtener informaci\u00f3n relevante del viaje activo.</p> Notas Importantes <ul> <li>Endpoint para verificar el estado de cancelaci\u00f3n de una gu\u00eda/viaje y obtener informaci\u00f3n relevante del viaje activo.</li> <li>Normalizaci\u00f3n autom\u00e1tica de timestamps (eliminaci\u00f3n de microsegundos)</li> <li>B\u00fasqueda del viaje m\u00e1s reciente basado en m\u00faltiples criterios</li> <li>Diferenciaci\u00f3n entre viajes cancelados y activos</li> <li>Retorna informaci\u00f3n detallada para viajes activos</li> </ul>"},{"location":"backend/tracmin/viajes/buscar-cancelado/#endpoint-buscar-cancelado","title":"Endpoint Buscar Cancelado","text":"<p><code>POST /api/logipath/search_guide_cancel</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D[Normalizar Timestamp]\n\n    D --&gt; E[Buscar Viaje]\n    E --&gt; F{Viaje Encontrado?}\n\n    F --&gt;|No| G[Error]\n    F --&gt;|Si| H{CantidadPausa = True?}\n\n    H --&gt;|Si| I[Retornar Info Cancelaci\u00f3n]\n    H --&gt;|No| J[Retornar Info Viaje Activo]\n\n    G --&gt; K[Respuesta Error]\n    I --&gt; L[Respuesta]\n    J --&gt; L</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant DB\n\n    Client-&gt;&gt;API: POST /search_guide_cancel\n    API-&gt;&gt;API: Validar JWT\n\n    API-&gt;&gt;API: Normalizar HoraInicioJornada\n\n    API-&gt;&gt;DB: Buscar viaje m\u00e1s reciente\n    DB--&gt;&gt;API: Datos del viaje\n\n    alt CantidadPausa = True\n        API--&gt;&gt;Client: Info viaje cancelado\n    else CantidadPausa = False\n        API--&gt;&gt;Client: Info viaje activo\n    end</code></pre>"},{"location":"backend/tracmin/viajes/buscar-cancelado/#1-verificacion-inicial","title":"1. Verificaci\u00f3n Inicial","text":"<ul> <li><code>Validaci\u00f3n del token JWT</code></li> <li><code>Normalizaci\u00f3n de HoraInicioJornada</code></li> </ul>"},{"location":"backend/tracmin/viajes/buscar-cancelado/#2-busqueda-del-viaje","title":"2. B\u00fasqueda del Viaje","text":"<ul> <li><code>Criterios de b\u00fasqueda:</code><ul> <li><code>IdProgramado</code></li> <li><code>RutConductor</code></li> <li><code>HoraInicioJornada</code></li> </ul> </li> <li><code>Ordenamiento por Id descendente</code></li> <li><code>Selecci\u00f3n del registro m\u00e1s reciente</code></li> </ul>"},{"location":"backend/tracmin/viajes/buscar-cancelado/#3-evaluacion-de-estado","title":"3. Evaluaci\u00f3n de Estado","text":"<ul> <li><code>Verificaci\u00f3n de CantidadPausa</code></li> <li><code>Retorno de informaci\u00f3n seg\u00fan estado</code></li> </ul> Estructura de buscar cancelado<pre><code>{\n    \"IdProgramado\": \"number\",\n    \"RutConductor\": \"string\",\n    \"HoraInicioJornada\": \"datetime\"\n}\n</code></pre>"},{"location":"backend/tracmin/viajes/buscar-cancelado/#respuestas","title":"Respuestas","text":"<p>\u00c9xito<pre><code>{\n    \"message\": \"Viaje Cancelado\",\n    \"IdProgramado\": 12345,\n    \"RutConductor\": \"12345678-9\",\n    \"HoraInicioJornada\": \"2024-01-01T12:00:00\"\n}\n</code></pre> \u00c9xito<pre><code>{\n    \"message\": \"Viaje Activo\",\n    \"Tara\": 1000,\n    \"Id\": 12345,\n    \"horaConfirmacion\": \"2024-01-01T12:30:00\",\n    \"latitud\": -33.4569,\n    \"longitud\": -70.6483\n}\n</code></pre> Error<pre><code>{\n    \"message\": \"Invalid request, please fill all the required fields.\",\n    \"error\": \"Error espec\u00edfico\"\n}\n</code></pre></p>"},{"location":"backend/tracmin/viajes/crear-viaje/","title":"API CREAR VIAJES - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/viajes/crear-viaje/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint para la creaci\u00f3n r\u00e1pida de viajes programados con validaci\u00f3n de duplicados.</p> Notas Importantes <ul> <li>Requiere autenticaci\u00f3n JWT con permisos de administrador</li> <li>L\u00edmite de 3 viajes similares permitidos</li> <li>Validaci\u00f3n de duplicados basada en m\u00faltiples campos</li> <li>Creaci\u00f3n autom\u00e1tica con estados iniciales predefinidos</li> <li>Transacci\u00f3n at\u00f3mica para garantizar consistencia  </li> </ul> Consideraciones Importantes <ul> <li>El l\u00edmite de 3 viajes similares es una medida de seguridad</li> <li>Los viajes se consideran similares si coinciden en todos los campos clave</li> <li>La fecha programada debe estar en UTC</li> <li>Se requieren permisos de administrador para usar este endpoint</li> <li>La transacci\u00f3n es at\u00f3mica para evitar estados inconsistentes (No existe estados intermedios)</li> <li>Los estados iniciales son no modificables en la creaci\u00f3n</li> </ul>"},{"location":"backend/tracmin/viajes/crear-viaje/#endpoint-quick-trip","title":"Endpoint Quick Trip","text":"<p><code>POST /api/logipath/quick_trip</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D[Verificar Admin]\n\n    D --&gt;|No Admin| E[Error 403]\n    D --&gt;|Admin| F[Buscar Viajes Similares]\n\n    F --&gt; G{Cantidad &gt; 3?}\n    G --&gt;|Si| H[Retornar IDs Existentes]\n    G --&gt;|No| I[Crear Nuevo Viaje]\n\n    I --&gt; J[Inicializar Estados]\n    J --&gt; K[Commit DB]\n    K --&gt; L[Respuesta Success]\n\n    H --&gt; M[Respuesta con IDs]</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant DB\n\n    Client-&gt;&gt;API: POST /quick_trip\n    API-&gt;&gt;API: Validar JWT + Admin\n\n    API-&gt;&gt;DB: Buscar viajes similares\n    DB--&gt;&gt;API: Lista de viajes\n\n    alt M\u00e1s de 3 viajes similares\n        API--&gt;&gt;Client: IDs de viajes existentes\n    else Menos de 3 viajes\n        API-&gt;&gt;DB: Crear nuevo ScheduledTrip\n        DB--&gt;&gt;API: Commit successful\n        API--&gt;&gt;Client: Confirmaci\u00f3n de creaci\u00f3n\n    end</code></pre>"},{"location":"backend/tracmin/viajes/crear-viaje/#1-validacion-de-seguridad","title":"1. Validaci\u00f3n de Seguridad","text":"<ul> <li><code>Verificaci\u00f3n de token JWT</code></li> <li><code>Validaci\u00f3n de permisos de administrador</code></li> </ul>"},{"location":"backend/tracmin/viajes/crear-viaje/#2-verificacion-de-duplicados","title":"2. Verificaci\u00f3n de Duplicados","text":"<ul> <li><code>B\u00fasqueda de viajes existentes con criterios m\u00faltiples:</code><ul> <li><code>RutConductor</code></li> <li><code>Cliente</code></li> <li><code>Patente</code></li> <li><code>FechaProgramadaUtc</code></li> <li><code>Programador</code></li> </ul> </li> </ul>"},{"location":"backend/tracmin/viajes/crear-viaje/#3-creacion-del-viaje","title":"3. Creaci\u00f3n del Viaje","text":"<ul> <li><code>Si hay menos de 3 viajes similares:</code><ul> <li><code>Creaci\u00f3n de nuevo ScheduledTrip</code></li> <li><code>Inicializaci\u00f3n de estados</code></li> <li><code>Commit en base de datos</code></li> </ul> </li> </ul> Estructura de API crear viajes<pre><code>{\n    \"FechaProgramadaUtc\": \"datetime\",\n    \"PlantaOrigen\": \"string\",\n    \"Cliente\": \"string\",\n    \"RutConductor\": \"string\",\n    \"Patente\": \"string\",\n    \"Programador\": \"string?\"\n}\n</code></pre>"},{"location":"backend/tracmin/viajes/crear-viaje/#estados-iniciales","title":"Estados Iniciales","text":"<ul> <li><code>Terminado: false</code></li> <li><code>Cancelado: false</code></li> </ul>"},{"location":"backend/tracmin/viajes/crear-viaje/#respuestas","title":"Respuestas","text":"<p>\u00c9xito<pre><code>{\n    \"message\": \"quick trip added successfully\"\n}\n</code></pre> Error Duplicado<pre><code>{\n    \"message\": \"trip is already created\",\n    \"Ids\": [123, 124, 125]\n}\n</code></pre> Error<pre><code>{\n    \"detail\": \"Invalid authentication credentials\",\n    \"status_code\": 401\n}\n</code></pre></p>"},{"location":"backend/tracmin/viajes/pendientes/","title":"API Viajes Pendientes - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/viajes/pendientes/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de viajes pendientes que permite consultar y actualizar el estado de viajes que quedaron incompletos, permitiendo su finalizaci\u00f3n desde el panel administrativo.</p> Notas Importantes <ul> <li>Sistema de gesti\u00f3n de viajes pendientes</li> <li>Requiere autenticaci\u00f3n JWT</li> <li>Modelos principales:     modelos<pre><code>class TripRequest(BaseModel):\n    IdProgramado: int\n    RutConductor: str\n    HoraInicioJornada: datetime\n    HoraFinEntrega: Optional[datetime]\n    Cancelado: Optional[bool]\n    Comentario: Optional[str]\n    # ... otros campos opcionales\n\nclass GetScheduleRequest(BaseModel):\n    RutConductor: str\n</code></pre></li> </ul> Consideraciones Importantes <ul> <li>Per\u00edodo de b\u00fasqueda: 30 d\u00edas o desde 12-08-2024</li> <li>Validaci\u00f3n de estados incompletos</li> <li>Actualizaci\u00f3n at\u00f3mica de estados</li> <li>Manejo de transacciones DB</li> <li>Logging de cambios</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar datos antes de actualizar</li> <li>Mantener consistencia de estados</li> <li>Documentar cambios realizados</li> <li>Verificar permisos de usuario</li> <li>Mantener trazabilidad</li> </ul> Estados de Viaje <ul> <li>Pendiente: <ul> <li>Con Folio</li> <li>Sin peso confirmado</li> <li>Sin pausas registradas</li> </ul> </li> <li>Finalizado:<ul> <li>HoraFinEntrega registrada</li> <li>Viaje programado marcado como terminado</li> </ul> </li> <li>Cancelado:<ul> <li>Estado cancelado actualizado</li> <li>Comentario registrado</li> <li>Viaje programado marcado como terminado</li> </ul> </li> </ul>"},{"location":"backend/tracmin/viajes/pendientes/#endpoints-viajes-pendientes","title":"Endpoints Viajes Pendientes","text":"EndpointsSequence DiagramCriterios de B\u00fasquedaEjemplos de Respuesta Consultar Viajes Pendientes POST /api/logipath/get_pending_trip<pre><code>@router.post(f\"{APP_PATH}/get_pending_trip\")\nasync def get_pending_trip(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: GetScheduleRequest\n):\n    \"\"\"\n    Retorna los viajes pendientes de finalizaci\u00f3n para un conductor espec\u00edfico.\n\n    Args:\n        sec (str): Token JWT\n        req (GetScheduleRequest): Rut del conductor\n\n    Returns:\n        dict: {\n            \"results\": {\n                Informaci\u00f3n detallada del viaje pendiente\n            }\n        }\n\n    Raises:\n        HTTPException: \n            - 404: Si no hay viajes pendientes\n            - 500: Error interno\n    \"\"\"\n</code></pre> Actualizar Viaje Pendiente POST /api/logipath/post_trip_pending<pre><code>@router.post(f\"{APP_PATH}/post_trip_pending\")\nasync def post_trip(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: TripRequest\n):\n    \"\"\"\n    Actualiza el estado de un viaje pendiente.\n\n    Args:\n        sec (str): Token JWT\n        req (TripRequest): Datos de actualizaci\u00f3n del viaje\n\n    Returns:\n        dict: {\"message\": \"Trip updated correctly\"}\n\n    Raises:\n        HTTPException: Si hay error en la actualizaci\u00f3n\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Admin\n    participant API\n    participant DB\n\n    alt Consultar Pendientes\n        Admin-&gt;&gt;API: POST /get_pending_trip\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Query Viajes Pendientes\n\n        alt Viaje Encontrado\n            DB--&gt;&gt;API: Datos Viaje\n            API--&gt;&gt;Admin: Informaci\u00f3n Viaje\n        else Sin Pendientes\n            API--&gt;&gt;Admin: Error 404\n        end\n\n    else Actualizar Pendiente\n        Admin-&gt;&gt;API: POST /post_trip_pending\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Buscar Viaje\n\n        alt Viaje Existe\n            API-&gt;&gt;DB: Actualizar Estados\n            DB--&gt;&gt;API: Confirmaci\u00f3n\n\n            opt Finalizaci\u00f3n\n                API-&gt;&gt;DB: Marcar Programado como Terminado\n            end\n\n            opt Cancelaci\u00f3n\n                API-&gt;&gt;DB: Marcar como Cancelado\n                API-&gt;&gt;DB: Actualizar Comentario\n            end\n\n            API--&gt;&gt;Admin: Success\n        else No Existe\n            API--&gt;&gt;Admin: \"Trip not found\"\n        end\n    end</code></pre> Campo Descripci\u00f3n Folio No nulo HoraConfirmacionFolio &gt;= start_date PesoConfirmadoManual Nulo CantidadPausa Nulo Consulta Viaje Pendiente <pre><code>{\n    \"results\": {\n        \"Id\": 1,\n        \"IdProgramado\": 100,\n        \"PlantaOrigen\": \"Planta A\",\n        \"Cliente\": \"Cliente X\",\n        \"RutConductor\": \"12345678-9\",\n        \"Patente\": \"ABCD12\",\n        \"HoraInicioJornada\": \"2024-03-20T08:00:00\",\n        \"Folio\": \"F001\",\n        \"Comentario\": \"PendingTrip\"\n    }\n}\n</code></pre> Actualizaci\u00f3n Exitosa <pre><code>{\n    \"message\": \"Trip updated correctly\"\n}\n</code></pre>"},{"location":"backend/tracmin/viajes/post-trip-tara/","title":"API VIAJES TARA - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/viajes/post-trip-tara/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Endpoint espec\u00edfico para actualizar la tara de un viaje y gestionar la transici\u00f3n a la etapa de carga.</p> Notas Importantes <ul> <li>Conversi\u00f3n autom\u00e1tica de zona horaria Chile a UTC</li> <li>Notificaci\u00f3n en tiempo real v\u00eda WebPubSub</li> <li>Actualizaci\u00f3n selectiva de campos no nulos</li> <li>Manejo de errores en notificaciones sin afectar la transacci\u00f3n principal</li> <li>Requiere autenticaci\u00f3n JWT sin permisos de administrador</li> </ul> Consideraciones Importantes <ul> <li>La conversi\u00f3n de zona horaria es cr\u00edtica para la consistencia de datos</li> <li>El WebPubSub puede fallar sin afectar la actualizaci\u00f3n del viaje</li> <li>Los campos no proporcionados se mantienen sin cambios</li> <li>La respuesta es exitosa incluso si falla la notificaci\u00f3n WebPubSub</li> <li>Se requiere manejo especial de microsegundos para compatibilidad con la base de datos</li> </ul>"},{"location":"backend/tracmin/viajes/post-trip-tara/#endpoint-post-trip-tara","title":"Endpoint Post Trip Tara","text":"<p><code>POST /api/logipath/post_trip_tara</code></p> Flujo ExplicadoEstados y RespuestasFlujo DiagramaSequence Diagram <pre><code>graph TD\n    A[Cliente] --&gt; B{Validar JWT}\n    B --&gt;|Invalid| C[Error 401]\n    B --&gt;|Valid| D[Convertir Hora a UTC]\n\n    D --&gt; E[Normalizar Timestamps]\n    E --&gt; F[Buscar Viaje]\n\n    F --&gt;|No encontrado| G[Error 404]\n    F --&gt;|Encontrado| H[Actualizar Campos]\n\n    H --&gt; I[Commit DB]\n    I --&gt; J{Enviar WebPubSub}\n\n    J --&gt;|Error| K[Log Error]\n    J --&gt;|Success| L[Continue]\n\n    K --&gt; M[Respuesta Success]\n    L --&gt; M</code></pre> <pre><code>sequenceDiagram\n    participant Client\n    participant API\n    participant DB\n    participant WebPubSub\n\n    Client-&gt;&gt;API: POST /post_trip_tara\n    API-&gt;&gt;API: Validar JWT\n\n    API-&gt;&gt;API: Convertir hora a UTC\n    API-&gt;&gt;API: Normalizar timestamps\n\n    API-&gt;&gt;DB: Buscar viaje\n    DB--&gt;&gt;API: Viaje encontrado\n\n    API-&gt;&gt;DB: Actualizar campos\n    DB--&gt;&gt;API: Commit successful\n\n    API-&gt;&gt;WebPubSub: Notificar \"pantallaCarga\"\n\n    alt Error WebPubSub\n        WebPubSub--&gt;&gt;API: Error\n        API-&gt;&gt;API: Log error\n    end\n\n    API--&gt;&gt;Client: Respuesta exitosa</code></pre>"},{"location":"backend/tracmin/viajes/post-trip-tara/#1-verificacion-inicial","title":"1. Verificaci\u00f3n Inicial","text":"<ul> <li><code>Validaci\u00f3n del token JWT</code></li> <li><code>Normalizaci\u00f3n de timestamps (eliminaci\u00f3n de microsegundos)</code></li> <li><code>Conversi\u00f3n de HoraInicioJornada a UTC</code></li> </ul>"},{"location":"backend/tracmin/viajes/post-trip-tara/#2-actualizacion-de-viaje-existente","title":"2. Actualizaci\u00f3n de Viaje Existente","text":"<ul> <li><code>B\u00fasqueda del viaje por identificadores \u00fanicos:</code><ul> <li><code>IdProgramado</code></li> <li><code>RutConductor</code></li> <li><code>HoraInicioJornada</code></li> </ul> </li> <li><code>Actualizaci\u00f3n selectiva de campos no nulos</code></li> <li><code>Commit de cambios en la base de datos</code></li> </ul>"},{"location":"backend/tracmin/viajes/post-trip-tara/#3-notificacion","title":"3. Notificaci\u00f3n","text":"<ul> <li><code>Env\u00edo de se\u00f1al \"pantallaCarga\" v\u00eda WebPubSub</code></li> <li><code>Manejo de errores de notificaci\u00f3n sin afectar la transacci\u00f3n principal</code></li> </ul> Estructura de API viajes<pre><code>{\n    \"IdProgramado\": \"number\",\n    \"RutConductor\": \"string\",\n    \"HoraInicioJornada\": \"datetime\",\n    \"TaraViaje\": \"number\",\n    \"HoraConfirmacion\": \"datetime\",\n    \"LatitudInicioJornada\": \"number?\",\n    \"LongitudInicioJornada\": \"number?\",\n}\n</code></pre>"},{"location":"backend/tracmin/viajes/post-trip-tara/#respuestas","title":"Respuestas","text":"<p>\u00c9xito<pre><code>{\n    \"message\": \"trip updated correctly\"\n}\n</code></pre> Error JWT<pre><code>{\n    \"detail\": \"Invalid authentication credentials\",\n    \"status_code\": 401\n}\n</code></pre> Error Trip<pre><code>{\n    \"detail\": \"Trip not found\",\n    \"status_code\": 404\n}\n</code></pre></p>"},{"location":"backend/tracmin/viajes/programados_realizados/","title":"API Viajes Programados - Documentaci\u00f3n","text":""},{"location":"backend/tracmin/viajes/programados_realizados/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de viajes programados que permite consultar y administrar viajes programados, con diferentes niveles de acceso para administradores y conductores.</p> Notas Importantes <ul> <li>Sistema de gesti\u00f3n de viajes programados</li> <li>Diferentes niveles de acceso (admin/conductor)</li> <li>Modelos principales:     modelos<pre><code>class GetScheduleRequest(BaseModel):\n    RutConductor: str\n\nclass CancelScheduledRequest(BaseModel):\n    Id: int\n    Comentario: Optional[str] = None\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validar permisos de usuario vs admin</li> <li>Validar existencia de viajes</li> <li>Manejar estados de cancelaci\u00f3n</li> <li>Proteger informaci\u00f3n sensible</li> <li>Validar tokens JWT seg\u00fan rol</li> </ul>"},{"location":"backend/tracmin/viajes/programados_realizados/#endpoints-viajes-programados","title":"Endpoints Viajes Programados","text":"Endpoints AdministrativosEndpoints ConductoresSequence DiagramEjemplos de RespuestaDiferencias por Rol Listar Todos los Viajes Programados (Admin) POST /api/logipath/scheduled_trips<pre><code>@router.post(f\"{APP_PATH}/scheduled_trips\")\nasync def scheduled_trips(sec: Annotated[str, Depends(security_scheme)]):\n    \"\"\"\n    Retorna todos los viajes programados para visualizaci\u00f3n administrativa.\n    Requiere permisos de administrador.\n\n    Args:\n        sec (str): Token JWT de administrador\n\n    Returns:\n        dict: {\n            \"results\": [\n                {\n                    \"Id\": int,\n                    \"FechaProgramadaUtc\": datetime,\n                    \"PlantaOrigen\": str,\n                    \"Cliente\": str,\n                    \"Programador\": str,\n                    \"RutConductor\": str,\n                    \"Patente\": str,\n                    \"Terminado\": bool,\n                    \"Cancelado\": bool,\n                    \"Comentario\": str,\n                    \"CodigoTransportista\": str,\n                    \"UserName\": str\n                }\n            ]\n        }\n\n    Raises:\n        HTTPException: \n            - 404: Si no hay viajes programados\n            - 401: Si el token es inv\u00e1lido\n            - 403: Si no tiene permisos de admin\n    \"\"\"\n</code></pre> Cancelar Viaje Programado POST /api/logipath/cancel_scheduled<pre><code>@router.post(f\"{APP_PATH}/cancel_scheduled\")\nasync def cancel_scheduled(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: CancelScheduledRequest\n):\n    \"\"\"\n    Cancela un viaje programado espec\u00edfico.\n\n    Args:\n        sec (str): Token JWT de autenticaci\u00f3n\n        req (CancelScheduledRequest): ID del viaje y comentario opcional\n\n    Returns:\n        dict: {\"message\": \"scheduled_trip Id:{id} cancelled successfully\"}\n    \"\"\"\n</code></pre> Consultar Viajes Asignados (Conductor) POST /api/logipath/get_schedule<pre><code>@router.post(f\"{APP_PATH}/get_schedule\")\nasync def get_schedule(\n    sec: Annotated[str, Depends(security_scheme)], \n    req: GetScheduleRequest\n):\n    \"\"\"\n    Retorna los viajes programados para un conductor espec\u00edfico.\n\n    Args:\n        sec (str): Token JWT del conductor\n        req (GetScheduleRequest): Rut del conductor\n\n    Returns:\n        dict: {\"results\": [Lista de viajes programados]}\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Admin\n    participant Conductor\n    participant API\n    participant DB\n\n    alt Vista Administrativa\n        Admin-&gt;&gt;API: POST /scheduled_trips\n        API-&gt;&gt;API: Validar JWT Admin\n        API-&gt;&gt;DB: Query Todos los Viajes\n        DB-&gt;&gt;DB: Join con Users\n        DB--&gt;&gt;API: Viajes + Info Usuario\n        API--&gt;&gt;Admin: Lista Completa\n\n    else Vista Conductor\n        Conductor-&gt;&gt;API: POST /get_schedule\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Query Viajes del Conductor\n        DB--&gt;&gt;API: Viajes Filtrados\n        API--&gt;&gt;Conductor: Viajes Asignados\n\n    else Cancelaci\u00f3n\n        Admin-&gt;&gt;API: POST /cancel_scheduled\n        API-&gt;&gt;API: Validar JWT\n        API-&gt;&gt;DB: Actualizar Estado\n        DB--&gt;&gt;API: Confirmaci\u00f3n\n        API--&gt;&gt;Admin: Success\n    end</code></pre> Lista Administrativa <pre><code>{\n    \"results\": [\n        {\n            \"Id\": 1,\n            \"FechaProgramadaUtc\": \"2024-03-20T10:00:00\",\n            \"PlantaOrigen\": \"Planta A\",\n            \"Cliente\": \"Cliente X\",\n            \"Programador\": \"Admin1\",\n            \"RutConductor\": \"12345678-9\",\n            \"Patente\": \"ABCD12\",\n            \"Terminado\": false,\n            \"Cancelado\": false,\n            \"Comentario\": null,\n            \"CodigoTransportista\": \"TRANS1\",\n            \"UserName\": \"Juan P\u00e9rez\"\n        }\n    ]\n}\n</code></pre> Lista Conductor <pre><code>{\n    \"results\": [\n        {\n            \"Id\": 1,\n            \"FechaProgramadaUtc\": \"2024-03-20T10:00:00\",\n            \"PlantaOrigen\": \"Planta A\",\n            \"Cliente\": \"Cliente X\",\n            \"Patente\": \"ABCD12\"\n        }\n    ]\n}\n</code></pre> Caracter\u00edstica Vista Admin Vista Conductor Alcance Todos los viajes Solo viajes propios Per\u00edodo 2 d\u00edas atr\u00e1s Hoy + 2 d\u00edas Info Usuario Incluida No incluida Permisos Completos Solo lectura Cancelaci\u00f3n Permitida No permitida Detalles T\u00e9cnicos <ul> <li>Vista Admin:<ul> <li>Join con tabla Users</li> <li>Incluye informaci\u00f3n completa</li> <li>Muestra todos los conductores</li> </ul> </li> <li>Vista Conductor:<ul> <li>Filtrada por RutConductor</li> <li>Informaci\u00f3n limitada</li> <li>Rango de fechas espec\u00edfico</li> </ul> </li> <li>Cancelaci\u00f3n:<ul> <li>Actualiza estados</li> <li>Registra comentarios</li> <li>Mantiene historial</li> </ul> </li> </ul>"},{"location":"backend/tracmin/viajes/programados_realizados/#viajes-realizados","title":"Viajes Realizados","text":"Endpoint Viajes Realizados Consultar Viajes Recientes (Admin) POST /api/logipath/recent_trips_mes<pre><code>@router.post(f\"{APP_PATH}/recent_trips_mes\")\nasync def recent_trips_mes(sec: Annotated[str, Depends(security_scheme)]):\n    \"\"\"\n    Retorna los viajes realizados en las \u00faltimas 5 semanas con estad\u00edsticas\n    y detalles de productos desde SAP.\n    Requiere permisos de administrador.\n\n    Args:\n        sec (str): Token JWT de administrador\n\n    Returns:\n        dict: {\n            \"results\": [Lista de viajes con detalles],\n            \"cantidad_x_dia_semana\": [Estad\u00edsticas por d\u00eda]\n        }\n\n    Raises:\n        HTTPException: \n            - 404: Si no hay viajes recientes\n            - 401: Si el token es inv\u00e1lido\n            - 500: Error interno del servidor\n    \"\"\"\n</code></pre> Estructura de Datos Modelo de Respuesta<pre><code>{\n    \"results\": [\n        {\n            \"Id\": int,\n            \"IdProgramado\": int,\n            \"PlantaOrigen\": str,\n            \"Cliente\": str,\n            \"RutConductor\": str,\n            \"Patente\": str,\n            \"HoraInicioJornada\": datetime,\n            \"HoraFinEntrega\": datetime,\n            \"Folio\": str,\n            \"Cancelado\": bool,\n            \"RutTransportista\": str,\n            \"NombreSapTransportista\": str,\n            \"Articulo\": str,\n            \"ItemName\": str,\n            \"ForeignName\": str,\n            # ... m\u00e1s campos\n        }\n    ],\n    \"cantidad_x_dia_semana\": [\n        {\n            \"DiaSemana\": str,\n            \"Cantidad\": int\n        }\n    ]\n}\n</code></pre> Consideraciones Importantes <ul> <li>Integraci\u00f3n con SAP para detalles de productos</li> <li>Conversi\u00f3n de zonas horarias (UTC a Chile)</li> <li>Manejo de coordenadas geogr\u00e1ficas</li> <li>Gesti\u00f3n de estados de viaje</li> <li>Tracking de eventos del viaje</li> </ul> Caracter\u00edsticas Principales <ul> <li>Historial de 5 semanas</li> <li>Estad\u00edsticas por d\u00eda de la semana</li> <li>Informaci\u00f3n detallada de productos</li> <li>Tracking completo del viaje</li> <li>Geolocalizaci\u00f3n en puntos clave</li> </ul> Sequence DiagramEjemplos de RespuestaCampos Relevantes <pre><code>sequenceDiagram\n    participant Admin\n    participant API\n    participant DB\n    participant SAP\n\n    Admin-&gt;&gt;API: POST /recent_trips_mes\n    API-&gt;&gt;API: Validar JWT Admin\n\n    API-&gt;&gt;DB: Query Viajes Recientes\n    DB-&gt;&gt;DB: Join Tables\n    DB--&gt;&gt;API: Datos Base\n\n    API-&gt;&gt;API: Procesar Estad\u00edsticas\n\n    opt Informaci\u00f3n SAP\n        API-&gt;&gt;SAP: Login SAP\n        SAP--&gt;&gt;API: Token\n        API-&gt;&gt;SAP: Query Items\n        SAP--&gt;&gt;API: Datos Productos\n        API-&gt;&gt;API: Enriquecer Datos\n    end\n\n    API--&gt;&gt;Admin: Resultados + Estad\u00edsticas</code></pre> Respuesta Exitosa <pre><code>{\n    \"results\": [\n        {\n            \"Id\": 1,\n            \"PlantaOrigen\": \"Planta Central\",\n            \"Cliente\": \"Cliente A\",\n            \"HoraInicioJornada\": \"2024-03-20T08:00:00-03:00\",\n            \"Folio\": \"F001\",\n            \"Articulo\": \"ART001\",\n            \"ItemName\": \"Arena Fina\",\n            \"Neto\": 28500\n        }\n    ],\n    \"cantidad_x_dia_semana\": [\n        {\n            \"DiaSemana\": \"Monday\",\n            \"Cantidad\": 12\n        },\n        {\n            \"DiaSemana\": \"Tuesday\",\n            \"Cantidad\": 15\n        }\n    ]\n}\n</code></pre> Error Sin Datos <pre><code>{\n    \"detail\": \"No hay viajes recientes.\"\n}\n</code></pre> Campo Descripci\u00f3n Tipo HoraInicioJornada Inicio del viaje datetime HoraFinEntrega Fin del viaje datetime Folio N\u00famero de gu\u00eda string Articulo C\u00f3digo producto string ItemName Nombre producto string Neto Peso neto number Cancelado Estado cancelaci\u00f3n boolean Integraci\u00f3n SAP <ul> <li>Conexi\u00f3n autom\u00e1tica a SAP</li> <li>Obtenci\u00f3n de detalles de productos</li> <li>Manejo de errores de conexi\u00f3n</li> <li>Cach\u00e9 de datos frecuentes</li> <li>Timeout configurable</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Monitorear tiempos de respuesta</li> <li>Implementar cach\u00e9 cuando sea posible</li> <li>Logging de errores SAP</li> <li>Validar datos geogr\u00e1ficos</li> <li>Mantener \u00edndices optimizados</li> </ul>"},{"location":"frontend/react/actualizar_native/","title":"\ud83d\udd04 Actualizaciones de la App","text":""},{"location":"frontend/react/actualizar_native/#proceso-de-actualizacion","title":"Proceso de Actualizaci\u00f3n","text":"Generar Nueva Versi\u00f3n <ol> <li> <p>Actualizar Versi\u00f3n <pre><code>// app.json\n{\n  \"expo\": {\n    \"name\": \"Mi App\",\n    \"version\": \"1.0.1\", // Incrementar versi\u00f3n\n    \"android\": {\n      \"versionCode\": 2 // Incrementar c\u00f3digo\n    }\n  }\n}\n</code></pre></p> </li> <li> <p>Generar nuevo build <pre><code># Generar nuevo .aab\neas build -p android\n</code></pre></p> </li> </ol>"},{"location":"frontend/react/actualizar_native/#subir-actualizacion-a-play-store","title":"\ud83d\udcf1 Subir Actualizaci\u00f3n a Play Store","text":"Paso a Paso <ol> <li>Acceder a Google Play Console</li> <li>Seleccionar tu aplicaci\u00f3n</li> <li>Navegar a <code>Production</code> en el men\u00fa lateral</li> <li>Click en <code>Create new release</code></li> <li>Subir el archivo <code>.aab</code> generado por Expo</li> <li>Completar notas de la versi\u00f3n</li> <li>Revisar y enviar para revisi\u00f3n</li> </ol> Detalles del Proceso Paso Descripci\u00f3n Tiempo Estimado Subir .aab Archivo generado por <code>eas build</code> 5-10 min Revisi\u00f3n Google Proceso autom\u00e1tico/manual 1-3 d\u00edas Distribuci\u00f3n Disponible en Play Store 1-2 horas"},{"location":"frontend/react/actualizar_native/#lista-de-verificacion-para-updates","title":"\u2705 Lista de Verificaci\u00f3n para Updates","text":"Antes de Subir <ul> <li>[ ] Incrementar <code>version</code> en app.json</li> <li>[ ] Incrementar <code>versionCode</code> en app.json</li> <li>[ ] Probar app en modo release</li> <li>[ ] Preparar notas de la versi\u00f3n</li> <li>[ ] Generar nuevo .aab</li> <li>[ ] Verificar cambios importantes</li> </ul>"},{"location":"frontend/react/actualizar_native/#notas-de-la-version","title":"\ud83d\udcdd Notas de la Versi\u00f3n","text":"Ejemplo de Notas <pre><code>Versi\u00f3n 1.0.1:\n\u2022 Correcci\u00f3n de errores menores\n\u2022 Mejoras de rendimiento\n\u2022 Nuevas caracter\u00edsticas:\n  - Feature 1\n  - Feature 2\n</code></pre>"},{"location":"frontend/react/actualizar_native/#consideraciones-importantes","title":"\u26a0\ufe0f Consideraciones Importantes","text":"Puntos a Tener en Cuenta <ul> <li>No se puede bajar la versi\u00f3n una vez publicada</li> <li>El <code>versionCode</code> debe ser mayor al anterior</li> <li>La revisi\u00f3n puede requerir informaci\u00f3n adicional</li> <li>Mantener respaldo de versiones anteriores</li> <li>Considerar actualizaciones graduales</li> </ul>"},{"location":"frontend/react/actualizar_native/#monitoreo-post-actualizacion","title":"\ud83d\udd0d Monitoreo Post-Actualizaci\u00f3n","text":"M\u00e9tricas a Observar <ul> <li>Tasa de adopci\u00f3n de la nueva versi\u00f3n</li> <li>Reportes de errores</li> <li>Comentarios de usuarios</li> <li>Desinstalaciones</li> <li>Crashes en la nueva versi\u00f3n</li> </ul>"},{"location":"frontend/react/actualizar_native/#solucion-de-problemas-comunes","title":"\ud83c\udd98 Soluci\u00f3n de Problemas Comunes","text":"Problemas y Soluciones Problema Soluci\u00f3n Rechazo de actualizaci\u00f3n Revisar pol\u00edticas de Google Error en .aab Regenerar build Versi\u00f3n incorrecta Verificar app.json Distribuci\u00f3n lenta Esperar 24h"},{"location":"frontend/react/actualizar_native/#seguimiento-de-versiones","title":"\ud83d\udcca Seguimiento de Versiones","text":"Registro de Actualizaciones <pre><code># Historial de Versiones\n\n## v1.0.1 (2024-03-20)\n- Build: 2\n- Changes: Bug fixes\n\n## v1.0.0 (2024-03-01)\n- Build: 1\n- Changes: Initial release\n</code></pre>"},{"location":"frontend/react/levantar-react-native/","title":"\ud83d\udcf1 Gu\u00eda de Desarrollo React Native con Expo","text":""},{"location":"frontend/react/levantar-react-native/#prerequisitos","title":"\ud83c\udfaf Prerequisitos","text":"Requisitos del Sistema <ul> <li>Node.js (versi\u00f3n LTS)</li> <li>VS Code o editor preferido</li> <li>Expo Go (App m\u00f3vil)</li> <li>Cuenta de Google Play Console</li> <li>macOS, Linux, o Windows (PowerShell/WSL2)</li> </ul>"},{"location":"frontend/react/levantar-react-native/#configuracion-inicial","title":"\ud83d\udee0\ufe0f Configuraci\u00f3n Inicial","text":""},{"location":"frontend/react/levantar-react-native/#1-crear-cuenta-google-play-console","title":"1\ufe0f\u20e3 Crear Cuenta Google Play Console","text":"Registro en Google Play Console <ol> <li>Visitar Google Play Console</li> <li>Pagar tarifa \u00fanica de $25 USD</li> <li>Completar informaci\u00f3n de la cuenta:<ul> <li>Datos personales/empresa</li> <li>Informaci\u00f3n de pago</li> <li>Verificaci\u00f3n de identidad</li> </ul> </li> </ol>"},{"location":"frontend/react/levantar-react-native/#2-instalacion-de-herramientas","title":"2\ufe0f\u20e3 Instalaci\u00f3n de Herramientas","text":"Expo CLIExpo Go App <pre><code># Instalar Expo CLI globalmente\nnpm install -g expo-cli\n\n# Verificar instalaci\u00f3n\nexpo --version\n</code></pre> <ol> <li>Descargar Expo Go:<ul> <li>Android Play Store</li> <li>iOS App Store</li> </ul> </li> </ol>"},{"location":"frontend/react/levantar-react-native/#crear-nuevo-proyecto","title":"\ud83d\ude80 Crear Nuevo Proyecto","text":""},{"location":"frontend/react/levantar-react-native/#3-inicializar-proyecto","title":"3\ufe0f\u20e3 Inicializar Proyecto","text":"Crear ProyectoEstructura de Archivos <pre><code># Crear nuevo proyecto\nnpx create-expo-app@latest MiApp\n\n# Navegar al directorio\ncd MiApp\n</code></pre> <pre><code>MiApp/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 index.tsx\n\u2502   \u2514\u2500\u2500 _layout.tsx\n\u251c\u2500\u2500 assets/\n\u2502   \u2514\u2500\u2500 images/\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 app.json\n</code></pre>"},{"location":"frontend/react/levantar-react-native/#desarrollo","title":"\ud83d\udcbb Desarrollo","text":""},{"location":"frontend/react/levantar-react-native/#4-configuracion-basica","title":"4\ufe0f\u20e3 Configuraci\u00f3n B\u00e1sica","text":"App.json <pre><code>{\n  \"expo\": {\n    \"name\": \"Mi Aplicaci\u00f3n\",\n    \"slug\": \"mi-app\",\n    \"version\": \"1.0.0\",\n    \"orientation\": \"portrait\",\n    \"icon\": \"./assets/icon.png\",\n    \"splash\": {\n      \"image\": \"./assets/splash.png\",\n      \"backgroundColor\": \"#ffffff\"\n    }\n  }\n}\n</code></pre>"},{"location":"frontend/react/levantar-react-native/#5-ejecutar-aplicacion","title":"5\ufe0f\u20e3 Ejecutar Aplicaci\u00f3n","text":"Desarrollo LocalOpciones de Ejecuci\u00f3n <pre><code># Iniciar servidor de desarrollo\nnpx expo start\n</code></pre> Tecla Acci\u00f3n a Abrir Android i Abrir iOS w Abrir Web r Recargar m Men\u00fa"},{"location":"frontend/react/levantar-react-native/#pruebas-en-dispositivo","title":"\ud83d\udcf1 Pruebas en Dispositivo","text":"Usando Expo Go <ol> <li>Abrir Expo Go en el dispositivo</li> <li>Escanear QR del terminal</li> <li>La app se cargar\u00e1 autom\u00e1ticamente</li> </ol> Ejemplo B\u00e1sico <pre><code>import { Text, View, StyleSheet } from 'react-native';\n\nexport default function App() {\n  return (\n    &lt;View style={styles.container}&gt;\n      &lt;Text style={styles.text}&gt;\n        \u00a1Hola Mundo!\n      &lt;/Text&gt;\n    &lt;/View&gt;\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#25292e',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  text: {\n    color: '#fff',\n  },\n});\n</code></pre>"},{"location":"frontend/react/levantar-react-native/#publicacion-en-google-play","title":"\ud83d\udce6 Publicaci\u00f3n en Google Play","text":""},{"location":"frontend/react/levantar-react-native/#6-preparacion-para-produccion","title":"6\ufe0f\u20e3 Preparaci\u00f3n para Producci\u00f3n","text":"Requisitos Google Play <ul> <li>Icono de app (512x512)</li> <li>Screenshots (m\u00ednimo 2)</li> <li>Descripci\u00f3n corta y larga</li> <li>Pol\u00edtica de privacidad</li> <li>Clasificaci\u00f3n de contenido</li> </ul> Generar APK <pre><code># Configurar eas.json\neas build:configure\n\n# Crear build para Android\neas build -p android\n</code></pre>"},{"location":"frontend/react/levantar-react-native/#7-proceso-de-publicacion","title":"7\ufe0f\u20e3 Proceso de Publicaci\u00f3n","text":"<ol> <li>Acceder a Google Play Console</li> <li>Crear nueva aplicaci\u00f3n</li> <li>Completar ficha de Play Store</li> <li>Subir APK/Bundle</li> <li>Publicar en producci\u00f3n</li> </ol>"},{"location":"frontend/react/levantar-react-native/#solucion-de-problemas","title":"\u26a0\ufe0f Soluci\u00f3n de Problemas","text":"Problemas Comunes Problema Soluci\u00f3n Metro bundler error Limpiar cache Expo Go no conecta Verificar red Build falla Revisar eas.json APK rechazado Revisar pol\u00edticas"},{"location":"frontend/react/levantar-react-native/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Documentaci\u00f3n Expo</li> <li>React Native Docs</li> <li>Google Play Console</li> <li>Gu\u00edas de Publicaci\u00f3n</li> </ul>"},{"location":"frontend/react/levantar-react-native/#proceso-de-actualizacion","title":"Proceso de Actualizaci\u00f3n","text":"Generar Nueva Versi\u00f3n <ol> <li> <p>Actualizar Versi\u00f3n <pre><code>// app.json\n{\n  \"expo\": {\n    \"name\": \"Mi App\",\n    \"version\": \"1.0.1\", // Incrementar versi\u00f3n\n    \"android\": {\n      \"versionCode\": 2 // Incrementar c\u00f3digo\n    }\n  }\n}\n</code></pre></p> </li> <li> <p>Generar nuevo build <pre><code># Generar nuevo .aab\neas build -p android\n</code></pre></p> </li> </ol>"},{"location":"frontend/react/levantar-react-native/#subir-actualizacion-a-play-store","title":"\ud83d\udcf1 Subir Actualizaci\u00f3n a Play Store","text":"Paso a Paso <ol> <li>Acceder a Google Play Console</li> <li>Seleccionar tu aplicaci\u00f3n</li> <li>Navegar a <code>Production</code> en el men\u00fa lateral</li> <li>Click en <code>Create new release</code></li> <li>Subir el archivo <code>.aab</code> generado por Expo</li> <li>Completar notas de la versi\u00f3n</li> <li>Revisar y enviar para revisi\u00f3n</li> </ol> Detalles del Proceso Paso Descripci\u00f3n Tiempo Estimado Subir .aab Archivo generado por <code>eas build</code> 5-10 min Revisi\u00f3n Google Proceso autom\u00e1tico/manual 1-3 d\u00edas Distribuci\u00f3n Disponible en Play Store 1-2 horas"},{"location":"frontend/react/levantar-react-native/#lista-de-verificacion-para-updates","title":"\u2705 Lista de Verificaci\u00f3n para Updates","text":"Antes de Subir <ul> <li>[ ] Incrementar <code>version</code> en app.json</li> <li>[ ] Incrementar <code>versionCode</code> en app.json</li> <li>[ ] Probar app en modo release</li> <li>[ ] Preparar notas de la versi\u00f3n</li> <li>[ ] Generar nuevo .aab</li> <li>[ ] Verificar cambios importantes</li> </ul>"},{"location":"frontend/react/levantar-react-native/#notas-de-la-version","title":"\ud83d\udcdd Notas de la Versi\u00f3n","text":"Ejemplo de Notas <pre><code>Versi\u00f3n 1.0.1:\n\u2022 Correcci\u00f3n de errores menores\n\u2022 Mejoras de rendimiento\n\u2022 Nuevas caracter\u00edsticas:\n  - Feature 1\n  - Feature 2\n</code></pre>"},{"location":"frontend/react/levantar-react-native/#consideraciones-importantes","title":"\u26a0\ufe0f Consideraciones Importantes","text":"Puntos a Tener en Cuenta <ul> <li>No se puede bajar la versi\u00f3n una vez publicada</li> <li>El <code>versionCode</code> debe ser mayor al anterior</li> <li>La revisi\u00f3n puede requerir informaci\u00f3n adicional</li> <li>Mantener respaldo de versiones anteriores</li> <li>Considerar actualizaciones graduales</li> </ul>"},{"location":"frontend/react/levantar-react-native/#monitoreo-post-actualizacion","title":"\ud83d\udd0d Monitoreo Post-Actualizaci\u00f3n","text":"M\u00e9tricas a Observar <ul> <li>Tasa de adopci\u00f3n de la nueva versi\u00f3n</li> <li>Reportes de errores</li> <li>Comentarios de usuarios</li> <li>Desinstalaciones</li> <li>Crashes en la nueva versi\u00f3n</li> </ul>"},{"location":"frontend/react/levantar-react-native/#solucion-de-problemas-comunes","title":"\ud83c\udd98 Soluci\u00f3n de Problemas Comunes","text":"Problemas y Soluciones Problema Soluci\u00f3n Rechazo de actualizaci\u00f3n Revisar pol\u00edticas de Google Error en .aab Regenerar build Versi\u00f3n incorrecta Verificar app.json Distribuci\u00f3n lenta Esperar 24h"},{"location":"frontend/react/levantar-react-native/#seguimiento-de-versiones","title":"\ud83d\udcca Seguimiento de Versiones","text":"Registro de Actualizaciones <pre><code># Historial de Versiones\n\n## v1.0.1 (2024-03-20)\n- Build: 2\n- Changes: Bug fixes\n\n## v1.0.0 (2024-03-01)\n- Build: 1\n- Changes: Initial release\n</code></pre>"},{"location":"frontend/react/levantar/","title":"\ud83d\ude80 Gu\u00eda de Instalaci\u00f3n: Next.js + Shadcn/UI","text":""},{"location":"frontend/react/levantar/#prerequisitos","title":"\ud83d\udccb Prerequisitos","text":"Requisitos del Sistema <ul> <li>Node.js 18.17 o superior</li> <li>pnpm, npm, yarn o bun</li> <li>Editor de c\u00f3digo (VS Code recomendado)</li> </ul>"},{"location":"frontend/react/levantar/#instalacion","title":"\ud83d\udee0\ufe0f Instalaci\u00f3n","text":""},{"location":"frontend/react/levantar/#1-crear-proyecto-nextjs","title":"1\ufe0f\u20e3 Crear Proyecto Next.js","text":"Con pnpmCon npmCon yarn <pre><code>pnpm create next-app my-app\ncd my-app\n</code></pre> <pre><code>npx create-next-app my-app\ncd my-app\n</code></pre> <pre><code>yarn create next-app my-app\ncd my-app\n</code></pre>"},{"location":"frontend/react/levantar/#2-configurar-shadcnui","title":"2\ufe0f\u20e3 Configurar Shadcn/UI","text":"Inicializaci\u00f3n <pre><code># M\u00e9todo Interactivo\npnpm dlx shadcn@latest init\n\n# M\u00e9todo con Defaults (-d)\npnpm dlx shadcn@latest init -d\n</code></pre> Preguntas de Configuraci\u00f3n Pregunta Opciones Recomendado Style Default/New York New York Color Base Slate/Zinc/... Zinc CSS Variables Yes/No Yes"},{"location":"frontend/react/levantar/#3-instalar-componentes","title":"3\ufe0f\u20e3 Instalar Componentes","text":"M\u00e9todo IndividualComponentes Populares <pre><code># Instalar un componente\npnpm dlx shadcn@latest add button\n\n# Instalar m\u00faltiples componentes\npnpm dlx shadcn@latest add card form input\n</code></pre> <pre><code># UI B\u00e1sica\npnpm dlx shadcn@latest add button card input form dialog\n\n# Navegaci\u00f3n\npnpm dlx shadcn@latest add navigation-menu dropdown-menu\n\n# Datos\npnpm dlx shadcn@latest add table select combobox\n</code></pre>"},{"location":"frontend/react/levantar/#uso-de-componentes","title":"\ud83d\udcbb Uso de Componentes","text":"Ejemplo B\u00e1sico <pre><code>import { Button } from \"@/components/ui/button\"\nimport { Card } from \"@/components/ui/card\"\n\nexport default function Home() {\n  return (\n    &lt;Card&gt;\n      &lt;Button&gt;Click me&lt;/Button&gt;\n    &lt;/Card&gt;\n  )\n}\n</code></pre> Formulario <pre><code>import { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Form } from \"@/components/ui/form\"\n\nexport default function LoginForm() {\n  return (\n    &lt;Form&gt;\n      &lt;Input placeholder=\"Email\" /&gt;\n      &lt;Input type=\"password\" placeholder=\"Password\" /&gt;\n      &lt;Button&gt;Login&lt;/Button&gt;\n    &lt;/Form&gt;\n  )\n}\n</code></pre>"},{"location":"frontend/react/levantar/#personalizacion","title":"\ud83c\udfa8 Personalizaci\u00f3n","text":"Temas <pre><code>// globals.css\n@layer base {\n  :root {\n    --background: 0 0% 100%;\n    --foreground: 240 10% 3.9%;\n    /* A\u00f1adir m\u00e1s variables seg\u00fan necesidad */\n  }\n}\n</code></pre> Componentes <pre><code>// components/ui/custom-button.tsx\nimport { Button } from \"@/components/ui/button\"\nimport { cn } from \"@/lib/utils\"\n\nexport function CustomButton({ className, ...props }) {\n  return (\n    &lt;Button \n      className={cn(\"bg-primary text-white\", className)} \n      {...props} \n    /&gt;\n  )\n}\n</code></pre>"},{"location":"frontend/react/levantar/#verificacion","title":"\u2705 Verificaci\u00f3n","text":"Lista de Verificaci\u00f3n <ul> <li>[ ] Next.js instalado y funcionando</li> <li>[ ] Shadcn/UI inicializado</li> <li>[ ] Componentes necesarios instalados</li> <li>[ ] Temas configurados</li> <li>[ ] Estructura de carpetas correcta</li> </ul>"},{"location":"frontend/react/levantar/#solucion-de-problemas","title":"\u26a0\ufe0f Soluci\u00f3n de Problemas","text":"Problemas Comunes Problema Soluci\u00f3n Componente no encontrado Verificar instalaci\u00f3n Estilos no aplicados Revisar globals.css TypeScript errors Actualizar tipos Build fails Limpiar cache y node_modules"},{"location":"frontend/react/levantar/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Documentaci\u00f3n Shadcn/UI</li> <li>Next.js Docs</li> <li>Ejemplos de Componentes</li> <li>GitHub Repo</li> </ul>"},{"location":"frontend/tracmin/que-es-tracmin/","title":"\ud83d\ude9b TRACMIN - Documentaci\u00f3n Frontend","text":""},{"location":"frontend/tracmin/que-es-tracmin/#descripcion-general","title":"\ud83d\udcf1 Descripci\u00f3n General","text":"<p>Tracmin es una aplicaci\u00f3n de gesti\u00f3n de transporte minero que opera en dos plataformas: - \ud83c\udf10 Aplicaci\u00f3n Web (PWA) - \ud83d\udcf1 Aplicaci\u00f3n M\u00f3vil (Android)</p>"},{"location":"frontend/tracmin/que-es-tracmin/#tecnologias-principales","title":"Tecnolog\u00edas Principales","text":"Stack Tecnol\u00f3gico Tecnolog\u00eda Uso Versi\u00f3n Next.js + TypeScript Framework principal 14.x Shadcn UI Componentes UI Latest Tailwind CSS Estilos 3.x Redux Estado global Latest IndexedDB Almacenamiento local - WebSocket Tiempo real - React Native (Expo) App m\u00f3vil Latest"},{"location":"frontend/tracmin/que-es-tracmin/#aplicacion-web-pwa","title":"\ud83c\udf10 Aplicaci\u00f3n Web (PWA)","text":""},{"location":"frontend/tracmin/que-es-tracmin/#ambientes","title":"Ambientes","text":"URLs de Acceso Ambiente URL Descripci\u00f3n \ud83d\ude80 Producci\u00f3n tracmin.cl Ambiente productivo \ud83e\uddea QA qa.azure Pruebas \ud83d\udee0\ufe0f Desarrollo dev.azure Desarrollo"},{"location":"frontend/tracmin/que-es-tracmin/#arquitectura","title":"Arquitectura","text":"<pre><code>graph TB\n    subgraph \"Frontend Architecture\"\n        UI[UI Components]\n        Redux[Redux Store]\n        WS[WebSocket]\n        IDB[IndexedDB]\n\n        UI --&gt; Redux\n        UI --&gt; WS\n        UI --&gt; IDB\n    end</code></pre>"},{"location":"frontend/tracmin/que-es-tracmin/#roles-de-usuario","title":"Roles de Usuario","text":"Perfiles de Acceso Rol Descripci\u00f3n Accesos \ud83d\ude9a Conductor Operador de veh\u00edculo Viajes, rutas \ud83d\udc65 Admin Transportista Gesti\u00f3n de flota Dashboard, reportes \ud83c\udfe2 Cliente Usuario final Seguimiento \u2696\ufe0f Admin Romana Control de peso Pesajes, registros"},{"location":"frontend/tracmin/que-es-tracmin/#aplicacion-movil","title":"\ud83d\udcf1 Aplicaci\u00f3n M\u00f3vil","text":"Detalles Play Store <ul> <li>\ud83d\udce5 Descargar App</li> <li>\ud83d\udce6 100+ Descargas</li> <li>\ud83d\udd12 Datos encriptados</li> <li>\ud83d\udcf1 Compatible: Android</li> </ul>"},{"location":"frontend/tracmin/que-es-tracmin/#caracteristicas-pwa","title":"Caracter\u00edsticas PWA","text":"Capacidades PWA <ul> <li>\u2705 Instalable</li> <li>\u2705 Offline-first</li> <li>\u2705 Push notifications</li> <li>\u2705 Responsive design</li> <li>\u2705 App-like experience</li> </ul>"},{"location":"frontend/tracmin/que-es-tracmin/#gestion-de-datos","title":"\ud83d\udcbe Gesti\u00f3n de Datos","text":""},{"location":"frontend/tracmin/que-es-tracmin/#redux-store","title":"Redux Store","text":"Estado Global <pre><code>interface RootState {\n  user: UserState;\n  trips: TripState;\n  notifications: NotificationState;\n  // ...otros estados\n}\n</code></pre>"},{"location":"frontend/tracmin/que-es-tracmin/#indexeddb","title":"IndexedDB","text":"Estructura de Datos <pre><code>interface DBSchema {\n  trips: TripRecord[];\n  userPrefs: UserPreferences;\n  offlineData: OfflineStorage;\n}\n</code></pre>"},{"location":"frontend/tracmin/que-es-tracmin/#tiempo-real","title":"\ud83d\udd04 Tiempo Real","text":"WebSocket Events <pre><code>// Eventos principales\nenum WSEvents {\n  TRIP_UPDATE = 'trip:update',\n  LOCATION_CHANGE = 'location:change',\n  NEW_NOTIFICATION = 'notification:new'\n}\n</code></pre>"},{"location":"frontend/tracmin/que-es-tracmin/#desarrollo","title":"\ud83d\udee0\ufe0f Desarrollo","text":""},{"location":"frontend/tracmin/que-es-tracmin/#configuracion-local","title":"Configuraci\u00f3n Local","text":"<pre><code># Instalar dependencias\nnpm install\n\n# Desarrollo\nnpm run dev\n\n# Build\nnpm run build\n</code></pre>"},{"location":"frontend/tracmin/que-es-tracmin/#variables-de-entorno","title":"Variables de Entorno","text":"Configuraci\u00f3n <pre><code>NEXT_PUBLIC_API_URL=\nNEXT_PUBLIC_WS_URL=\nNEXT_PUBLIC_MAPS_KEY=\n</code></pre>"},{"location":"frontend/tracmin/que-es-tracmin/#monitoreo","title":"\ud83d\udcca Monitoreo","text":"Herramientas <ul> <li>Azure Application Insights</li> <li>Google Analytics</li> <li>Error tracking</li> <li>Performance monitoring</li> </ul>"},{"location":"frontend/tracmin/que-es-tracmin/#seguridad","title":"\ud83d\udd10 Seguridad","text":"Consideraciones <ul> <li>Autenticaci\u00f3n JWT</li> <li>Datos encriptados</li> <li>HTTPS</li> <li>Validaci\u00f3n de roles</li> <li>Sanitizaci\u00f3n de datos</li> </ul>"},{"location":"frontend/tracmin/que-es-tracmin/#recursos","title":"\ud83d\udcda Recursos","text":"Enlaces \u00datiles <ul> <li>Documentaci\u00f3n API</li> <li>Gu\u00eda Actualizar Native</li> </ul>"},{"location":"iot/configuracion/azure/","title":"\ud83d\udce1 Conexi\u00f3n de Dispositivos a Azure IoT Hub","text":""},{"location":"iot/configuracion/azure/#requisitos-previos","title":"\ud83d\udcdf Requisitos Previos","text":"<ul> <li>Azure IoT Hub configurado y en funcionamiento.</li> <li>Dispositivo registrado en el IoT Hub con autenticaci\u00f3n mediante certificado X.509 o SAS token.</li> <li>Certificados necesarios:</li> <li>CA (Autoridad Certificadora)</li> <li>Certificado del dispositivo</li> <li>Clave privada del dispositivo</li> <li>Herramientas instaladas:</li> <li>Azure IoT Explorer</li> <li>MQTTX</li> <li>Python 3.x con las bibliotecas <code>paho-mqtt</code> y <code>ssl</code></li> </ul>"},{"location":"iot/configuracion/azure/#autenticacion-con-certificado-x509","title":"\ud83d\udd10 Autenticaci\u00f3n con Certificado X.509","text":""},{"location":"iot/configuracion/azure/#estructura-de-certificados","title":"\ud83d\udcc1 Estructura de Certificados","text":"<pre><code>graph TD\n    A[Certificado Ra\u00edz (CA)] --&gt; B[Certificado del Dispositivo]\n    B --&gt; C[Clave Privada del Dispositivo]</code></pre>"},{"location":"iot/configuracion/azure/#descarga-de-certificados-ejemplos","title":"\ud83d\udcc5 Descarga de Certificados (ejemplos)","text":"<p>Descargar Ejemplos</p> <ul> <li>CA: <code>DigiCertGlobalRootG2.crt.pem</code> </li> <li>Certificado del dispositivo: <code>UC-300-primary.crt</code> </li> <li>Clave privada del dispositivo: <code>UC-300-primary.key</code> </li> </ul> <p>Aseg\u00farate de almacenar estos archivos en un directorio seguro y accesible para tu aplicaci\u00f3n.</p>"},{"location":"iot/configuracion/azure/#codigo-de-ejemplo-en-python","title":"\ud83e\uddea C\u00f3digo de Ejemplo en Python","text":"<pre><code>import ssl\nimport paho.mqtt.client as mqtt\n\n# Par\u00e1metros de conexi\u00f3n\nbroker = \"elaltoiot.azure-devices.net\"\nport = 8883\ndevice_id = \"UC-300\"\nusername = f\"{broker}/{device_id}/?api-version=2018-06-30\"\npassword = \"\"\ntopic = f\"devices/{device_id}/messages/events/\"\n\n# Rutas a los certificados\nca_cert = \"DigiCertGlobalRootG2.crt.pem\"\nclient_cert = \"UC-300-primary.crt\"\nclient_key = \"UC-300-primary.key\"\n\ndef on_connect(client, userdata, flags, rc):\n    if rc == 0:\n        print(\"\u2705 Conectado exitosamente a Azure IoT Hub.\")\n        payload = '{\"message\": \"Hola desde Python MQTT\"}'\n        client.publish(topic, payload)\n        print(\"\ud83d\ude80 Mensaje de prueba enviado.\")\n    else:\n        print(f\"\u274c Error de conexi\u00f3n. C\u00f3digo de retorno: {rc}\")\n\ndef on_publish(client, userdata, mid):\n    print(\"\u2705 Mensaje publicado exitosamente.\")\n\ndef on_disconnect(client, userdata, rc):\n    print(\"\ud83d\udd0c Desconectado del servidor.\")\n\n# Crear cliente MQTT\nclient = mqtt.Client(client_id=device_id, protocol=mqtt.MQTTv311)\nclient.username_pw_set(username=username, password=password)\n\n# Configurar TLS\nclient.tls_set(\n    ca_certs=ca_cert,\n    certfile=client_cert,\n    keyfile=client_key,\n    tls_version=ssl.PROTOCOL_TLSv1_2,\n    cert_reqs=ssl.CERT_REQUIRED\n)\n\nclient.on_connect = on_connect\nclient.on_publish = on_publish\nclient.on_disconnect = on_disconnect\n\nclient.connect(broker, port)\nclient.loop_forever()\n</code></pre>"},{"location":"iot/configuracion/azure/#autenticacion-con-sas-token","title":"\ud83d\udd11 Autenticaci\u00f3n con SAS Token","text":""},{"location":"iot/configuracion/azure/#codigo-de-ejemplo-en-python_1","title":"\ud83e\uddea C\u00f3digo de Ejemplo en Python","text":"<pre><code>import paho.mqtt.client as mqtt\nimport ssl\n\n# Configuraci\u00f3n\nbroker = \"elaltoiot.azure-devices.net\"\nport = 8883\ndevice_id = \"UC300\"\nsas_token = \"SharedAccessSignature sr=elaltoiot.azure-devices.net%2Fdevices%2FUC300&amp;sig=5jLjkvegnXWmLkPd%2F79OhmrrRqS0UMehS9LYifeJdzI%3D&amp;se=1747747216\"\nusername = f\"{broker}/{device_id}/?api-version=2018-06-30\"\nca_cert = \"DigiCertGlobalRootG2.crt.pem\"\n\ndef on_connect(client, userdata, flags, rc):\n    if rc == 0:\n        print(\"\u2705 Conectado exitosamente a Azure IoT Hub.\")\n        client.publish(f\"devices/{device_id}/messages/events/\", payload=\"Prueba desde Python\", qos=1)\n    else:\n        print(f\"\u274c Error al conectar. C\u00f3digo de retorno: {rc}\")\n\ndef on_publish(client, userdata, mid):\n    print(\"\ud83d\udce8 Mensaje publicado exitosamente.\")\n\nclient = mqtt.Client(client_id=device_id, protocol=mqtt.MQTTv311)\nclient.username_pw_set(username=username, password=sas_token)\nclient.tls_set(\n    ca_certs=ca_cert,\n    certfile=None,\n    keyfile=None,\n    cert_reqs=ssl.CERT_REQUIRED,\n    tls_version=ssl.PROTOCOL_TLSv1_2,\n    ciphers=None\n)\n\nclient.on_connect = on_connect\nclient.on_publish = on_publish\n\nclient.connect(broker, port=port)\nclient.loop_forever()\n</code></pre>"},{"location":"iot/configuracion/azure/#verificacion-de-conexion-con-azure-iot-explorer","title":"\ud83d\udd7d\ufe0f Verificaci\u00f3n de Conexi\u00f3n con Azure IoT Explorer","text":"<ol> <li>Abrir Azure IoT Explorer y conectarse al IoT Hub.</li> <li>Ir a Devices y seleccionar el dispositivo <code>UC-300</code>.</li> <li>Revisar el Device Twin:</li> <li><code>connectionState</code>: Connected o Disconnected</li> <li><code>lastActivityTime</code>: Fecha y hora de la \u00faltima actividad</li> <li>Enviar mensajes desde la pesta\u00f1a Telemetry para confirmar la comunicaci\u00f3n.</li> </ol>"},{"location":"iot/configuracion/azure/#pruebas-con-mqttx","title":"\ud83d\udee0\ufe0f Pruebas con MQTTX","text":"<ol> <li>Crear nueva conexi\u00f3n en MQTTX:</li> <li>Broker Address: <code>elaltoiot.azure-devices.net</code></li> <li>Port: <code>8883</code></li> <li>Client ID: <code>UC-300</code></li> <li>Username: <code>elaltoiot.azure-devices.net/UC-300/?api-version=2018-06-30</code></li> <li>Password: (SAS Token o vac\u00edo si es certificado)</li> <li>TLS Activado:</li> <li>CA File: <code>DigiCertGlobalRootG2.crt.pem</code></li> <li>Client Certificate: <code>UC-300-primary.crt</code></li> <li>Client Key: <code>UC-300-primary.key</code></li> <li>Conectar y observar el estado.</li> <li>Publicar en <code>devices/UC-300/messages/events/</code>.</li> <li>Suscribirse para verificar la recepci\u00f3n.</li> </ol>"},{"location":"iot/configuracion/azure/#diagrama-de-flujo-de-conexion","title":"\ud83e\uddf9 Diagrama de Flujo de Conexi\u00f3n","text":"<pre><code>graph LR\n    A[Inicio] --&gt; B{Tipo de Autenticaci\u00f3n}\n    B --&gt;|Certificado X.509| C[Configurar certificados]\n    B --&gt;|SAS Token| D[Generar SAS token]\n    C --&gt; E[Configurar cliente MQTT]\n    D --&gt; E\n    E --&gt; F[Conectar al IoT Hub]\n    F --&gt; G{Conexi\u00f3n exitosa?}\n    G --&gt;|S\u00ed| H[Enviar mensaje de prueba]\n    G --&gt;|No| I[Revisar configuraci\u00f3n]\n    H --&gt; J[Verificar en Azure IoT Explorer]\n    I --&gt; E</code></pre>"},{"location":"iot/configuracion/azure/#recursos-adicionales","title":"\ud83d\udcda Recursos Adicionales","text":"<ul> <li>Documentaci\u00f3n de Azure IoT Hub</li> <li>Gu\u00eda de Azure IoT Explorer</li> <li>MQTTX - Herramienta de Pruebas MQTT</li> </ul>"},{"location":"iot/configuracion/azure/#generacion-y-firma-de-certificados-con-openssl","title":"\ud83d\udee1\ufe0f Generaci\u00f3n y Firma de Certificados con OpenSSL","text":"<p>A continuaci\u00f3n se describen los pasos para crear una CA, generar un certificado de dispositivo, firmarlo y obtener el thumbprint (huella digital) en el formato requerido por Azure.</p>"},{"location":"iot/configuracion/azure/#1-generar-la-clave-privada-de-la-ca-y-su-certificado","title":"1. Generar la clave privada de la CA y su certificado","text":"<p><pre><code>openssl genrsa -out ca.key 2048\nopenssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.crt\n</code></pre> - ca.key: Clave privada de la CA - ca.crt: Certificado de la CA (v\u00e1lido por 10 a\u00f1os)</p>"},{"location":"iot/configuracion/azure/#2-generar-la-clave-privada-y-csr-solicitud-de-firma-del-dispositivo","title":"2. Generar la clave privada y CSR (solicitud de firma) del dispositivo","text":"<p><pre><code>openssl genrsa -out device.key 2048\nopenssl req -new -key device.key -out device.csr\n</code></pre> - device.key: Clave privada del dispositivo - device.csr: Solicitud de firma de certificado</p>"},{"location":"iot/configuracion/azure/#3-firmar-el-certificado-del-dispositivo-con-la-ca","title":"3. Firmar el certificado del dispositivo con la CA","text":"<p><pre><code>openssl x509 -req -in device.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out device.crt -days 365 -sha256\n</code></pre> - device.crt: Certificado del dispositivo firmado por la CA</p>"},{"location":"iot/configuracion/azure/#4-verificar-el-certificado-generado","title":"4. Verificar el certificado generado","text":"<pre><code>openssl x509 -in device.crt -text -noout\n</code></pre>"},{"location":"iot/configuracion/azure/#5-obtener-el-thumbprint-huella-digital-sha1-del-certificado","title":"5. Obtener el thumbprint (huella digital SHA1) del certificado","text":"<p><pre><code>openssl x509 -in device.crt -noout -fingerprint -sha1\n</code></pre> El resultado ser\u00e1 algo como: <pre><code>SHA1 Fingerprint=AA:BB:CC:DD:EE:FF:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE\n</code></pre></p>"},{"location":"iot/configuracion/azure/#6-quitar-los-dos-puntos-del-thumbprint-para-azure","title":"6. Quitar los dos puntos (:) del thumbprint para Azure","text":"<p>En Windows CMD: <pre><code>FOR /F \"tokens=2 delims==\" %A IN ('openssl x509 -in device.crt -noout -fingerprint -sha1') DO @SET thumb=%A\nSET thumb=%thumb::=%\nECHO %thumb%\n</code></pre></p> <p>En PowerShell: <pre><code>( openssl x509 -in device.crt -noout -fingerprint -sha1 ) -replace 'SHA1 Fingerprint=','' -replace ':',''\n</code></pre></p> <p>En Linux/Mac: <pre><code>openssl x509 -in device.crt -noout -fingerprint -sha1 | sed 's/://g' | sed 's/SHA1 Fingerprint=//'\n</code></pre></p>"},{"location":"iot/configuracion/azure/#7-usa-el-thumbprint-sin-los-dos-puntos-para-registrar-el-certificado-en-azure-iot-hub","title":"7. Usa el thumbprint sin los dos puntos para registrar el certificado en Azure IoT Hub","text":"<p>Importante: El thumbprint debe estar en may\u00fasculas y sin los dos puntos (<code>:</code>). Ejemplo: <code>AABBCCDDEEFF112233445566778899AABBCCDDEE</code></p>"},{"location":"iot/configuracion/azure/#archivos-generados","title":"\ud83d\udce6 Archivos generados","text":"<ul> <li><code>ca.key</code> y <code>ca.crt</code>: Clave y certificado de la CA</li> <li><code>device.key</code>: Clave privada del dispositivo</li> <li><code>device.csr</code>: Solicitud de firma del dispositivo</li> <li><code>device.crt</code>: Certificado del dispositivo firmado</li> </ul> <p>Guarda estos archivos en un lugar seguro.</p>"},{"location":"logica_negocio/SAASS/flujo/","title":"API Packaging y Distribuci\u00f3n - Documentaci\u00f3n (Admin)","text":""},{"location":"logica_negocio/SAASS/flujo/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de packaging y distribuci\u00f3n que permite controlar el proceso desde el packaging hasta los puntos de venta. Integraci\u00f3n con SAP Business Layer para gesti\u00f3n de inventario y documentos.</p>"},{"location":"logica_negocio/SAASS/flujo/#ejemplos-de-documentos","title":"Ejemplos de Documentos","text":""},{"location":"logica_negocio/SAASS/flujo/#guia-de-transferencia-de-stock","title":"Gu\u00eda de transferencia de stock","text":"<p>Puedes descargar un ejemplo de gu\u00eda de transferencia de stock generada por el sistema:</p> <p> Descargar ejemplo de Gu\u00eda de transferencia de stock (PDF)</p> <p>Nota sobre el documento</p> <p>Este documento es un ejemplo de una gu\u00eda de despacho generada por el sistema. Contiene todos los campos relevantes como informaci\u00f3n del cliente, conductor, veh\u00edculo, producto, cantidades y valores.</p>"},{"location":"logica_negocio/SAASS/flujo/#video-demostracion","title":"Video Demostraci\u00f3n","text":"Notas Importantes <ul> <li>Sistema integrado con SAP Business Layer</li> <li>Control de documentos de transferencia</li> <li>Acceso v\u00eda huevosdehoy.tracmin.cl</li> </ul> Consideraciones de Seguridad <ul> <li>Validaci\u00f3n de permisos SAP</li> <li>Control de acceso por rol</li> <li>Validaci\u00f3n de documentos de transferencia</li> <li>Trazabilidad de movimientos</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Verificar stock antes de transferencias</li> <li>Mantener registro de movimientos</li> <li>Monitorear niveles de inventario</li> <li>Documentar ajustes de stock</li> <li>Notificar eventos cr\u00edticos</li> </ul> Integraciones <ul> <li>SAP Business Layer:<ul> <li>Gesti\u00f3n de inventario</li> <li>Generaci\u00f3n de documentos</li> <li>Control de stock</li> </ul> </li> <li>Web App:<ul> <li>Interfaz de usuario (huevosdehoy.tracmin.cl)</li> <li>Operaciones de packaging</li> <li>Gesti\u00f3n de transferencias</li> </ul> </li> </ul>"},{"location":"logica_negocio/SAASS/flujo/#flujo-operacional-packaging-despacho-y-distribucion","title":"Flujo Operacional: Packaging, Despacho y Distribuci\u00f3n","text":"<p>Este documento describe el proceso paso a paso de la gesti\u00f3n desde la etrada hasta la distribuci\u00f3n de stock hacia las distintas bodegas, utilizando la integraci\u00f3n con SAP Business Layer y la aplicaci\u00f3n web huevosdehoy.tracmin.cl.</p>"},{"location":"logica_negocio/SAASS/flujo/#descripcion-de-pasos","title":"Descripci\u00f3n de Pasos","text":"1. Despacho desde Packaging <ul> <li>Se inicia el proceso de carga de huevos en el transporte</li> <li>El sistema genera autom\u00e1ticamente la Gu\u00eda de Despacho SAASS</li> <li>Se registra la Entrada de Mercanc\u00eda en SAP (BodegaBOD0003)</li> <li>El operador confirma la carga en huevosdehoy.tracmin.cl</li> </ul> 2. Recepci\u00f3n en Bodega Central <ul> <li>El transporte llega a la bodega central</li> <li>Se confirma la recepci\u00f3n en SAP</li> <li>El sistema actualiza el inventario autom\u00e1ticamente</li> <li>Se registra la ubicaci\u00f3n f\u00edsica del producto</li> </ul> 3. Distribuci\u00f3n a Puntos de Venta <ul> <li>Se planifica la distribuci\u00f3n a bodegas de venta</li> <li>El sistema genera Gu\u00edas de Transferencia</li> <li>Se asigna stock a cada punto de venta</li> <li>Se actualiza el inventario en tiempo real</li> </ul> 4. Transferencia de Stock <ul> <li>Se procesa la transferencia en SAP</li> <li>Se genera documentaci\u00f3n de movimiento</li> <li>Se actualiza inventario en origen y destino</li> <li>Se confirma la recepci\u00f3n en destino</li> </ul> 5. Recepci\u00f3n en Puntos de Venta <ul> <li>Se confirma la recepci\u00f3n en destino</li> <li>El sistema actualiza el inventario final</li> <li>Se genera documentaci\u00f3n de cierre</li> <li>Se registra la disponibilidad para venta</li> </ul>"},{"location":"logica_negocio/SAASS/flujo/#diagrama-de-flujo","title":"Diagrama de Flujo","text":"<pre><code>flowchart TD\n    A([\"Despacho de Huevos Packing\"]) --&gt; n2[\"Carga de huevos en transporte\"]\n    n2 --&gt; n3[\"Gu\u00eda de despacho SAASS (Entrega)\"] &amp; n5[\"Entrada de Mercancia Comer&lt;br&gt;(BodegaBOD0003)\"]\n    n5 --&gt; n4[\"Recepci\u00f3n en Bodega Comer\"]\n    n3 --&gt; n4\n    n4 --&gt; n6[\"Distribuci\u00f3n a bodegas de venta (Locales, Vendedores)\"]\n    n6 --&gt; n7[\"Gu\u00eda de despacho (Transferencia de stock)\"]\n    n7 --&gt; n8[\"Recepci\u00f3n autom\u00e1tica en bodegas de venta\"]\n    n3@{ shape: doc}\n    n5@{ shape: doc}\n    n7@{ shape: doc}</code></pre>"},{"location":"logica_negocio/SAASS/flujo/#integracion-tecnica","title":"Integraci\u00f3n T\u00e9cnica","text":"SAP Business Layer <ul> <li>Gesti\u00f3n de documentos: <code>{ Gu\u00edaDespacho, TransferenciaStock, EntradaMercanc\u00eda }</code></li> <li>Control de inventario: <code>{ Actualizaci\u00f3nStock, Validaci\u00f3nDisponibilidad }</code></li> <li>Procesos autom\u00e1ticos: <code>{ Generaci\u00f3nDocumentos, Actualizaci\u00f3nInventario }</code></li> </ul> Requisitos de Infraestructura <ul> <li>Conexi\u00f3n estable con SAP Business Layer</li> <li>Acceso a huevosdehoy.tracmin.cl</li> </ul>"},{"location":"logica_negocio/combustible/entrada_mercancia/","title":"API Combustible - Documentaci\u00f3n (Admin)","text":""},{"location":"logica_negocio/combustible/entrada_mercancia/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de combustible que permite registrar y consultar el consumo de combustible de la flota. Acceso exclusivo para administradores.</p> Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de combustible</li> <li>Acceso restringido a administradores</li> <li>Modelos principales:     modelos<pre><code>class reqSession(BaseModel):\n    Folio: str\n\nclass reqSessionPostStock(BaseModel):\n    Folio: str\n    Planta: str\n    Patente: str\n    FotoDocumento: str  # Base64\n    WarehouseCodeQuantity: List[WarehouseCodeQuantityItem]\n    UnitPrice: float\n\nclass WarehouseCodeQuantityItem(BaseModel):\n    WarehouseCode: str\n    Quantity: float\n</code></pre></li> </ul> Consideraciones de Seguridad <ul> <li>Validaci\u00f3n de key de autorizaci\u00f3n</li> <li>Acceso restringido a administradores</li> <li>Validaci\u00f3n de documentos</li> <li>Protecci\u00f3n de datos sensibles</li> <li>Control de acceso a bodegas</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar documentos antes de procesar</li> <li>Mantener registro de transacciones</li> <li>Monitorear niveles de stock</li> <li>Documentar cambios de inventario</li> <li>Notificar eventos importantes</li> </ul> Integraciones <ul> <li>FEBOS:<ul> <li>Consulta de documentos tributarios</li> <li>Validaci\u00f3n de gu\u00edas</li> </ul> </li> <li>SAP:<ul> <li>Control de inventario</li> <li>Registro de movimientos</li> </ul> </li> <li>Azure:<ul> <li>Almacenamiento de documentos</li> <li>Gesti\u00f3n de archivos</li> </ul> </li> <li>Email:<ul> <li>Notificaciones autom\u00e1ticas</li> <li>Alertas de stock</li> </ul> </li> </ul>"},{"location":"logica_negocio/combustible/entrada_mercancia/#endpoints-combustible","title":"Endpoints Combustible","text":"EndpointsSequence DiagramEjemplos de RespuestaC\u00f3digos de EstadoValidaciones Consultar Gu\u00eda de Combustible POST /api/logipath/get_fuel_guide<pre><code>@router.post(f\"{APP_PATH}/get_fuel_guide\")\nasync def fuel(res: Request, req: reqSession):\n    \"\"\"\n    Obtiene informaci\u00f3n detallada de una gu\u00eda de combustible.\n\n    Args:\n        res (Request): Request con key de autorizaci\u00f3n\n        req (reqSession): Folio de la gu\u00eda\n\n    Returns:\n        dict: {\n            \"documento\": dict,\n            \"tipo_dte\": str,\n            \"folio\": int,\n            \"fecha_emision\": str,\n            \"razon_social_emisor\": str,\n            \"monto_total\": float,\n            \"cantidad\": float,\n            \"PrcItem\": float,\n            \"DirDest\": str,\n            \"CmnaDest\": str,\n            \"CiudadDest\": str\n        }\n\n    Raises:\n        HTTPException: \n            - 401: Si la key es inv\u00e1lida\n            - 500: Error en la consulta\n    \"\"\"\n</code></pre> Consultar Stock de Combustible POST /api/logipath/get_stock_fuel<pre><code>@router.post(f\"{APP_PATH}/get_stock_fuel\")\nasync def fuel(res: Request, req: reqSession):\n    \"\"\"\n    Obtiene el stock actual de combustible por bodega.\n\n    Args:\n        res (Request): Request con key de autorizaci\u00f3n\n        req (reqSession): Datos de consulta\n\n    Returns:\n        dict: {\n            \"bodegas\": [\n                {\n                    \"WarehouseCode\": str,\n                    \"cantidad\": float,\n                    \"WarehouseName\": str,\n                    \"MaximalStock\": float,\n                    \"MinimalStock\": float\n                }\n            ]\n        }\n    \"\"\"\n</code></pre> Registrar Consumo de Combustible POST /api/logipath/post_fuel_stock<pre><code>@router.post(f\"{APP_PATH}/post_fuel_stock\")\nasync def fuel(res: Request, req: reqSessionPostStock):\n    \"\"\"\n    Registra el consumo de combustible y actualiza stock.\n\n    Args:\n        res (Request): Request con key de autorizaci\u00f3n\n        req (reqSessionPostStock): Datos del consumo\n\n    Returns:\n        dict: {\n            \"message\": str,\n            \"IdAzure\": str,\n            \"LinkAzure\": str\n        }\n    \"\"\"\n</code></pre> <pre><code>sequenceDiagram\n    participant Admin\n    participant API\n    participant FEBOS\n    participant SAP\n    participant Azure\n    participant Email\n\n    alt Consulta Gu\u00eda\n        Admin-&gt;&gt;API: POST /get_fuel_guide\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;FEBOS: Consultar Gu\u00eda\n        FEBOS--&gt;&gt;API: XML Gu\u00eda\n        API-&gt;&gt;API: Procesar XML\n        API--&gt;&gt;Admin: Datos Gu\u00eda\n\n    else Consulta Stock\n        Admin-&gt;&gt;API: POST /get_stock_fuel\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;SAP: Login\n        SAP--&gt;&gt;API: Token\n        API-&gt;&gt;SAP: Consultar Stock\n        SAP--&gt;&gt;API: Datos Stock\n        API--&gt;&gt;Admin: Stock por Bodega\n\n    else Registrar Consumo\n        Admin-&gt;&gt;API: POST /post_fuel_stock\n        API-&gt;&gt;API: Validar Key\n        API-&gt;&gt;SAP: Actualizar Stock\n\n        par Almacenar Documento\n            API-&gt;&gt;Azure: Subir Foto\n            Azure--&gt;&gt;API: URL Documento\n        and Notificar\n            API-&gt;&gt;Email: Enviar Notificaci\u00f3n\n        end\n\n        API--&gt;&gt;Admin: Confirmaci\u00f3n\n    end</code></pre> Consulta Gu\u00eda <pre><code>{\n    \"documento\": {\n        \"xmlLink\": \"https://api.febos.cl/...\"\n    },\n    \"tipo_dte\": \"33\",\n    \"folio\": \"123456\",\n    \"fecha_emision\": \"2024-03-20\",\n    \"razon_social_emisor\": \"Empresa Combustibles\",\n    \"monto_total\": 150000.00,\n    \"cantidad\": 100.00,\n    \"PrcItem\": 1500.00\n}\n</code></pre> Consulta Stock <pre><code>{\n    \"bodegas\": [\n        {\n            \"WarehouseCode\": \"BOD1017\",\n            \"cantidad\": 5000.00,\n            \"WarehouseName\": \"Estanque Equipos M\u00f3viles\",\n            \"MaximalStock\": 10000.00,\n            \"MinimalStock\": 1000.00\n        }\n    ]\n}\n</code></pre> C\u00f3digo Descripci\u00f3n 200 Operaci\u00f3n exitosa 401 No autorizado 404 Documento no encontrado 500 Error interno Campo Regla Folio Formato v\u00e1lido Cantidad &gt; 0 FotoDocumento Base64 v\u00e1lido WarehouseCode Existente en SAP"},{"location":"logica_negocio/combustible/guias/","title":"Gu\u00edas Combustible - Documentaci\u00f3n","text":""},{"location":"logica_negocio/combustible/guias/#flujo-proceso-consumos-de-combustible","title":"Flujo Proceso Consumos de Combustible","text":"<p>Proceso que automatiza la generaci\u00f3n de gu\u00edas de despacho para consumos de combustible, integrando datos desde Neotac con SAP y Febos.</p> Visi\u00f3n de Negocio <p>El proceso automatiza la generaci\u00f3n de documentos tributarios para consumos de combustible siguiendo estos pasos clave:</p> 1. Identificaci\u00f3n de Consumos <p>Busca en la base de datos Neotac los consumos de combustible que no tienen gu\u00eda asociada.</p> 2. Validaci\u00f3n de Datos <p>Verifica que el RUT del conductor y la patente del veh\u00edculo sean v\u00e1lidos y est\u00e9n registrados.</p> 3. Determinaci\u00f3n de Precios <ul> <li>Consulta precios actuales de combustible en API externa (bencinaenlinea.cl)</li> <li>Obtiene impuestos espec\u00edficos desde el SII mediante web scraping</li> <li>Calcula precio final seg\u00fan el tipo de acuerdo comercial:<ul> <li>TipoAcuerdo 0: Precio copec menos impuesto espec\u00edfico, sin IVA, m\u00e1s margen</li> <li>TipoAcuerdo 1: Precio de costo m\u00e1s margen</li> </ul> </li> </ul> 4. Generaci\u00f3n de Documentos <ul> <li>Crea gu\u00eda de despacho en SAP con los datos del consumo</li> <li>Genera XML para documento tributario electr\u00f3nico</li> <li>Env\u00eda a Febos para foliado</li> </ul> 5. Actualizaci\u00f3n de Estado <ul> <li>Actualiza la gu\u00eda en SAP con el folio de Febos</li> <li>Registra el estado del proceso en NeotacGuiasStatus</li> <li>Obtiene link al documento para consulta posterior</li> </ul> Integraciones Clave <ul> <li>SAP: Creaci\u00f3n y actualizaci\u00f3n de gu\u00edas de despacho</li> <li>Febos: Timbrado electr\u00f3nico y foliado de documentos tributarios</li> <li>SII: Obtenci\u00f3n de impuestos espec\u00edficos a combustibles</li> <li>API de Precios: Consulta de precios actuales de combustible</li> </ul> Bases de Datos Tabla Descripci\u00f3n Datos Relevantes ConsumosNeotac Registra las transacciones de combustible desde Neotac Voucher, fecha, volumen, patente, RUT conductor, producto NeotacGuiasStatus Almacena el estado de procesamiento de cada gu\u00eda Voucher, DocEntry, Folio, FebosId, Status, errores VehiculosNeoTac Contiene informaci\u00f3n de los veh\u00edculos autorizados Patente, Empresa, datos t\u00e9cnicos ClientesCombustible Almacena informaci\u00f3n de clientes y sus acuerdos comerciales Empresa, TipoAcuerdo, Margen"},{"location":"logica_negocio/combustible/guias/#ejemplos-de-documentos","title":"Ejemplos de Documentos","text":""},{"location":"logica_negocio/combustible/guias/#guia-de-despacho-de-combustible","title":"Gu\u00eda de Despacho de Combustible","text":"<p>Puedes descargar un ejemplo de gu\u00eda de despacho de combustible generada por el sistema:</p> <p> Descargar ejemplo de Gu\u00eda de Despacho (PDF)</p> <p>Nota sobre el documento</p> <p>Este documento es un ejemplo de una gu\u00eda de despacho generada por el sistema. Contiene todos los campos relevantes como informaci\u00f3n del cliente, conductor, veh\u00edculo, producto, cantidades y valores.</p>"},{"location":"logica_negocio/combustible/guias/#diagramas-de-flujo","title":"Diagramas de Flujo","text":"FlujoDiagrama de SecuenciaEjemplos de RespuestaC\u00f3digos de Estado <pre><code>flowchart TD\nA[\"Inicio\"] --&gt; B[\"Obtener consumos sin procesar\"]\nB --&gt; C{\"\u00bfHay consumos?\"}\nC -- No --&gt; D[\"Retornar: No hay consumos nuevos\"]\nC -- S\u00ed --&gt; E[\"Procesar cada consumo\"]\nE --&gt; F[\"Validar datos del consumo\"]\nF --&gt; G{\"\u00bfDatos v\u00e1lidos?\"}\nG -- No --&gt; H[\"Registrar error y continuar\"]\nH --&gt; V[\"Continuar con siguiente consumo\"]\nG -- S\u00ed --&gt; I[\"Login en SAP\"]\nI --&gt; J[\"Obtener precio combustible\"]\nJ --&gt; K[\"Obtener datos impuestos SII\"]\nK --&gt; L[\"Crear gu\u00eda en SAP\"]\nL --&gt; M[\"Registrar gu\u00eda en base de datos\"]\nM --&gt; N[\"Obtener detalles adicionales\"]\nN --&gt; O[\"Generar XML para Febos\"]\nO --&gt; P[\"Enviar documento a Febos\"]\nP --&gt; Q{\"\u00bf\u00c9xito en Febos?\"}\nQ -- No --&gt; R[\"Cancelar gu\u00eda en SAP y registrar error\"]\nR --&gt; V\nQ -- S\u00ed --&gt; S[\"Actualizar gu\u00eda en SAP con folio\"]\nS --&gt; T[\"Obtener link de documento\"]\nT --&gt; U[\"Actualizar estado final\"]\nU --&gt; V\nV --&gt; W[\"Retornar resumen de procesamiento\"]</code></pre> <pre><code>sequenceDiagram\nparticipant API\nparticipant DB\nparticipant SAP\nparticipant SII\nparticipant PrecioAPI\nparticipant Febos\n\nNote over API: Inicio del proceso\n\nAPI-&gt;&gt;DB: Obtener consumos sin procesar\nDB--&gt;&gt;API: Lista de consumos\n\nalt No hay consumos\n    API--&gt;&gt;API: Retornar \"No hay consumos nuevos\"\nelse Hay consumos\n    loop Para cada consumo\n        API-&gt;&gt;API: Validar datos del consumo (RUT, patente)\n\n        alt Datos inv\u00e1lidos\n            API-&gt;&gt;DB: Registrar error\n            Note over API: Continuar con siguiente consumo\n        else Datos v\u00e1lidos\n            API-&gt;&gt;SAP: Login en SAP\n            SAP--&gt;&gt;API: Sesi\u00f3n autenticada\n\n            API-&gt;&gt;PrecioAPI: Obtener precio combustible\n            PrecioAPI--&gt;&gt;API: Precio actual\n\n            API-&gt;&gt;SII: Obtener datos impuestos SII\n            SII--&gt;&gt;API: Componentes IEF, IEV, IER\n\n            API-&gt;&gt;SAP: Crear gu\u00eda en SAP\n            SAP--&gt;&gt;API: DocEntry\n\n            API-&gt;&gt;DB: Registrar gu\u00eda en base de datos\n\n            API-&gt;&gt;SAP: Obtener detalles adicionales\n            SAP--&gt;&gt;API: Datos cliente y direcci\u00f3n\n\n            API-&gt;&gt;API: Generar XML para Febos\n\n            API-&gt;&gt;Febos: Enviar documento a Febos\n\n            alt Error en Febos\n                Febos--&gt;&gt;API: Error\n                API-&gt;&gt;SAP: Cancelar gu\u00eda en SAP\n                API-&gt;&gt;DB: Registrar error\n                Note over API: Continuar con siguiente consumo\n            else \u00c9xito en Febos\n                Febos--&gt;&gt;API: Folio y FebosId\n\n                API-&gt;&gt;SAP: Actualizar gu\u00eda en SAP con folio\n\n                API-&gt;&gt;Febos: Obtener link de documento\n                Febos--&gt;&gt;API: URL documento\n\n                API-&gt;&gt;DB: Actualizar estado final\n                Note over API: Continuar con siguiente consumo\n            end\n        end\n    end\n    API--&gt;&gt;API: Retornar resumen de procesamiento\nend</code></pre> Gu\u00eda generada correctamente <pre><code>{\n  \"message\": \"Se procesaron 3 consumos correctamente y fallaron 1 consumos\",\n  \"exitosos\": [\n    {\n      \"voucher\": \"12345\",\n      \"folio\": \"987654\",\n      \"link\": \"https://febos.cl/documento/987654\",\n      \"docEntry\": 12345,\n      \"monto_bruto\": 50000,\n      \"monto_neto\": 42016.81,\n      \"monto_iev\": 1.25,\n      \"monto_ief\": 3.75\n    }\n  ],\n  \"fallidos\": [\n    {\n      \"voucher\": \"67890\",\n      \"error\": \"RUT inv\u00e1lido: 12345678-9\",\n      \"patente\": \"ABCD12\"\n    }\n  ]\n}\n</code></pre> Error en la creaci\u00f3n de la gu\u00eda <pre><code>{\n    \"message\": \"Error al procesar los consumos\",\n    \"error\": str(e)\n}\n</code></pre> C\u00f3digo Descripci\u00f3n 200 Operaci\u00f3n exitosa 401 No autorizado 404 Documento no encontrado 500 Error interno"},{"location":"logica_negocio/romanaremota/flujo/","title":"API Romana Remota - Documentaci\u00f3n (Admin)","text":""},{"location":"logica_negocio/romanaremota/flujo/#descripcion-general","title":"Descripci\u00f3n General","text":"<p>Sistema de gesti\u00f3n de pesaje y despacho que permite registrar y controlar el proceso de taraje, carga y despacho de camiones. Acceso exclusivo para administradores y operadores de romana.</p>"},{"location":"logica_negocio/romanaremota/flujo/#video-demostracion","title":"Video Demostraci\u00f3n","text":"Notas Importantes <ul> <li>Sistema CRUD para gesti\u00f3n de pesaje y despacho</li> <li>Acceso restringido a administradores y operadores</li> </ul> Consideraciones de Seguridad <ul> <li>Validaci\u00f3n de key de autorizaci\u00f3n</li> <li>Acceso restringido a administradores y operadores</li> <li>Validaci\u00f3n de documentos</li> <li>Control de acceso a romana</li> </ul> Mejores Pr\u00e1cticas <ul> <li>Validar pesajes antes de procesar</li> <li>Mantener registro de transacciones</li> <li>Monitorear estado de sem\u00e1foros</li> <li>Documentar cambios de estado</li> <li>Notificar eventos importantes</li> </ul> Integraciones <ul> <li>WebSocket:<ul> <li>Comunicaci\u00f3n en tiempo real</li> <li>Notificaciones de estado</li> </ul> </li> <li>RDP:<ul> <li>Conexi\u00f3n a romana</li> <li>Control de pesaje</li> <li>Generaci\u00f3n de gu\u00edas</li> </ul> </li> <li>Impresora:<ul> <li>Impresi\u00f3n de documentos</li> </ul> </li> <li>Email:<ul> <li>Notificaciones autom\u00e1ticas</li> <li>Alertas de estado</li> </ul> </li> </ul>"},{"location":"logica_negocio/romanaremota/flujo/#flujo-operacional-pesaje-carga-y-despacho-de-camiones","title":"Flujo Operacional: Pesaje, Carga y Despacho de Camiones","text":"<p>Este documento describe el proceso paso a paso de la sub-feature que gestiona el pesaje de camiones (tara y carga), la comunicaci\u00f3n en tiempo real v\u00eda WebSocket entre las aplicaciones de Tracmin (Conductor y Cargador Frontal) y la generaci\u00f3n de la gu\u00eda de despacho.</p>"},{"location":"logica_negocio/romanaremota/flujo/#descripcion-de-pasos","title":"Descripci\u00f3n de Pasos","text":"1. Llegada y Tara <ul> <li>El cami\u00f3n llega a la Romana</li> <li>El sem\u00e1foro de taraje se pone en VERDE</li> <li>La Romana establece conexi\u00f3n RDP con el escritorio remoto donde el operador de Tracmin Admin realiza el pesaje sin carga</li> <li>El operador registra el valor de tara en la aplicaci\u00f3n Tracmin Admin</li> </ul> 2. Notificaci\u00f3n de Nueva Tara <ul> <li>Al registrar la tara, Tracmin Admin emite un mensaje WebSocket (<code>NuevaTara</code>) con el valor y el ID de cami\u00f3n</li> <li>Las aplicaciones Tracmin Conductor y Tracmin Cargador Frontal, suscritas al canal de WebSocket, reciben el evento y actualizan su interfaz para mostrar la nueva tara</li> </ul> 3. Proceso de Carga <ul> <li>El cami\u00f3n se dirige a la planta de carga e inicia conexi\u00f3n bidireccional</li> <li>El flujo conecta directamente con la confirmaci\u00f3n de inicio de carga por parte del cargador frontal y conductor</li> <li>El conductor o cargador pueden pulsar \"Iniciar Carga\" en Tracmin, emitiendo un evento WebSocket</li> <li>Una vez completada la carga, el cargador frontal o conductor emite un evento WebSocket para finalizar la carga</li> <li>El conductor y cargador reciben la se\u00f1al de fin de carga, cerrando el ciclo de carga</li> </ul> 4. Pesaje con Carga <ul> <li>El cami\u00f3n regresa a la Romana para el pesaje con carga</li> <li>El sem\u00e1foro de pesaje cambia a VERDE</li> <li>El operador pesa el cami\u00f3n y registra el peso bruto en Tracmin Admin</li> </ul> 5. Generaci\u00f3n de Gu\u00eda de Despacho <ul> <li>Tras el registro del peso con carga, Tracmin Admin calcula el peso neto (peso bruto \u2013 tara) y genera la Gu\u00eda de Despacho</li> <li>Tracmin Admin emite un evento WebSocket (<code>dispatch_ready</code>)</li> <li>Tracmin Conductor recibe la notificaci\u00f3n y muestra la opci\u00f3n para imprimir la gu\u00eda</li> <li>El sem\u00e1foro de salida se pone en VERDE, indicando que el cami\u00f3n puede retirar la gu\u00eda y dirigirse al cliente</li> </ul>"},{"location":"logica_negocio/romanaremota/flujo/#diagrama-de-flujo","title":"Diagrama de Flujo","text":"<pre><code>flowchart TD\n subgraph subGraph0[\"Tracmin Log\u00edstica (Conductor)\"]\n        K1[\"Iniciar Carga (load_start)\"]\n        N1[\"Confirmar Fin de Carga\"]\n  end\n subgraph subGraph1[\"Tracmin Extracci\u00f3n (Cargador Frontal)\"]\n        K2[\"Confirmar Inicio de Carga\"]\n        M2[\"Notificar Fin de Carga (load_complete)\"]\n  end\n subgraph subGraph2[\"Carga en Planta\"]\n    direction LR\n        subGraph0\n        subGraph1\n        L2[\"Cargador Frontal recibe load_start\"]\n        L1[\"Conductor recibe confirmaci\u00f3n de inicio\"]\n        L1b[\"Conductor recibe load_complete\"]\n        L2b[\"Cargador Frontal recibe confirmaci\u00f3n fin\"]\n  end\n    A[\"Cami\u00f3n llega a la Romana (tara)\"] --&gt; B[\"Sem\u00e1foro taraje cambia a VERDE\"]\n    B --&gt; C[\"Ingreso a escritorio remoto\"]\n    C --&gt; D[\"Romanero remoto pesa cami\u00f3n vac\u00edo e ingresa tara en Tracmin Admin\"]\n    D --&gt; F[\"Tracmin Admin emite evento WebSocket: new_tara\"]\n    F --&gt; G[\"Tracmin Conductor recibe su tara en la pantalla\"] &amp; H[\"Tracmin Cargador Frontal recibe Nueva tara e informaci\u00f3n (Patente, destino, etc.)\"]\n    G --&gt; J[\"Cami\u00f3n va a planta para carga\"]\n    J --&gt; K1\n    H --&gt; K2\n    K1 --&gt; N1\n    K2 --&gt; M2\n    K1 -- evento --&gt; L2\n    K2 -- evento --&gt; L1\n    M2 -- evento --&gt; L1b\n    N1 -- evento --&gt; L2b\n    L2b --&gt; O[\"Cami\u00f3n regresa a Romana (peso con carga)\"]\n    L1b --&gt; O\n    O --&gt; P[\"Sem\u00e1foro de pesaje cambia a VERDE\"]\n    P --&gt; Q[\"Romanero remoto pesa cami\u00f3n cargado y crea Gu\u00eda de Despacho en Tracmin Admin\"]\n    Q --&gt; T[\"Tracmin Admin emite evento WebSocket: dispatch_ready\"]\n    T --&gt; U[\"Tracmin Conductor recibe dispatch_ready (Gu\u00eda de Despacho Digital)\"]\n    U --&gt; V[\"Sem\u00e1foro de salida cambia a VERDE\"]\n    V --&gt; W[\"Conductor retira gu\u00eda impresa y va a despachar\"]\n\n    K1@{ shape: rounded}\n    N1@{ shape: rounded}\n    K2@{ shape: rounded}\n    M2@{ shape: rounded}\n    subGraph0@{ shape: rounded}\n    subGraph1@{ shape: rounded}\n    L2@{ shape: rounded}\n    L1@{ shape: rounded}\n    L1b@{ shape: rounded}\n    L2b@{ shape: rounded}\n    A@{ shape: rounded}\n    B@{ shape: rounded}\n    C@{ shape: rounded}\n    D@{ shape: rounded}\n    F@{ shape: rounded}\n    G@{ shape: rounded}\n    H@{ shape: rounded}\n    J@{ shape: rounded}\n    O@{ shape: rounded}\n    P@{ shape: rounded}\n    Q@{ shape: rounded}\n    T@{ shape: rounded}\n    U@{ shape: rounded}\n    V@{ shape: rounded}\n    W@{ shape: rounded}\n    subGraph2@{ shape: rounded}\n    classDef Pine stroke-width:1px, stroke-dasharray:none, stroke:#254336, fill:#27654A, color:#FFFFFF\n    classDef Rose stroke-width:1px, stroke-dasharray:none, stroke:#FF5978, fill:#FFDFE5, color:#8E2236\n    classDef Sky stroke-width:1px, stroke-dasharray:none, stroke:#374D7C, fill:#E2EBFF, color:#374D7C\n    style K1 fill:#C8E6C9,stroke:#C8E6C9\n    style N1 fill:#C8E6C9,stroke:#C8E6C9\n    style K2 fill:#FFCDD2,stroke:#FFCDD2\n    style M2 stroke:#FFCDD2,fill:#FFCDD2\n    style subGraph0 fill:#00C853\n    style subGraph1 fill:#FFCDD2\n    style L2 fill:#C8E6C9,stroke:#C8E6C9\n    style L1 fill:#FFCDD2,stroke:#FFCDD2\n    style L1b fill:#FFCDD2,stroke:#FFCDD2\n    style L2b fill:#C8E6C9,stroke:#C8E6C9,stroke-width:2px,stroke-dasharray: 0\n    style D fill:#C8E6C9,color:none,stroke:#C8E6C9\n    style F fill:#C8E6C9,stroke:#C8E6C9\n    style G fill:#C8E6C9,stroke:#C8E6C9\n    style H fill:#FFCDD2,stroke:#FFCDD2\n    style J fill:#C8E6C9,stroke:none,color:none\n    style Q fill:#C8E6C9,stroke:#C8E6C9\n    style T fill:#C8E6C9,stroke:#C8E6C9\n    style U stroke:#C8E6C9,fill:#C8E6C9</code></pre>"},{"location":"logica_negocio/romanaremota/flujo/#integracion-tecnica","title":"Integraci\u00f3n T\u00e9cnica","text":"WebSocket Channels <ul> <li><code>post_trip</code>: Emite <code>{ InicioCarga, FinCarga }</code></li> <li><code>post_trip_tracmin</code>: Emite <code>{ PantallaFinCarga, PantallaGuias }</code></li> <li><code>sap_guides</code>: Emite <code>{ PantallaGuias }</code></li> </ul> Roles y Permisos <ul> <li>Romanero remoto Admin: Puede pesar cami\u00f3n y registrar datos en Tracmin Admin</li> <li>Conductor: Visualiza eventos y controla inicio/fin de carga</li> <li>Cargador Frontal: Supervisa y confirma procesos de carga</li> </ul> Requisitos de Infraestructura <ul> <li>Servidor de WebSocket con alta disponibilidad</li> <li>Escritorio remoto con cliente RDP habilitado conectado a la Romana</li> <li>Impresora de gu\u00edas en el punto de salida</li> </ul>"},{"location":"logica_negocio/romanaremota/flujo/#manejo-de-fallas-y-reconexion-websocket","title":"Manejo de Fallas y Reconexi\u00f3n WebSocket","text":"<p>En caso de que se pierda la conexi\u00f3n WebSocket en alguna de las aplicaciones (Tracmin Conductor o Cargador Frontal), se implementan los siguientes mecanismos de resiliencia:</p> 1. Reconexi\u00f3n Autom\u00e1tica <ul> <li>Cada cliente WebSocket intenta reconectarse de forma autom\u00e1tica usando un backoff exponencial</li> <li>Durante la reconexi\u00f3n, se muestra en la interfaz un mensaje de estado como \"Reconectando con servidor\u2026\"</li> </ul> 2. Re-sincronizaci\u00f3n de Estado <ul> <li>Una vez restablecida la conexi\u00f3n, la aplicaci\u00f3n emite autom\u00e1ticamente un evento <code>resync_state</code> con su <code>IdViaje</code></li> <li>Tracmin Admin responde con el estado actual del cami\u00f3n, incluyendo:     <pre><code>{\n\"Id\": \"123\",\n\"Tara\": 18500,\n\"HoraInicioCarga\": \"\",\n\"HoraFinCarga\": \"\"\n}\n</code></pre></li> <li>La aplicaci\u00f3n cliente actualiza su interfaz para reflejar correctamente el estado del flujo</li> </ul> 3. Caso Fallo Websocket <ul> <li>Los operadores pueden continuar el flujo de forma manual desde Tracmin Admin si es necesario</li> </ul> 4. Registro de Errores <ul> <li>Todas las fallas de conexi\u00f3n se registran con timestamp y detalle del error en un log central accesible para monitoreo y an\u00e1lisis de incidencias</li> </ul> <p>Este mecanismo asegura que ninguna aplicaci\u00f3n se quede en un estado inconsistente ante fallas de red temporales, y permite continuar el flujo operativo una vez restaurada la conectividad. </p>"}]}